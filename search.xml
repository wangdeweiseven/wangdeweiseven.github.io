<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Webå®‰å…¨å¿…ä¿®è¯¾-Cookieçš„é£Ÿç”¨æŒ‡å— ğŸª</title>
    <url>/2022/07/06/Web%E5%AE%89%E5%85%A8%E5%BF%85%E4%BF%AE%E8%AF%BE-cookie%E7%9A%84%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="ä¸€ã€Cookie-æ˜¯ä»€ä¹ˆï¼Ÿè¶…å¸‚å‚¨ç‰©æŸœçš„å³è§†æ„Ÿ"><a href="#ä¸€ã€Cookie-æ˜¯ä»€ä¹ˆï¼Ÿè¶…å¸‚å‚¨ç‰©æŸœçš„å³è§†æ„Ÿ" class="headerlink" title="ä¸€ã€Cookie æ˜¯ä»€ä¹ˆï¼Ÿè¶…å¸‚å‚¨ç‰©æŸœçš„å³è§†æ„Ÿ"></a>ä¸€ã€Cookie æ˜¯ä»€ä¹ˆï¼Ÿè¶…å¸‚å‚¨ç‰©æŸœçš„å³è§†æ„Ÿ</h2><p>æƒ³è±¡ä½ ç¬¬ä¸€æ¬¡å»è¶…å¸‚è´­ç‰©ï¼ŒæœåŠ¡å‘˜ç»™äº†ä½ ä¸€å¼ <strong>å°ç¥¨ï¼ˆCookieï¼‰</strong>ã€‚ä¹‹åæ¯æ¬¡å»è¶…å¸‚ï¼Œåªè¦å‡ºç¤ºè¿™å¼ å°ç¥¨å°±èƒ½ç›´æ¥æ‰“å¼€è‡ªå·±çš„å‚¨ç‰©æŸœã€‚Cookie å°±æ˜¯æµè§ˆå™¨å¸®æˆ‘ä»¬è®°ä½è¿™äº›â€å‚¨ç‰©æŸœå°ç¥¨â€çš„æŠ€æœ¯ã€‚</p>
<hr>
<h2 id="äºŒã€Cookie-çš„åŸæ–™é…æ–¹è¡¨"><a href="#äºŒã€Cookie-çš„åŸæ–™é…æ–¹è¡¨" class="headerlink" title="äºŒã€Cookie çš„åŸæ–™é…æ–¹è¡¨"></a>äºŒã€Cookie çš„åŸæ–™é…æ–¹è¡¨</h2><p>æ¯ä¸ª Cookie éƒ½åŒ…å«è¿™äº›æ ¸å¿ƒé…æ–™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;username=JohnDoe;</span></span><br><span class="line"><span class="string">                  expires=Fri, 31 Dec 2023 23:59:59 GMT;</span></span><br><span class="line"><span class="string">                  path=/;</span></span><br><span class="line"><span class="string">                  domain=.example.com;</span></span><br><span class="line"><span class="string">                  Secure;</span></span><br><span class="line"><span class="string">                  HttpOnly;</span></span><br><span class="line"><span class="string">                  SameSite=Lax&quot;</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>é…æ–™å</th>
<th>ä½œç”¨è¯´æ˜</th>
<th>ç±»æ¯”è§£é‡Š</th>
</tr>
</thead>
<tbody><tr>
<td>key&#x3D;value</td>
<td>å­˜å‚¨çš„é”®å€¼å¯¹</td>
<td>å‚¨ç‰©æŸœç¼–å·+å­˜æ”¾ç‰©å“</td>
</tr>
<tr>
<td>Expires</td>
<td>è¿‡æœŸæ—¶é—´ï¼ˆæ—¥æœŸæ ¼å¼ï¼‰</td>
<td>å°ç¥¨æœ‰æ•ˆæœŸ</td>
</tr>
<tr>
<td>Max-Age</td>
<td>å­˜æ´»ç§’æ•°ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰</td>
<td>å€’è®¡æ—¶è‡ªæ¯è£…ç½®</td>
</tr>
<tr>
<td>Domain</td>
<td>ç”Ÿæ•ˆåŸŸå</td>
<td>è¿é”è¶…å¸‚åˆ†åº—é€šç”¨åˆ¸</td>
</tr>
<tr>
<td>Path</td>
<td>URL è·¯å¾„é™åˆ¶</td>
<td>ä»…é™äºŒæ¥¼å‚¨ç‰©åŒºä½¿ç”¨</td>
</tr>
<tr>
<td>Secure</td>
<td>ä»… HTTPS ä¼ è¾“</td>
<td>é˜²çªƒå¬åŠ å¯†ä¼ è¾“</td>
</tr>
<tr>
<td>HttpOnly</td>
<td>ç¦æ­¢ JS è®¿é—®</td>
<td>å‚¨ç‰©æŸœç®¡ç†å‘˜ä¸“å±é’¥åŒ™</td>
</tr>
<tr>
<td>SameSite</td>
<td>è·¨ç«™å‘é€é™åˆ¶</td>
<td>é˜²æ­¢å…¶ä»–å•†åº—å†’é¢†çš„å®‰æ£€</td>
</tr>
</tbody></table>
<hr>
<h2 id="ä¸‰ã€å‰ç«¯å¨æˆ¿å®æ“æ‰‹å†Œ"><a href="#ä¸‰ã€å‰ç«¯å¨æˆ¿å®æ“æ‰‹å†Œ" class="headerlink" title="ä¸‰ã€å‰ç«¯å¨æˆ¿å®æ“æ‰‹å†Œ"></a>ä¸‰ã€å‰ç«¯å¨æˆ¿å®æ“æ‰‹å†Œ</h2><h3 id="3-1-çƒ¤åˆ¶æ–°é²œ-Cookie"><a href="#3-1-çƒ¤åˆ¶æ–°é²œ-Cookie" class="headerlink" title="3.1 çƒ¤åˆ¶æ–°é²œ Cookie"></a>3.1 çƒ¤åˆ¶æ–°é²œ Cookie</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŸºç¡€æ¬¾æ›²å¥‡</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;theme=dark&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è±ªåå®šåˆ¶ç‰ˆ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bakeCookie</span>(<span class="params">name, value, days</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  date.<span class="title function_">setTime</span>(date.<span class="title function_">getTime</span>() + days * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">`<span class="subst">$&#123;name&#125;</span>=<span class="subst">$&#123;value&#125;</span>; </span></span><br><span class="line"><span class="string">                    expires=<span class="subst">$&#123;date.toUTCString()&#125;</span>; </span></span><br><span class="line"><span class="string">                    path=/`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°çƒ¤ä¸€ä¸ª7å¤©è¿‡æœŸçš„é¥¼å¹²</span></span><br><span class="line"><span class="title function_">bakeCookie</span>(<span class="string">&quot;user_token&quot;</span>, <span class="string">&quot;abc123&quot;</span>, <span class="number">7</span>);</span><br></pre></td></tr></table></figure>

<h3 id="3-2-å“å°-Cookie-çš„å‘³é“"><a href="#3-2-å“å°-Cookie-çš„å‘³é“" class="headerlink" title="3.2 å“å° Cookie çš„å‘³é“"></a>3.2 å“å° Cookie çš„å‘³é“</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯»å–æ•´ç›’é¥¼å¹²</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="property">cookie</span>);</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š&quot;theme=dark; user_token=abc123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰¾å‡ºç‰¹å®šé¥¼å¹²</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getCookie</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="property">cookie</span></span><br><span class="line">    .<span class="title function_">split</span>(<span class="string">&quot;; &quot;</span>)</span><br><span class="line">    .<span class="title function_">find</span>(<span class="function">(<span class="params">row</span>) =&gt;</span> row.<span class="title function_">startsWith</span>(<span class="string">`<span class="subst">$&#123;name&#125;</span>=`</span>))</span><br><span class="line">    ?.<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getCookie</span>(<span class="string">&quot;theme&quot;</span>)); <span class="comment">// è¾“å‡ºï¼šdark</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-å¤„ç†è¿‡æœŸé¥¼å¹²"><a href="#3-3-å¤„ç†è¿‡æœŸé¥¼å¹²" class="headerlink" title="3.3 å¤„ç†è¿‡æœŸé¥¼å¹²"></a>3.3 å¤„ç†è¿‡æœŸé¥¼å¹²</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®©é¥¼å¹²ç«‹å³è¿‡æœŸ</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;user_token=; expires=Thu, 01 Jan 1970 00:00:00 GMT&quot;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å››ã€é£Ÿç”¨å®‰å…¨é¡»çŸ¥-âš ï¸"><a href="#å››ã€é£Ÿç”¨å®‰å…¨é¡»çŸ¥-âš ï¸" class="headerlink" title="å››ã€é£Ÿç”¨å®‰å…¨é¡»çŸ¥ âš ï¸"></a>å››ã€é£Ÿç”¨å®‰å…¨é¡»çŸ¥ âš ï¸</h2><ol>
<li><p>å®¹é‡è­¦æŠ¥</p>
<ul>
<li>å•ä¸ª Cookie â‰¤ 4KB</li>
<li>å•åŸŸå â‰¤ 20 ä¸ª Cookieï¼ˆå„æµè§ˆå™¨ä¸åŒï¼‰</li>
</ul>
</li>
<li><p>XSS é˜²å¾¡<br>æ•æ„Ÿ Cookie åŠ¡å¿…æ·»åŠ  HttpOnly å±æ€§ï¼Œå°±åƒæŠŠè´µé‡ç‰©å“é”è¿›ä¿é™©æŸœ</p>
</li>
<li><p>CSRF é˜²æŠ¤<br>ä½¿ç”¨ SameSite&#x3D;Strict&#x2F;Laxï¼Œç›¸å½“äºç»™å‚¨ç‰©æŸœåŠ æŒ‡çº¹é”</p>
</li>
<li><p>æ•æ„Ÿä¿¡æ¯ç¦åŒº s<br>âŒ æ°¸è¿œä¸è¦åœ¨ Cookie ä¸­å­˜å‚¨ï¼š</p>
<ul>
<li>ç”¨æˆ·å¯†ç </li>
<li>ä¿¡ç”¨å¡å·</li>
<li>JWT ä»¤ç‰Œçš„è£¸å¥”ç‰ˆæœ¬</li>
</ul>
</li>
</ol>
<hr>
<h2 id="äº”ã€ä»€ä¹ˆæ—¶å€™è¯¥æ¢é›¶é£Ÿï¼ŸğŸª-â†”ï¸-ğŸ¥¡"><a href="#äº”ã€ä»€ä¹ˆæ—¶å€™è¯¥æ¢é›¶é£Ÿï¼ŸğŸª-â†”ï¸-ğŸ¥¡" class="headerlink" title="äº”ã€ä»€ä¹ˆæ—¶å€™è¯¥æ¢é›¶é£Ÿï¼ŸğŸª â†”ï¸ ğŸ¥¡"></a>äº”ã€ä»€ä¹ˆæ—¶å€™è¯¥æ¢é›¶é£Ÿï¼ŸğŸª â†”ï¸ ğŸ¥¡</h2><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>Cookie</th>
<th>Web Storage</th>
</tr>
</thead>
<tbody><tr>
<td>éœ€è¦è‡ªåŠ¨è¿‡æœŸ</td>
<td>âœ… åŸç”Ÿæ”¯æŒ</td>
<td>âŒ éœ€æ‰‹åŠ¨æ¸…é™¤</td>
</tr>
<tr>
<td>éœ€è¦æœåŠ¡ç«¯è¯»å–</td>
<td>âœ… è‡ªåŠ¨æºå¸¦</td>
<td>âŒ éœ€ä¸»åŠ¨å‘é€</td>
</tr>
<tr>
<td>å­˜å‚¨å¤§é‡æ•°æ®</td>
<td>âŒ å®¹é‡å°</td>
<td>âœ… 5MB+</td>
</tr>
<tr>
<td>æ•æ„Ÿæ“ä½œéªŒè¯</td>
<td>âœ… HttpOnly é˜²æŠ¤</td>
<td>âŒ æš´éœ²åœ¨ JS ç¯å¢ƒ</td>
</tr>
</tbody></table>
<hr>
<h2 id="å…­ã€æœ€ä½³é£Ÿç”¨å§¿åŠ¿-âœ¨"><a href="#å…­ã€æœ€ä½³é£Ÿç”¨å§¿åŠ¿-âœ¨" class="headerlink" title="å…­ã€æœ€ä½³é£Ÿç”¨å§¿åŠ¿ âœ¨"></a>å…­ã€æœ€ä½³é£Ÿç”¨å§¿åŠ¿ âœ¨</h2><ul>
<li>ç»™ Cookie ç©¿ä¸Š HTTPS çš„é˜²å¼¹è¡£ï¼ˆSecure å±æ€§ï¼‰</li>
<li>åƒå¯¹å¾…å¯†ç ä¸€æ ·è®¾ç½® HttpOnly</li>
<li>ä½¿ç”¨ç¼–ç å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">encodeURIComponent</span>(<span class="string">&quot;user=å¼ ä¸‰&amp;age=20&quot;</span>);</span><br><span class="line"><span class="comment">// â†’ &quot;user%3D%E5%BC%A0%E4%B8%89%26age%3D20&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>å®šæœŸæ£€æŸ¥ Cookie çš„æœ‰æ•ˆæœŸï¼Œå°±åƒæŸ¥çœ‹é£Ÿå“ä¿è´¨æœŸ</li>
</ul>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>Webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>Webå®‰å…¨</tag>
        <tag>cookieçš„é£Ÿç”¨æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹å†™ Promise å®ç°æŒ‡å—ï¼šä»è§„èŒƒåˆ°ä»£ç å®è·µ</title>
    <url>/2022/05/02/ES6-Promise/</url>
    <content><![CDATA[<h2 id="ä¸€-Promise-A-è§„èŒƒä¸éœ€æ±‚èƒŒæ™¯"><a href="#ä¸€-Promise-A-è§„èŒƒä¸éœ€æ±‚èƒŒæ™¯" class="headerlink" title="ä¸€. Promise&#x2F;A+ è§„èŒƒä¸éœ€æ±‚èƒŒæ™¯"></a>ä¸€. Promise&#x2F;A+ è§„èŒƒä¸éœ€æ±‚èƒŒæ™¯</h2><h3 id="éœ€æ±‚èƒŒæ™¯"><a href="#éœ€æ±‚èƒŒæ™¯" class="headerlink" title="éœ€æ±‚èƒŒæ™¯"></a>éœ€æ±‚èƒŒæ™¯</h3><p>åœ¨ JavaScript çš„å¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œä¼ ç»Ÿçš„å›è°ƒå‡½æ•°å­˜åœ¨ â€œå›è°ƒåœ°ç‹±â€ï¼ˆå±‚å±‚åµŒå¥—éš¾ä»¥ç»´æŠ¤ï¼‰å’Œ â€œé”™è¯¯å¤„ç†å›°éš¾â€ çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;1.txt&quot;</span>, <span class="function">(<span class="params">err, data1</span>) =&gt;</span> &#123;</span><br><span class="line">  fs.<span class="title function_">readFile</span>(data1, <span class="function">(<span class="params">err, data2</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">readFile</span>(data2, <span class="function">(<span class="params">err, data3</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/* ... */</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Promise åº”è¿è€Œç”Ÿï¼Œé€šè¿‡é“¾å¼è°ƒç”¨ .then() å°†åµŒå¥—è½¬ä¸ºçº¿æ€§ç»“æ„ï¼ŒåŒæ—¶æä¾›ç»Ÿä¸€çš„é”™è¯¯æ•è·æœºåˆ¶</p>
<h3 id="Promise-A-è§„èŒƒæ ¸å¿ƒ"><a href="#Promise-A-è§„èŒƒæ ¸å¿ƒ" class="headerlink" title="Promise&#x2F;A+ è§„èŒƒæ ¸å¿ƒ"></a>Promise&#x2F;A+ è§„èŒƒæ ¸å¿ƒ</h3><h3 id="1-ä¸‰ç§çŠ¶æ€"><a href="#1-ä¸‰ç§çŠ¶æ€" class="headerlink" title="1. ä¸‰ç§çŠ¶æ€"></a>1. ä¸‰ç§çŠ¶æ€</h3><ul>
<li><strong>Pending</strong>ï¼šåˆå§‹çŠ¶æ€ï¼Œå¯è½¬ä¸º Fulfilled æˆ– Rejectedã€‚</li>
<li><strong>Fulfilled</strong>ï¼šæˆåŠŸæ€ï¼Œå¿…é¡»æœ‰ä¸å¯å˜çš„å€¼ï¼ˆvalueï¼‰ã€‚</li>
<li><strong>Rejected</strong>ï¼šå¤±è´¥æ€ï¼Œå¿…é¡»æœ‰ä¸å¯å˜çš„åŸå› ï¼ˆreasonï¼‰ã€‚</li>
</ul>
<h3 id="2-then-æ–¹æ³•è¡Œä¸º"><a href="#2-then-æ–¹æ³•è¡Œä¸º" class="headerlink" title="2. then æ–¹æ³•è¡Œä¸º"></a>2. then æ–¹æ³•è¡Œä¸º</h3><ul>
<li>æ¥å— <code>onFulfilled</code> å’Œ <code>onRejected</code> ä¸¤ä¸ªå›è°ƒï¼ˆå¯é€‰ï¼‰ã€‚</li>
<li>å›è°ƒå¿…é¡»å¼‚æ­¥æ‰§è¡Œï¼ˆå¦‚ <code>setTimeout</code> æˆ–å¾®ä»»åŠ¡ï¼‰ã€‚</li>
<li>å¯è¢«å¤šæ¬¡è°ƒç”¨ï¼ŒæŒ‰æ³¨å†Œé¡ºåºæ‰§è¡Œã€‚</li>
<li>å¿…é¡»è¿”å›æ–° Promiseï¼Œæ”¯æŒé“¾å¼è°ƒç”¨ã€‚</li>
</ul>
<h3 id="3-è§£å†³è¿‡ç¨‹ï¼ˆResolution-Procedureï¼‰"><a href="#3-è§£å†³è¿‡ç¨‹ï¼ˆResolution-Procedureï¼‰" class="headerlink" title="3. è§£å†³è¿‡ç¨‹ï¼ˆResolution Procedureï¼‰"></a>3. è§£å†³è¿‡ç¨‹ï¼ˆResolution Procedureï¼‰</h3><ul>
<li>è‹¥å›è°ƒè¿”å›å€¼æ˜¯ Promiseï¼Œåˆ™ç­‰å¾…å…¶çŠ¶æ€ï¼›è‹¥æ˜¯æ™®é€šå€¼ï¼Œåˆ™ç›´æ¥ä¼ é€’ã€‚</li>
<li>å¤„ç†å¾ªç¯å¼•ç”¨ï¼ˆå¦‚è¿”å›è‡ªèº«ä¼šæŠ¥é”™ï¼‰ã€‚</li>
</ul>
<h2 id="äºŒ-æ‰‹å†™-Promise-å®ç°æ­¥éª¤"><a href="#äºŒ-æ‰‹å†™-Promise-å®ç°æ­¥éª¤" class="headerlink" title="äºŒ. æ‰‹å†™ Promise å®ç°æ­¥éª¤"></a>äºŒ. æ‰‹å†™ Promise å®ç°æ­¥éª¤</h2><h3 id="Step-1ï¼šåŸºæœ¬æ¡†æ¶ä¸çŠ¶æ€ç®¡ç†"><a href="#Step-1ï¼šåŸºæœ¬æ¡†æ¶ä¸çŠ¶æ€ç®¡ç†" class="headerlink" title="Step 1ï¼šåŸºæœ¬æ¡†æ¶ä¸çŠ¶æ€ç®¡ç†"></a>Step 1ï¼šåŸºæœ¬æ¡†æ¶ä¸çŠ¶æ€ç®¡ç†</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;pending&quot;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = []; <span class="comment">// æˆåŠŸå›è°ƒé˜Ÿåˆ—</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = []; <span class="comment">// å¤±è´¥å›è°ƒé˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;fulfilled&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>()); <span class="comment">// è§¦å‘å›è°ƒ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;rejected&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="title function_">executor</span>(resolve, reject); <span class="comment">// ç«‹å³æ‰§è¡Œ</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(e); <span class="comment">// æ•è·åŒæ­¥é”™è¯¯</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Step-2ï¼šå®ç°-then-æ–¹æ³•"><a href="#Step-2ï¼šå®ç°-then-æ–¹æ³•" class="headerlink" title="Step 2ï¼šå®ç° then æ–¹æ³•"></a>Step 2ï¼šå®ç° then æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">  <span class="comment">// å¤„ç†å€¼ç©¿é€ï¼ˆå‚æ•°éå‡½æ•°æ—¶æä¾›é»˜è®¤å€¼ï¼‰</span></span><br><span class="line">  onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&#x27;function&#x27;</span> ? onFulfilled : <span class="function"><span class="params">v</span> =&gt;</span> v;</span><br><span class="line">  onRejected = <span class="keyword">typeof</span> onRejected === <span class="string">&#x27;function&#x27;</span> ? onRejected : <span class="function"><span class="params">err</span> =&gt;</span> &#123; <span class="keyword">throw</span> err; &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> promise2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">handleFulfilled</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// ç¡®ä¿å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="title function_">reject</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç±»ä¼¼å¤„ç† handleRejected...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&#x27;fulfilled&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">handleFulfilled</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&#x27;rejected&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">handleRejected</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// pending çŠ¶æ€ï¼Œå­˜å…¥é˜Ÿåˆ—</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(handleFulfilled);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(handleRejected);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> promise2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Step-3ï¼šè§£å†³è¿‡ç¨‹ä¸é“¾å¼è°ƒç”¨"><a href="#Step-3ï¼šè§£å†³è¿‡ç¨‹ä¸é“¾å¼è°ƒç”¨" class="headerlink" title="Step 3ï¼šè§£å†³è¿‡ç¨‹ä¸é“¾å¼è°ƒç”¨"></a>Step 3ï¼šè§£å†³è¿‡ç¨‹ä¸é“¾å¼è°ƒç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;å¾ªç¯å¼•ç”¨&#x27;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">    x.<span class="title function_">then</span>(resolve, reject); <span class="comment">// ç­‰å¾… x çš„çŠ¶æ€</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(x); <span class="comment">// æ™®é€šå€¼ç›´æ¥ä¼ é€’</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Step-4ï¼šé”™è¯¯å†’æ³¡ä¸-catch-æ–¹æ³•"><a href="#Step-4ï¼šé”™è¯¯å†’æ³¡ä¸-catch-æ–¹æ³•" class="headerlink" title="Step 4ï¼šé”™è¯¯å†’æ³¡ä¸ catch æ–¹æ³•"></a>Step 4ï¼šé”™è¯¯å†’æ³¡ä¸ catch æ–¹æ³•</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å®Œæ•´çš„æ‰‹å†™ä»£ç "><a href="#å®Œæ•´çš„æ‰‹å†™ä»£ç " class="headerlink" title="å®Œæ•´çš„æ‰‹å†™ä»£ç "></a>å®Œæ•´çš„æ‰‹å†™ä»£ç </h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰Promiseç±»ï¼Œå®ç°äº†åŸºæœ¬çš„PromiseåŠŸèƒ½ï¼ŒåŒ…æ‹¬é“¾å¼è°ƒç”¨ã€å¼‚æ­¥å¤„ç†å’Œé”™è¯¯æ•è·ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPromise</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªæ‰§è¡Œå™¨å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; <span class="variable">executor</span> - æ‰§è¡Œå™¨å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šresolveå’Œrejectã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">executor</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;pending&quot;</span>; <span class="comment">// åˆå§‹çŠ¶æ€ï¼ŒPromiseçš„åˆå§‹çŠ¶æ€ä¸ºpending</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="literal">undefined</span>; <span class="comment">// æˆåŠŸå€¼ï¼Œå½“PromiseçŠ¶æ€å˜ä¸ºfulfilledæ—¶ï¼Œå­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">reason</span> = <span class="literal">undefined</span>; <span class="comment">// å¤±è´¥åŸå› ï¼Œå½“PromiseçŠ¶æ€å˜ä¸ºrejectedæ—¶ï¼Œå­˜å‚¨å¤±è´¥çš„åŸå› </span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span> = []; <span class="comment">// æˆåŠŸå›è°ƒé˜Ÿåˆ—ï¼Œå­˜å‚¨åœ¨PromiseçŠ¶æ€å˜ä¸ºfulfilledæ—¶éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span> = []; <span class="comment">// å¤±è´¥å›è°ƒé˜Ÿåˆ—ï¼Œå­˜å‚¨åœ¨PromiseçŠ¶æ€å˜ä¸ºrejectedæ—¶éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£å†³å‡½æ•°ï¼Œç”¨äºå°†PromiseçŠ¶æ€ä»pendingå˜ä¸ºfulfilledã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; <span class="variable">value</span> - æˆåŠŸçš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">resolve</span> = (<span class="params">value</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// åªæœ‰å½“PromiseçŠ¶æ€ä¸ºpendingæ—¶ï¼Œæ‰èƒ½å°†çŠ¶æ€å˜ä¸ºfulfilled</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;fulfilled&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ‰€æœ‰æˆåŠŸå›è°ƒ</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹’ç»å‡½æ•°ï¼Œç”¨äºå°†PromiseçŠ¶æ€ä»pendingå˜ä¸ºrejectedã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; <span class="variable">reason</span> - å¤±è´¥çš„åŸå› ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">reject</span> = (<span class="params">reason</span>) =&gt; &#123;</span><br><span class="line">      <span class="comment">// åªæœ‰å½“PromiseçŠ¶æ€ä¸ºpendingæ—¶ï¼Œæ‰èƒ½å°†çŠ¶æ€å˜ä¸ºrejected</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">status</span> = <span class="string">&quot;rejected&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reason</span> = reason;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ‰€æœ‰å¤±è´¥å›è°ƒ</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="title function_">fn</span>());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// ç«‹å³æ‰§è¡Œæ‰§è¡Œå™¨</span></span><br><span class="line">      <span class="title function_">executor</span>(resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// æ•è·åŒæ­¥é”™è¯¯</span></span><br><span class="line">      <span class="title function_">reject</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä¸ºPromiseå®ä¾‹æ·»åŠ æˆåŠŸå’Œå¤±è´¥å›è°ƒã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; <span class="variable">onFulfilled</span> - æˆåŠŸå›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; <span class="variable">onRejected</span> - å¤±è´¥å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">MyPromise</span>&#125; - è¿”å›ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼Œç”¨äºé“¾å¼è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å€¼ç©¿é€ï¼Œé»˜è®¤å‡½æ•°</span></span><br><span class="line">    onFulfilled = <span class="keyword">typeof</span> onFulfilled === <span class="string">&quot;function&quot;</span> ? onFulfilled : <span class="function">(<span class="params">v</span>) =&gt;</span> v;</span><br><span class="line">    onRejected =</span><br><span class="line">      <span class="keyword">typeof</span> onRejected === <span class="string">&quot;function&quot;</span></span><br><span class="line">        ? onRejected</span><br><span class="line">        : <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> promise2 = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * å¤„ç†æˆåŠŸå›è°ƒçš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">handleFulfilled</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// ç¡®ä¿å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> x = <span class="title function_">onFulfilled</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">            <span class="comment">// è§£æPromiseç»“æœ</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * å¤„ç†å¤±è´¥å›è°ƒçš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">handleRejected</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> x = <span class="title function_">onRejected</span>(<span class="variable language_">this</span>.<span class="property">reason</span>);</span><br><span class="line">            <span class="comment">// è§£æPromiseç»“æœ</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">resolvePromise</span>(promise2, x, resolve, reject);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="title function_">reject</span>(e);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;fulfilled&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">handleFulfilled</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">status</span> === <span class="string">&quot;rejected&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">handleRejected</span>();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// pendingçŠ¶æ€ï¼Œå­˜å…¥å›è°ƒé˜Ÿåˆ—</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onFulfilledCallbacks</span>.<span class="title function_">push</span>(handleFulfilled);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">onRejectedCallbacks</span>.<span class="title function_">push</span>(handleRejected);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise2; <span class="comment">// è¿”å›æ–°Promiseå®ç°é“¾å¼è°ƒç”¨</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è§£æPromiseç»“æœï¼Œå¤„ç†å¾ªç¯å¼•ç”¨å’ŒåµŒå¥—Promiseã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">MyPromise</span>&#125; <span class="variable">promise2</span> - æ–°çš„Promiseå®ä¾‹ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; <span class="variable">x</span> - å›è°ƒå‡½æ•°çš„è¿”å›å€¼ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; <span class="variable">resolve</span> - è§£å†³å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; <span class="variable">reject</span> - æ‹’ç»å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) &#123;</span><br><span class="line">    <span class="comment">// é˜²æ­¢ const p = new Promise.then(() =&gt; p) ä¼šå¯¼è‡´æ­»å¾ªç¯</span></span><br><span class="line">    <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">      <span class="comment">// å¾ªç¯å¼•ç”¨æ£€æµ‹</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Chaining cycle detected&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†Promiseå¯¹è±¡ ï¼ˆå½“then è¿”å›çš„æ˜¯promiseï¼Œ</span></span><br><span class="line">    <span class="comment">// å¦‚ï¼šæ­¤å¤„ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œæ—¶ï¼Œä¸ºäº†ä¿è¯åä¸€ä¸ªthenèƒ½æ¥å—åˆ°æ­¤å¤„å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼ï¼Œ</span></span><br><span class="line">    <span class="comment">// å¦‚ä¸å¤„ç†åä¸€ä¸ªthenæ¥å—çš„ä¼šæ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿›è€Œæ— æ³•å®ç°é“¾å¼è°ƒç”¨ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">      x.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ™®é€šå€¼ç›´æ¥resolve</span></span><br><span class="line">      <span class="title function_">resolve</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ä¸ºPromiseå®ä¾‹æ·»åŠ å¤±è´¥å›è°ƒã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">function</span>&#125; <span class="variable">onRejected</span> - å¤±è´¥å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">MyPromise</span>&#125; - è¿”å›ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼Œç”¨äºé“¾å¼è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">catch</span>(onRejected) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰-æµ‹è¯•ç”¨ä¾‹ä¸éªŒè¯"><a href="#ä¸‰-æµ‹è¯•ç”¨ä¾‹ä¸éªŒè¯" class="headerlink" title="ä¸‰. æµ‹è¯•ç”¨ä¾‹ä¸éªŒè¯"></a>ä¸‰. æµ‹è¯•ç”¨ä¾‹ä¸éªŒè¯</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•é“¾å¼è°ƒç”¨ä¸å¼‚æ­¥</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 1ç§’åè¾“å‡º: success</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(res + <span class="string">&quot; again&quot;</span>));</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res)); <span class="comment">// è¾“å‡º: success again</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•é”™è¯¯æ•è·</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)); <span class="comment">// æ•è·åŒæ­¥é”™è¯¯</span></span><br></pre></td></tr></table></figure>

<h2 id="å››-æ‰©å±•ä¸æ€»ç»“"><a href="#å››-æ‰©å±•ä¸æ€»ç»“" class="headerlink" title="å››. æ‰©å±•ä¸æ€»ç»“"></a>å››. æ‰©å±•ä¸æ€»ç»“</h2><h3 id="æ‰©å±•åŠŸèƒ½"><a href="#æ‰©å±•åŠŸèƒ½" class="headerlink" title="æ‰©å±•åŠŸèƒ½"></a>æ‰©å±•åŠŸèƒ½</h3><ul>
<li><p>é™æ€æ–¹æ³•ï¼šå®ç° Promise.allï¼ˆæ‰€æœ‰æˆåŠŸï¼‰ã€Promise.raceï¼ˆç«é€Ÿï¼‰11ã€‚</p>
</li>
<li><p>å¾®ä»»åŠ¡ä¼˜åŒ–ï¼šç”¨ MutationObserver æ›¿ä»£ setTimeout å®ç°æ›´é«˜æ•ˆçš„å¼‚æ­¥è°ƒåº¦ã€‚</p>
</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Promise é€šè¿‡çŠ¶æ€æœºã€å›è°ƒé˜Ÿåˆ—å’Œé“¾å¼è°ƒç”¨ï¼Œå°†å¼‚æ­¥é€»è¾‘çº¿æ€§åŒ–ã€‚æ‰‹å†™å®ç°éœ€ä¸¥æ ¼éµå¾ª Promise&#x2F;A+ è§„èŒƒï¼Œæ ¸å¿ƒåœ¨äº then çš„å¼‚æ­¥å¤„ç†å’Œè§£å†³è¿‡ç¨‹çš„é€’å½’è§£æã€‚ç†è§£è¿™ä¸€æœºåˆ¶æœ‰åŠ©äºæŒæ¡ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„ç²¾é«“</p>
<h2 id="è¡¥å……-ï¼ˆè¯¦è§£-æµ‹è¯•ç”¨ä¾‹-ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼‰"><a href="#è¡¥å……-ï¼ˆè¯¦è§£-æµ‹è¯•ç”¨ä¾‹-ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼‰" class="headerlink" title="è¡¥å…… ï¼ˆè¯¦è§£ æµ‹è¯•ç”¨ä¾‹ ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼‰"></a>è¡¥å…… ï¼ˆè¯¦è§£ æµ‹è¯•ç”¨ä¾‹ ä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼‰</h2><h3 id="æµ‹è¯•ç”¨ä¾‹ï¼š"><a href="#æµ‹è¯•ç”¨ä¾‹ï¼š" class="headerlink" title="æµ‹è¯•ç”¨ä¾‹ï¼š"></a>æµ‹è¯•ç”¨ä¾‹ï¼š</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 1ç§’åè¾“å‡º: success</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(res + <span class="string">&quot; again&quot;</span>));</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res)); <span class="comment">// è¾“å‡º: success again</span></span><br></pre></td></tr></table></figure>

<h3 id="1-Promise-åˆå§‹åŒ–"><a href="#1-Promise-åˆå§‹åŒ–" class="headerlink" title="1. Promise åˆå§‹åŒ–"></a>1. Promise åˆå§‹åŒ–</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>åˆ›å»º MyPromise å®ä¾‹ï¼Œç«‹å³æ‰§è¡Œ executor å‡½æ•°</li>
<li>é‡åˆ° setTimeout ï¼Œå°†å›è°ƒå‡½æ•°æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œ1 ç§’åæ‰§è¡Œ</li>
<li>æ­¤æ—¶ Promise çŠ¶æ€ä¸º pending ï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œåç»­ä»£ç </li>
</ol>
<h2 id="2-ç¬¬ä¸€ä¸ª-then-æ–¹æ³•è°ƒç”¨"><a href="#2-ç¬¬ä¸€ä¸ª-then-æ–¹æ³•è°ƒç”¨" class="headerlink" title="2. ç¬¬ä¸€ä¸ª then æ–¹æ³•è°ƒç”¨"></a>2. ç¬¬ä¸€ä¸ª then æ–¹æ³•è°ƒç”¨</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(res + <span class="string">&quot; again&quot;</span>));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>è°ƒç”¨ then æ–¹æ³•æ—¶ Promise ä»å¤„äº pending çŠ¶æ€</li>
<li>å°†å›è°ƒå‡½æ•° (res) &#x3D;&gt; { consoleâ€¦ } å­˜å…¥ onFulfilledCallbacks é˜Ÿåˆ—</li>
<li>then æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise (promise2)</li>
</ol>
<h2 id="3-ç¬¬äºŒä¸ª-then-æ–¹æ³•è°ƒç”¨"><a href="#3-ç¬¬äºŒä¸ª-then-æ–¹æ³•è°ƒç”¨" class="headerlink" title="3. ç¬¬äºŒä¸ª then æ–¹æ³•è°ƒç”¨"></a>3. ç¬¬äºŒä¸ª then æ–¹æ³•è°ƒç”¨</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(res));</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>ç»§ç»­åœ¨ promise2 ä¸Šè°ƒç”¨ then</li>
<li>ç”±äº promise2 ä¹Ÿå¤„äº pending çŠ¶æ€ï¼Œå°†å›è°ƒå­˜å…¥å®ƒçš„ onFulfilledCallbacks</li>
<li>è¿”å›ç¬¬ä¸‰ä¸ª Promise (promise3)</li>
</ol>
<h2 id="4-1-ç§’å-setTimeout-å›è°ƒæ‰§è¡Œ"><a href="#4-1-ç§’å-setTimeout-å›è°ƒæ‰§è¡Œ" class="headerlink" title="4. 1 ç§’å setTimeout å›è°ƒæ‰§è¡Œ"></a>4. 1 ç§’å setTimeout å›è°ƒæ‰§è¡Œ</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">() =&gt; <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>è°ƒç”¨ resolve(â€œsuccessâ€) ï¼Œå°†ç¬¬ä¸€ä¸ª Promise çŠ¶æ€æ”¹ä¸º fulfilled</li>
<li>è®¾ç½® this.value &#x3D; â€œsuccessâ€</li>
<li>æ‰§è¡Œ onFulfilledCallbacks ä¸­çš„å›è°ƒï¼ˆç¬¬ä¸€ä¸ª then çš„å›è°ƒï¼‰</li>
</ol>
<h2 id="5-æ‰§è¡Œç¬¬ä¸€ä¸ª-then-çš„å›è°ƒ"><a href="#5-æ‰§è¡Œç¬¬ä¸€ä¸ª-then-çš„å›è°ƒ" class="headerlink" title="5. æ‰§è¡Œç¬¬ä¸€ä¸ª then çš„å›è°ƒ"></a>5. æ‰§è¡Œç¬¬ä¸€ä¸ª then çš„å›è°ƒ</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(res) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// è¾“å‡º &quot;success&quot;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>åˆ›å»ºæ–°çš„ Promise (promise4)ï¼Œç«‹å³æ‰§è¡Œå…¶ executor</li>
<li>åŒæ­¥è°ƒç”¨ resolve(â€œsuccess againâ€) ï¼Œpromise4 çŠ¶æ€å˜ä¸º fulfilled</li>
<li>è¿™ä¸ªè¿”å›å€¼ä¼šé€šè¿‡ resolvePromise ä¼ é€’ç»™ promise2</li>
</ol>
<h2 id="6-æ‰§è¡Œç¬¬äºŒä¸ª-then-çš„å›è°ƒ"><a href="#6-æ‰§è¡Œç¬¬äºŒä¸ª-then-çš„å›è°ƒ" class="headerlink" title="6. æ‰§è¡Œç¬¬äºŒä¸ª then çš„å›è°ƒ"></a>6. æ‰§è¡Œç¬¬äºŒä¸ª then çš„å›è°ƒ</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(res) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// è¾“å‡º &quot;success again&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>promise2 çš„ resolvePromise å¤„ç†è¿”å›çš„ promise4</li>
<li>ç”±äº promise4 å·²ç»æ˜¯ fulfilled çŠ¶æ€ï¼Œç«‹å³æ‰§è¡Œç¬¬äºŒä¸ª then çš„å›è°ƒ</li>
<li>è¾“å‡ºæ‹¼æ¥åçš„å­—ç¬¦ä¸² â€œsuccess againâ€</li>
</ol>
<h2 id="å®Œæ•´æ‰§è¡Œæ—¶åºå›¾"><a href="#å®Œæ•´æ‰§è¡Œæ—¶åºå›¾" class="headerlink" title="å®Œæ•´æ‰§è¡Œæ—¶åºå›¾"></a>å®Œæ•´æ‰§è¡Œæ—¶åºå›¾</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸»çº¿ç¨‹:</span><br><span class="line">1. åˆ›å»º Promise â†’ è®¾ç½® setTimeout â†’ æ³¨å†Œ then1 â†’ æ³¨å†Œ then2</span><br><span class="line">   (æ‰€æœ‰ then å›è°ƒéƒ½å­˜å…¥é˜Ÿåˆ—)</span><br><span class="line"></span><br><span class="line">å®ä»»åŠ¡é˜Ÿåˆ—:</span><br><span class="line">[ 1ç§’å:</span><br><span class="line">  1. æ‰§è¡Œ setTimeout å›è°ƒ â†’ resolve â†’ è§¦å‘ then1 å›è°ƒ</span><br><span class="line">  2. then1 è¿”å›æ–° Promise â†’ è§¦å‘ then2 å›è°ƒ</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="å…³é”®ç‚¹è¯´æ˜"><a href="#å…³é”®ç‚¹è¯´æ˜" class="headerlink" title="å…³é”®ç‚¹è¯´æ˜"></a>å…³é”®ç‚¹è¯´æ˜</h2><ol>
<li>å¼‚æ­¥æœºåˆ¶ ï¼šé€šè¿‡ setTimeout å®ç°çœŸæ­£çš„å¼‚æ­¥ï¼Œç¬¦åˆ Promise&#x2F;A+ è§„èŒƒ</li>
<li>é“¾å¼è°ƒç”¨ ï¼šæ¯ä¸ª then éƒ½è¿”å›æ–° Promiseï¼Œå½¢æˆè°ƒç”¨é“¾</li>
<li>å€¼ä¼ é€’ ï¼šå‰ä¸€ä¸ª then çš„è¿”å›å€¼ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ä¸‹ä¸€ä¸ª then</li>
<li>çŠ¶æ€ç®¡ç† ï¼š<ul>
<li>åˆå§‹ Promise ä» pending â†’ fulfilled</li>
<li>then è¿”å›çš„æ–° Promise æ ¹æ®å›è°ƒæ‰§è¡Œç»“æœæ”¹å˜çŠ¶æ€</li>
</ul>
</li>
</ol>
<h2 id="è¡¥å……ï¼š"><a href="#è¡¥å……ï¼š" class="headerlink" title="è¡¥å……ï¼š"></a>è¡¥å……ï¼š</h2><h3 id="1-resolvePromise-çš„ä½œç”¨"><a href="#1-resolvePromise-çš„ä½œç”¨" class="headerlink" title="1. resolvePromise çš„ä½œç”¨"></a>1. resolvePromise çš„ä½œç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">resolvePromise</span>(<span class="params">promise2, x, resolve, reject</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. å¾ªç¯å¼•ç”¨æ£€æµ‹</span></span><br><span class="line">  <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Chaining cycle detected&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. å¤„ç†è¿”å›çš„Promiseå¯¹è±¡</span></span><br><span class="line">  <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">    x.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 3. å¤„ç†æ™®é€šå€¼</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¯¦ç»†è§£æï¼š"><a href="#è¯¦ç»†è§£æï¼š" class="headerlink" title="è¯¦ç»†è§£æï¼š"></a>è¯¦ç»†è§£æï¼š</h4><ol>
<li><p>å¾ªç¯å¼•ç”¨æ£€æµ‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Chaining cycle detected&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>é˜²æ­¢ç±»ä¼¼ promise.then(() &#x3D;&gt; promise) çš„å¾ªç¯å¼•ç”¨</li>
<li>å¦‚æœæ£€æµ‹åˆ°å¾ªç¯å¼•ç”¨ï¼Œç›´æ¥ reject ä¸€ä¸ª TypeError</li>
</ul>
</li>
<li><p>å¤„ç† Promise å¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="title class_">MyPromise</span>) &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„xæ˜¯ä¸Šä¸€ä¸ªthençš„è¿”å›å€¼,æ­¤å¤„ä¸ºä¸€ä¸ªPromiseï¼Œä¸ºäº†ç¡®ä¿ä¸‹ä¸€ä¸ªthenèƒ½æ¥å—åˆ°æ­¤å¤„å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼ï¼Œ</span></span><br><span class="line">  <span class="comment">// éœ€è¦å°†å¤–å±‚çš„Promiseå¯¹è±¡çš„resoleveå’Œrejectä¼ å…¥ï¼Œè¿›è€Œæ•è·æ­¤å¤„å¼‚æ­¥æ“ä½œçš„è¿”å›å€¼,ä¾¿äºä¼ é€’ç»™ä¸‹ä¸€ä¸ªthen</span></span><br><span class="line">  x.<span class="title function_">then</span>(resolve, reject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“å›è°ƒå‡½æ•°è¿”å›çš„æ˜¯å¦ä¸€ä¸ª Promise æ—¶ï¼ˆå¦‚ return new MyPromise(â€¦) ï¼‰</li>
<li>ä¼šç­‰å¾…è¿™ä¸ª Promise å®Œæˆï¼Œç„¶åå°†å…¶ç»“æœä¼ é€’ç»™å¤–å±‚ Promise</li>
<li>ä¾‹å¦‚ï¼š return new MyPromise(resolve &#x3D;&gt; resolve(42)) ä¼šç­‰å¾…å†…éƒ¨ Promise å®Œæˆ</li>
</ul>
</li>
<li><p>å¤„ç†æ™®é€šå€¼</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“å›è°ƒå‡½æ•°è¿”å›é Promise å€¼æ—¶ï¼ˆå¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å¯¹è±¡ç­‰ï¼‰</li>
<li>ç›´æ¥å°†è¯¥å€¼ä½œä¸ºå¤–å±‚ Promise çš„è§£å†³å€¼</li>
<li>ä¾‹å¦‚ï¼š return 42 ä¼šç›´æ¥ resolve(42)</li>
</ul>
</li>
</ol>
<h4 id="å…³é”®ä½œç”¨ï¼š"><a href="#å…³é”®ä½œç”¨ï¼š" class="headerlink" title="å…³é”®ä½œç”¨ï¼š"></a>å…³é”®ä½œç”¨ï¼š</h4><ol>
<li>å®ç°é“¾å¼è°ƒç”¨çš„æ ¸å¿ƒ ï¼šå¤„ç† then æ–¹æ³•å›è°ƒå‡½æ•°çš„è¿”å›å€¼</li>
<li>æ”¯æŒ Promise åµŒå¥— ï¼šèƒ½å¤Ÿæ­£ç¡®å¤„ç†è¿”å› Promise çš„æƒ…å†µ</li>
<li>ç±»å‹å®‰å…¨ ï¼šé˜²æ­¢å¾ªç¯å¼•ç”¨å¯¼è‡´çš„æ— é™é€’å½’</li>
</ol>
<h4 id="å®é™…åº”ç”¨ç¤ºä¾‹ï¼š"><a href="#å®é™…åº”ç”¨ç¤ºä¾‹ï¼š" class="headerlink" title="å®é™…åº”ç”¨ç¤ºä¾‹ï¼š"></a>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> <span class="title function_">r</span>(res + <span class="number">1</span>)); <span class="comment">// è¿”å›Promise</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">return</span> res + <span class="number">1</span>; <span class="comment">// è¿”å›æ™®é€šå€¼</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ç¡®ä¿äº† Promise é“¾å¼è°ƒç”¨æ—¶ï¼Œæ— è®ºå›è°ƒå‡½æ•°è¿”å›çš„æ˜¯æ™®é€šå€¼è¿˜æ˜¯ Promise å¯¹è±¡ï¼Œéƒ½èƒ½æ­£ç¡®ä¼ é€’å’Œå¤„ç†å€¼ã€‚</p>
<h3 id="2-onFulfilled-å’Œ-onRejected-ä¸ºä»€ä¹ˆå¿…é¡»å¼‚æ­¥æ‰§è¡Œ"><a href="#2-onFulfilled-å’Œ-onRejected-ä¸ºä»€ä¹ˆå¿…é¡»å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="2. onFulfilled å’Œ onRejected ä¸ºä»€ä¹ˆå¿…é¡»å¼‚æ­¥æ‰§è¡Œ"></a>2. onFulfilled å’Œ onRejected ä¸ºä»€ä¹ˆå¿…é¡»å¼‚æ­¥æ‰§è¡Œ</h3><h4 id="è§„èŒƒè¦æ±‚"><a href="#è§„èŒƒè¦æ±‚" class="headerlink" title="è§„èŒƒè¦æ±‚"></a>è§„èŒƒè¦æ±‚</h4><ul>
<li>Promise&#x2F;A+ è§„èŒƒ 2.2.4 æ¡æ˜ç¡®è§„å®šï¼šonFulfilled å’Œ onRejected å¿…é¡»å¼‚æ­¥æ‰§è¡Œ</li>
<li>å³ä½¿ Promise å·²ç»å¤„äº resolved çŠ¶æ€ï¼Œthen æ–¹æ³•çš„å›è°ƒä¹Ÿå¿…é¡»å¼‚æ­¥è°ƒç”¨</li>
</ul>
<h4 id="æ‰§è¡Œé¡ºåºä¿è¯-ï¼š"><a href="#æ‰§è¡Œé¡ºåºä¿è¯-ï¼š" class="headerlink" title="æ‰§è¡Œé¡ºåºä¿è¯ ï¼š"></a>æ‰§è¡Œé¡ºåºä¿è¯ ï¼š</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="title function_">resolve</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®è¾“å‡ºé¡ºåºåº”è¯¥æ˜¯ 3 -&gt; 2</span></span><br><span class="line"><span class="comment">// å¦‚æœåŒæ­¥æ‰§è¡Œåˆ™ä¼šè¾“å‡º 2 -&gt; 3</span></span><br></pre></td></tr></table></figure>

<h4 id="ä¸€è‡´æ€§ä¿è¯"><a href="#ä¸€è‡´æ€§ä¿è¯" class="headerlink" title="ä¸€è‡´æ€§ä¿è¯"></a>ä¸€è‡´æ€§ä¿è¯</h4><ul>
<li>æ— è®º Promise æ˜¯ç«‹å³è§£å†³è¿˜æ˜¯ç¨åè§£å†³ï¼Œ<code>then</code> å›è°ƒçš„æ‰§è¡Œæ—¶æœºä¿æŒä¸€è‡´ã€‚</li>
<li>é¿å…å‡ºç°æœ‰æ—¶åŒæ­¥æœ‰æ—¶å¼‚æ­¥çš„ä¸ç¡®å®šè¡Œä¸ºã€‚</li>
</ul>
<h4 id="é¿å…æ½œåœ¨é—®é¢˜"><a href="#é¿å…æ½œåœ¨é—®é¢˜" class="headerlink" title="é¿å…æ½œåœ¨é—®é¢˜"></a>é¿å…æ½œåœ¨é—®é¢˜</h4><ul>
<li>åŒæ­¥æ‰§è¡Œå¯èƒ½å¯¼è‡´è°ƒç”¨æ ˆè¿‡æ·±ï¼ˆå¦‚é€’å½’è°ƒç”¨ <code>then</code> æ–¹æ³•æ—¶ï¼‰ã€‚</li>
<li>åŒæ­¥æ‰§è¡Œå¯èƒ½æ‰“æ–­å½“å‰æ‰§è¡Œçš„ä»£ç æµç¨‹ï¼Œå¯¼è‡´æ„å¤–è¡Œä¸ºã€‚</li>
</ul>
<h4 id="å¾®ä»»åŠ¡æœºåˆ¶"><a href="#å¾®ä»»åŠ¡æœºåˆ¶" class="headerlink" title="å¾®ä»»åŠ¡æœºåˆ¶"></a>å¾®ä»»åŠ¡æœºåˆ¶</h4><ul>
<li>åŸç”Ÿ Promise ä½¿ç”¨å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆmicrotaskï¼‰å®ç°å¼‚æ­¥ã€‚</li>
<li>è¿™é‡Œç”¨ <code>setTimeout</code> æ¨¡æ‹Ÿï¼ˆè™½ç„¶å®ƒæ˜¯å®ä»»åŠ¡ï¼‰ï¼Œå› ä¸ºç®€å•å®ç°é€šå¸¸ä¸åŒºåˆ†å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ã€‚</li>
</ul>
<p><strong>å®é™…åº”ç”¨åœºæ™¯ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœä¸å¼‚æ­¥æ‰§è¡Œï¼Œä»¥ä¸‹ä»£ç ä¼šæœ‰é—®é¢˜ï¼š</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">MyPromise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="number">3</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">(<span class="params">num</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(num));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­£ç¡®è¾“å‡ºé¡ºåºåº”ä¸ºï¼š1, 2, 4, 3</span></span><br><span class="line"><span class="comment">// å¦‚æœåŒæ­¥æ‰§è¡Œ then å›è°ƒï¼Œåˆ™ä¼šè¾“å‡ºï¼š1, 3, 2, 4</span></span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œè™½ç„¶åŒæ­¥æ‰§è¡Œçœ‹èµ·æ¥æ›´é«˜æ•ˆï¼Œä½†ä¸ºäº†ç¬¦åˆè§„èŒƒå’Œè¡Œä¸ºä¸€è‡´æ€§ï¼Œå¿…é¡»ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œã€‚åœ¨æ›´å®Œæ•´çš„å®ç°ä¸­ï¼Œåº”è¯¥ä½¿ç”¨å¾®ä»»åŠ¡ï¼ˆå¦‚ queueMicrotask æˆ– process.nextTickï¼‰è€Œä¸æ˜¯ setTimeoutï¼Œä½†è¿™é‡Œä½œä¸ºç®€å•å®ç°å·²ç»è¶³å¤Ÿã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>ES6</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>ES6</tag>
      </tags>
  </entry>
  <entry>
    <title>cssé‚£äº›äº‹</title>
    <url>/2022/07/03/css%E9%82%A3%E4%BA%9B%E4%BA%8B/</url>
    <content><![CDATA[<h2 id="display-inline-block-å’Œ-blockã€inline-çš„åŒºåˆ«"><a href="#display-inline-block-å’Œ-blockã€inline-çš„åŒºåˆ«" class="headerlink" title="display inline-block å’Œ blockã€inline çš„åŒºåˆ«"></a>display inline-block å’Œ blockã€inline çš„åŒºåˆ«</h2><h2 id="display-å±æ€§å¯¹æ¯”è¡¨"><a href="#display-å±æ€§å¯¹æ¯”è¡¨" class="headerlink" title="display å±æ€§å¯¹æ¯”è¡¨"></a>display å±æ€§å¯¹æ¯”è¡¨</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th><code>display: block</code></th>
<th><code>display: inline</code></th>
<th><code>display: inline-block</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ˜¾ç¤ºæ–¹å¼</strong></td>
<td>ç‹¬å ä¸€è¡Œ</td>
<td>è¡Œå†…æ˜¾ç¤º</td>
<td>è¡Œå†…æ˜¾ç¤º</td>
</tr>
<tr>
<td><strong>å®½é«˜è®¾ç½®</strong></td>
<td>âœ… å¯è®¾ç½®</td>
<td>âŒ ä¸å¯è®¾ç½®</td>
<td>âœ… å¯è®¾ç½®</td>
</tr>
<tr>
<td><strong>è¾¹è·å½±å“</strong></td>
<td>å®Œå…¨ç”Ÿæ•ˆ</td>
<td>æ°´å¹³æ–¹å‘ç”Ÿæ•ˆï¼Œå‚ç›´æ–¹å‘éƒ¨åˆ†ç”Ÿæ•ˆ</td>
<td>å®Œå…¨ç”Ÿæ•ˆï¼ˆå¯èƒ½å¯¼è‡´å¸ƒå±€é—®é¢˜ï¼‰</td>
</tr>
<tr>
<td><strong>åŒ…å«å…ƒç´ </strong></td>
<td>å—çº§å’Œè¡Œå†…å…ƒç´ </td>
<td>åªèƒ½åŒ…å«è¡Œå†…å…ƒç´ </td>
<td>å—çº§å’Œè¡Œå†…å…ƒç´ </td>
</tr>
<tr>
<td><strong>é»˜è®¤å®½åº¦</strong></td>
<td>çˆ¶å®¹å™¨ 100%</td>
<td>ç”±å†…å®¹å†³å®š</td>
<td>ç”±å†…å®¹å†³å®š</td>
</tr>
<tr>
<td><strong>å…¸å‹å…ƒç´ </strong></td>
<td><code>&lt;div&gt;</code>, <code>&lt;p&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code></td>
<td><code>&lt;span&gt;</code>, <code>&lt;a&gt;</code>, <code>&lt;img&gt;</code></td>
<td><code>&lt;img&gt;</code>ç­‰æ›¿æ¢å…ƒç´ </td>
</tr>
<tr>
<td><strong>å¸ƒå±€åœºæ™¯</strong></td>
<td>æ•´ä½“å¸ƒå±€ç»“æ„</td>
<td>æ–‡æœ¬ä¿®é¥°ã€è¡Œå†…å…ƒç´ </td>
<td>éœ€è¦æ§åˆ¶å°ºå¯¸çš„è¡Œå†…å…ƒç´ </td>
</tr>
<tr>
<td><strong>æ³¨æ„äº‹é¡¹</strong></td>
<td>-</td>
<td>-</td>
<td>éœ€å¤„ç†<code>inline-block</code>é—´éš™é—®é¢˜</td>
</tr>
</tbody></table>
<h3 id="é—´éš™é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#é—´éš™é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="é—´éš™é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>é—´éš™é—®é¢˜è§£å†³æ–¹æ¡ˆ</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0</span>; <span class="comment">/* æ¶ˆé™¤é—´éš™ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>; <span class="comment">/* é‡ç½®å­—ä½“å¤§å° */</span></span><br><span class="line">  <span class="attribute">vertical-align</span>: top; <span class="comment">/* é¡¶éƒ¨å¯¹é½ */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CSS-ç›’æ¨¡å‹è¯¦è§£"><a href="#CSS-ç›’æ¨¡å‹è¯¦è§£" class="headerlink" title="CSS ç›’æ¨¡å‹è¯¦è§£"></a>CSS ç›’æ¨¡å‹è¯¦è§£</h2><p>CSS ç›’æ¨¡å‹ï¼ˆBox Modelï¼‰æ˜¯ç½‘é¡µå¸ƒå±€çš„åŸºç¡€ï¼Œå®šä¹‰äº†å…ƒç´ åœ¨é¡µé¢ä¸­å æ®çš„ç©ºé—´ã€‚ä¸€ä¸ªç›’å­ç”±ä»¥ä¸‹å››éƒ¨åˆ†ç»„æˆï¼š</p>
<h3 id="1-å†…å®¹åŒºï¼ˆContentï¼‰"><a href="#1-å†…å®¹åŒºï¼ˆContentï¼‰" class="headerlink" title="1. å†…å®¹åŒºï¼ˆContentï¼‰"></a>1. å†…å®¹åŒºï¼ˆContentï¼‰</h3><ul>
<li>æ˜¾ç¤ºæ–‡æœ¬ã€å›¾ç‰‡ç­‰å®é™…å†…å®¹ã€‚</li>
<li>å¤§å°ç”± <code>width</code> å’Œ <code>height</code> æ§åˆ¶ã€‚</li>
</ul>
<h3 id="2-å†…è¾¹è·ï¼ˆPaddingï¼‰"><a href="#2-å†…è¾¹è·ï¼ˆPaddingï¼‰" class="headerlink" title="2. å†…è¾¹è·ï¼ˆPaddingï¼‰"></a>2. å†…è¾¹è·ï¼ˆPaddingï¼‰</h3><ul>
<li>å†…å®¹ä¸è¾¹æ¡†ä¹‹é—´çš„é€æ˜åŒºåŸŸã€‚</li>
<li>é€šè¿‡ <code>padding-top</code>ã€<code>padding-right</code> ç­‰å±æ€§è®¾ç½®ã€‚</li>
</ul>
<h3 id="3-è¾¹æ¡†ï¼ˆBorderï¼‰"><a href="#3-è¾¹æ¡†ï¼ˆBorderï¼‰" class="headerlink" title="3. è¾¹æ¡†ï¼ˆBorderï¼‰"></a>3. è¾¹æ¡†ï¼ˆBorderï¼‰</h3><ul>
<li>å›´ç»•å†…å®¹å’Œå†…è¾¹è·çš„è¾¹ç•Œçº¿ã€‚</li>
<li>é€šè¿‡ <code>border-width</code>ã€<code>border-style</code> ç­‰å±æ€§è®¾ç½®ã€‚</li>
</ul>
<h3 id="4-å¤–è¾¹è·ï¼ˆMarginï¼‰"><a href="#4-å¤–è¾¹è·ï¼ˆMarginï¼‰" class="headerlink" title="4. å¤–è¾¹è·ï¼ˆMarginï¼‰"></a>4. å¤–è¾¹è·ï¼ˆMarginï¼‰</h3><ul>
<li>ç›’å­ä¸å…¶ä»–å…ƒç´ ä¹‹é—´çš„é€æ˜åŒºåŸŸã€‚</li>
<li>é€šè¿‡ <code>margin-top</code>ã€<code>margin-right</code> ç­‰å±æ€§è®¾ç½®ã€‚</li>
</ul>
<hr>
<h3 id="æ ‡å‡†ç›’æ¨¡å‹-vs-æ€ªå¼‚ç›’æ¨¡å‹"><a href="#æ ‡å‡†ç›’æ¨¡å‹-vs-æ€ªå¼‚ç›’æ¨¡å‹" class="headerlink" title="æ ‡å‡†ç›’æ¨¡å‹ vs æ€ªå¼‚ç›’æ¨¡å‹"></a>æ ‡å‡†ç›’æ¨¡å‹ vs æ€ªå¼‚ç›’æ¨¡å‹</h3><ul>
<li><p><strong>æ ‡å‡†ç›’æ¨¡å‹ï¼ˆ<code>box-sizing: content-box</code>ï¼‰</strong></p>
<ul>
<li><code>width</code> å’Œ <code>height</code> ä»…æ§åˆ¶å†…å®¹åŒºå¤§å°ã€‚</li>
<li>æ€»å®½åº¦ &#x3D; <code>width</code> + <code>padding</code> + <code>border</code> + <code>margin</code>ã€‚</li>
</ul>
</li>
<li><p><strong>æ€ªå¼‚ç›’æ¨¡å‹ï¼ˆ<code>box-sizing: border-box</code>ï¼‰</strong></p>
<ul>
<li><code>width</code> å’Œ <code>height</code> åŒ…å«å†…å®¹ã€å†…è¾¹è·å’Œè¾¹æ¡†ã€‚</li>
<li>æ€»å®½åº¦ &#x3D; <code>width</code>ï¼ˆå« <code>padding</code> å’Œ <code>border</code>ï¼‰ + <code>margin</code>ã€‚</li>
<li>æ¨èä½¿ç”¨ï¼š<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h2 id="BFCï¼ˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰è¯¦è§£"><a href="#BFCï¼ˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰è¯¦è§£" class="headerlink" title="BFCï¼ˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰è¯¦è§£"></a>BFCï¼ˆå—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰è¯¦è§£</h2><p>BFCï¼ˆBlock Formatting Contextï¼‰æ˜¯ CSS æ¸²æŸ“çš„ä¸€å—ç‹¬ç«‹åŒºåŸŸï¼Œå†…éƒ¨å…ƒç´ ä¸ä¼šå½±å“å¤–éƒ¨å¸ƒå±€ã€‚</p>
<h3 id="è§¦å‘-BFC-çš„æ¡ä»¶"><a href="#è§¦å‘-BFC-çš„æ¡ä»¶" class="headerlink" title="è§¦å‘ BFC çš„æ¡ä»¶"></a>è§¦å‘ BFC çš„æ¡ä»¶</h3><p>ä»¥ä¸‹å±æ€§å¯ä»¥è§¦å‘ BFCï¼š</p>
<ul>
<li><code>float: left/right</code>ï¼ˆä¸ä¸º <code>none</code>ï¼‰</li>
<li><code>position: absolute/fixed</code></li>
<li><code>display: inline-block/table-cell/flex</code></li>
<li><code>overflow: hidden/auto/scroll</code>ï¼ˆä¸ä¸º <code>visible</code>ï¼‰</li>
</ul>
<hr>
<h3 id="BFC-çš„ç‰¹æ€§"><a href="#BFC-çš„ç‰¹æ€§" class="headerlink" title="BFC çš„ç‰¹æ€§"></a>BFC çš„ç‰¹æ€§</h3><ol>
<li><strong>é˜»æ­¢å¤–è¾¹è·é‡å ï¼ˆMargin Collapseï¼‰</strong></li>
</ol>
<ul>
<li>æ™®é€šæµä¸­ç›¸é‚»å‚ç›´å¤–è¾¹è·ä¼šåˆå¹¶ï¼ˆå–æœ€å¤§å€¼ï¼‰ã€‚</li>
<li>BFC å†…çš„å…ƒç´ ä¸å¤–éƒ¨å…ƒç´ ä¸ä¼šå‘ç”Ÿå¤–è¾¹è·é‡å ã€‚</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bfc&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin: 20px;&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin: 20px;&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åŒ…å«æµ®åŠ¨å…ƒç´ </li>
</ol>
<ul>
<li>çˆ¶å…ƒç´ æœªè®¾ç½®é«˜åº¦æ—¶ï¼Œå­å…ƒç´ æµ®åŠ¨ä¼šå¯¼è‡´çˆ¶å…ƒç´ é«˜åº¦å¡Œé™·ã€‚<a href="https://www.yuque.com/frontend-onhmj/wang/xt7qd1">å¦‚ä½•è§£å†³æµ®åŠ¨å¡Œé™·</a></li>
<li>è§¦å‘ BFC åï¼Œçˆ¶å…ƒç´ ä¼šåŒ…è£¹æµ®åŠ¨å­å…ƒç´ ã€‚<a href="https://www.yuque.com/frontend-onhmj/wang/zqrevr">å¦‚ä½•æ¸…é™¤æµ®åŠ¨</a></li>
</ul>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125; <span class="comment">/* è§¦å‘ BFC */</span></span><br><span class="line"><span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>é˜»æ­¢å…ƒç´ è¢«æµ®åŠ¨è¦†ç›–</li>
</ol>
<ul>
<li>BFC åŒºåŸŸä¸ä¼šä¸æµ®åŠ¨å…ƒç´ é‡å ã€‚</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;float: left; width: 100px;&quot;</span>&gt;</span>æµ®åŠ¨å…ƒç´ <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;overflow: hidden;&quot;</span>&gt;</span>BFC å…ƒç´ <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ç›’æ¨¡å‹-BFC-æ€»ç»“"><a href="#ç›’æ¨¡å‹-BFC-æ€»ç»“" class="headerlink" title="ç›’æ¨¡å‹&amp;BFC æ€»ç»“"></a>ç›’æ¨¡å‹&amp;BFC æ€»ç»“</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ç›’æ¨¡å‹</th>
<th>BFC</th>
</tr>
</thead>
<tbody><tr>
<td>ä½œç”¨</td>
<td>å®šä¹‰å…ƒç´ ç©ºé—´å ç”¨</td>
<td>åˆ›å»ºç‹¬ç«‹å¸ƒå±€ç¯å¢ƒ</td>
</tr>
<tr>
<td>æ ¸å¿ƒé—®é¢˜</td>
<td>è®¡ç®—å®é™…å®½é«˜</td>
<td>è§£å†³å¤–è¾¹è·é‡å ã€æµ®åŠ¨å¡Œé™·ç­‰é—®é¢˜</td>
</tr>
<tr>
<td>å¸¸ç”¨å±æ€§</td>
<td><code>width</code>, <code>padding</code>, <code>border</code></td>
<td><code>overflow</code>, <code>float</code>, <code>position</code></td>
</tr>
</tbody></table>
<h2 id="CSS-ç»å…¸å¸ƒå±€"><a href="#CSS-ç»å…¸å¸ƒå±€" class="headerlink" title="CSS ç»å…¸å¸ƒå±€"></a>CSS ç»å…¸å¸ƒå±€</h2><h3 id="å¸ƒå±€é€‰æ‹©å»ºè®®"><a href="#å¸ƒå±€é€‰æ‹©å»ºè®®" class="headerlink" title="å¸ƒå±€é€‰æ‹©å»ºè®®"></a>å¸ƒå±€é€‰æ‹©å»ºè®®</h3><ol>
<li>ç®€å•å¸ƒå±€ ï¼šä¼˜å…ˆä½¿ç”¨ Flexbox</li>
<li>äºŒç»´å¤æ‚å¸ƒå±€ ï¼šä½¿ç”¨ CSS Grid</li>
<li>ä¼ ç»Ÿå¸ƒå±€ ï¼šFloat + Clearfixï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰</li>
<li>ç‰¹æ®Šåœºæ™¯ ï¼š<ul>
<li>ç€‘å¸ƒæµï¼š column-count æˆ– JS å®ç°</li>
<li>ç²˜æ€§å…ƒç´ ï¼š position: sticky</li>
<li>å“åº”å¼ï¼šé…åˆåª’ä½“æŸ¥è¯¢ä½¿ç”¨</li>
</ul>
</li>
</ol>
<h3 id="1-å±…ä¸­å¸ƒå±€-æ°´å¹³-å‚ç›´"><a href="#1-å±…ä¸­å¸ƒå±€-æ°´å¹³-å‚ç›´" class="headerlink" title="1. å±…ä¸­å¸ƒå±€ (æ°´å¹³+å‚ç›´)"></a>1. å±…ä¸­å¸ƒå±€ (æ°´å¹³+å‚ç›´)</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* æ–¹æ³•1ï¼šFlexbox */</span></span><br><span class="line"><span class="selector-class">.center-flex</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ–¹æ³•2ï¼šç»å¯¹å®šä½ */</span></span><br><span class="line"><span class="selector-class">.center-absolute</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ–¹æ³•3ï¼šGrid */</span></span><br><span class="line"><span class="selector-class">.center-grid</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">place-items</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ä¸¤æ -ä¸‰æ å¸ƒå±€"><a href="#2-ä¸¤æ -ä¸‰æ å¸ƒå±€" class="headerlink" title="2. ä¸¤æ &#x2F;ä¸‰æ å¸ƒå±€"></a>2. ä¸¤æ &#x2F;ä¸‰æ å¸ƒå±€</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ä¸¤æ å¸ƒå±€ï¼ˆå·¦ä¾§å›ºå®šï¼Œå³ä¾§è‡ªé€‚åº”ï¼‰ */</span></span><br><span class="line"><span class="selector-class">.two-columns</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">   * flex-shrinkå±æ€§ç”¨äºå®šä¹‰é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ã€‚</span></span><br><span class="line"><span class="comment">   * é»˜è®¤å€¼ä¸º1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œé¡¹ç›®å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚</span></span><br><span class="line"><span class="comment">   * è®¾ç½®ä¸º0è¡¨ç¤ºé¡¹ç›®ä¸ç¼©å°ï¼Œä¿æŒåŸå§‹å°ºå¯¸ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="comment">/* </span></span><br><span class="line"><span class="comment">   * flex-growå±æ€§å®šä¹‰äº†é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚</span></span><br><span class="line"><span class="comment">   * è®¾ç½®ä¸º1è¡¨ç¤ºå¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œè¯¥é¡¹ç›®å°†ç­‰æ¯”ä¾‹åœ°å æ®å‰©ä½™ç©ºé—´ã€‚</span></span><br><span class="line"><span class="comment">   * è¿™ä¸ªå±æ€§ç”¨äºflexå¸ƒå±€ä¸­ï¼Œæ˜¯flexå­é¡¹çš„ä¸€ä¸ªå±æ€§ã€‚</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¸‰æ å¸ƒå±€ï¼ˆåœ£æ¯å¸ƒå±€ï¼‰ */</span></span><br><span class="line"><span class="selector-class">.three-columns</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">1</span>fr <span class="number">200px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-ç€‘å¸ƒæµå¸ƒå±€-css3-è¯­æ³•"><a href="#3-ç€‘å¸ƒæµå¸ƒå±€-css3-è¯­æ³•" class="headerlink" title="3. ç€‘å¸ƒæµå¸ƒå±€ (css3 è¯­æ³•)"></a>3. ç€‘å¸ƒæµå¸ƒå±€ (css3 è¯­æ³•)</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="comment">/* å®šä¹‰åˆ—å¸ƒå±€ */</span></span><br><span class="line">  <span class="attribute">columns</span>: <span class="number">4</span> <span class="number">200px</span>; // è®¾ç½®åˆ—æ•°ä¸º<span class="number">4</span>ï¼Œæ¯åˆ—å®½åº¦ä¸º<span class="number">200px</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* å®šä¹‰åˆ—é—´è· */</span></span><br><span class="line">  <span class="attribute">column-gap</span>: <span class="number">1rem</span>; // è®¾ç½®åˆ—ä¸åˆ—ä¹‹é—´çš„é—´è·ä¸º<span class="number">1rem</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="comment">/* è®¾ç½®å…ƒç´ åœ¨åˆ†é¡µã€åˆ†æ æˆ–åˆ†å—æ—¶é¿å…è¢«ä¸­æ–­ */</span></span><br><span class="line">  <span class="attribute">break-inside</span>: avoid;</span><br><span class="line">  <span class="comment">/* è®¾ç½®å…ƒç´ åº•éƒ¨çš„å¤–è¾¹è·ä¸º1rem */</span></span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ç­‰åˆ†å¸ƒå±€"><a href="#4-ç­‰åˆ†å¸ƒå±€" class="headerlink" title="4. ç­‰åˆ†å¸ƒå±€"></a>4. ç­‰åˆ†å¸ƒå±€</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Flex å®ç° */</span></span><br><span class="line"><span class="selector-class">.equal-flex</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.equal-flex</span> &gt; * &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Grid å®ç° */</span></span><br><span class="line"><span class="selector-class">.equal-grid</span> &#123;</span><br><span class="line">  <span class="comment">/* ä½¿ç”¨CSS Gridå¸ƒå±€ */</span></span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  <span class="comment">/* å®šä¹‰ç½‘æ ¼åˆ—çš„æ¨¡æ¿ */</span></span><br><span class="line">  <span class="comment">/* repeat(auto-fit, minmax(100px, 1fr)) çš„å«ä¹‰æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">     - auto-fitï¼šè‡ªåŠ¨å¡«å……åˆ—ï¼Œå°½å¯èƒ½å¤šåœ°å¡«å……å¯ç”¨ç©ºé—´</span></span><br><span class="line"><span class="comment">     - minmax(100px, 1fr)ï¼šæ¯ä¸ªåˆ—çš„æœ€å°å®½åº¦ä¸º100pxï¼Œæœ€å¤§å®½åº¦ä¸º1frï¼ˆå³å‰©ä½™ç©ºé—´çš„ç­‰åˆ†ï¼‰</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, <span class="built_in">minmax</span>(<span class="number">100px</span>, <span class="number">1</span>fr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-ç²˜æ€§é¡µè„šå¸ƒå±€"><a href="#5-ç²˜æ€§é¡µè„šå¸ƒå±€" class="headerlink" title="5. ç²˜æ€§é¡µè„šå¸ƒå±€"></a>5. ç²˜æ€§é¡µè„šå¸ƒå±€</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="comment">/* ä½¿ç”¨Flexå¸ƒå±€ */</span></span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="comment">/* è®¾ç½®ä¸»è½´æ–¹å‘ä¸ºå‚ç›´æ–¹å‘ï¼Œå³å­å…ƒç´ æŒ‰ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ’åˆ— */</span></span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-å…¨å±å¸ƒå±€"><a href="#6-å…¨å±å¸ƒå±€" class="headerlink" title="6. å…¨å±å¸ƒå±€"></a>6. å…¨å±å¸ƒå±€</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.fullscreen</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  // è®¾ç½®å…ƒç´ çš„å®½åº¦ä¸ºè§†å£å®½åº¦çš„<span class="number">100%</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">  // è®¾ç½®å…ƒç´ çš„é«˜åº¦ä¸ºè§†å£é«˜åº¦çš„<span class="number">100%</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>css</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å¿…ä¿®è¯¾-è·¨åŸŸçŸ¥å¤šå°‘</title>
    <url>/2022/07/07/Web%E5%AE%89%E5%85%A8%E5%BF%85%E4%BF%AE%E8%AF%BE-%E8%B7%A8%E5%9F%9F%E7%9F%A5%E5%A4%9A%E5%B0%91/</url>
    <content><![CDATA[<h2 id="ä¸€ã€è·¨åŸŸé—®é¢˜çš„èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæµè§ˆå™¨è¦â€œå¤šç®¡é—²äº‹â€ï¼Ÿ"><a href="#ä¸€ã€è·¨åŸŸé—®é¢˜çš„èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæµè§ˆå™¨è¦â€œå¤šç®¡é—²äº‹â€ï¼Ÿ" class="headerlink" title="ä¸€ã€è·¨åŸŸé—®é¢˜çš„èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæµè§ˆå™¨è¦â€œå¤šç®¡é—²äº‹â€ï¼Ÿ"></a>ä¸€ã€è·¨åŸŸé—®é¢˜çš„èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆæµè§ˆå™¨è¦â€œå¤šç®¡é—²äº‹â€ï¼Ÿ</h2><p>å‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤©æ°”é¢„æŠ¥ç½‘ç«™ï¼Œå‰ç«¯é¡µé¢éƒ¨ç½²åœ¨ <a href="https://weather.com,éœ€è¦ä»/">https://weather.comï¼Œéœ€è¦ä»</a> <a href="https://api.weather.gov/">https://api.weather.gov</a> è·å–å¤©æ°”æ•°æ®ã€‚å½“ä½ ç”¨ JavaScript å‘èµ·è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šç›´æ¥æŠ¥é”™ï¼š<br>Access to XMLHttpRequest has been blocked by CORS policy<br>è¿™å°±æ˜¯ç»å…¸çš„è·¨åŸŸé—®é¢˜ã€‚</p>
<h3 id="1-1-æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶è·¨åŸŸï¼Ÿ"><a href="#1-1-æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶è·¨åŸŸï¼Ÿ" class="headerlink" title="1.1 æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶è·¨åŸŸï¼Ÿ"></a>1.1 æµè§ˆå™¨ä¸ºä»€ä¹ˆè¦é™åˆ¶è·¨åŸŸï¼Ÿ</h3><p>æµè§ˆå™¨çš„æ ¸å¿ƒå®‰å…¨ç­–ç•¥â€”â€”**åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰**è§„å®šï¼š<br>â€œåªæœ‰åè®®ã€åŸŸåã€ç«¯å£å®Œå…¨ç›¸åŒçš„ä¸¤ä¸ªé¡µé¢ï¼Œæ‰å…è®¸ç›´æ¥å…±äº«èµ„æºâ€ã€‚<br>æ¯”å¦‚ <a href="https://a.com/">https://a.com</a> å’Œ <a href="https://b.com/">https://b.com</a> å°±æ˜¯ä¸åŒæºï¼Œæ— æ³•ç›´æ¥é€šè¿‡ AJAX è¯·æ±‚æ•°æ®ã€‚</p>
<h3 id="1-2-ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ"><a href="#1-2-ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ"></a>1.2 ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ</h3><p>å‡è®¾æ²¡æœ‰åŒæºç­–ç•¥ï¼Œæ¶æ„ç½‘ç«™å¯ä»¥éšæ„è¯»å–ä½ çš„ Gmail é‚®ä»¶ã€çªƒå–é“¶è¡Œ Cookieï¼Œåæœä¸å ªè®¾æƒ³ã€‚åŒæºç­–ç•¥åƒä¸€ä¸ªâ€œä¿å®‰â€ï¼Œé»˜è®¤é˜»æ­¢è·¨åŸŸè¯·æ±‚ï¼Œä¿æŠ¤ç”¨æˆ·éšç§å’Œå®‰å…¨ã€‚</p>
<hr>
<h2 id="äºŒã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿè¿™äº›æƒ…å†µéƒ½ç®—ï¼"><a href="#äºŒã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿè¿™äº›æƒ…å†µéƒ½ç®—ï¼" class="headerlink" title="äºŒã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿè¿™äº›æƒ…å†µéƒ½ç®—ï¼"></a>äºŒã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿè¿™äº›æƒ…å†µéƒ½ç®—ï¼</h2><p>åªè¦ä»¥ä¸‹ä»»æ„ä¸€é¡¹ä¸åŒï¼Œæµè§ˆå™¨å°±ä¼šåˆ¤å®šä¸ºè·¨åŸŸï¼š</p>
<ul>
<li>åè®®ä¸åŒï¼ˆhttp vs httpsï¼‰</li>
<li>åŸŸåä¸åŒï¼ˆa.com vs b.comï¼‰</li>
<li>ç«¯å£ä¸åŒï¼ˆ80 vs 8080ï¼‰</li>
</ul>
<table>
<thead>
<tr>
<th>è¯·æ±‚æ–¹åœ°å€</th>
<th>ç›®æ ‡åœ°å€</th>
<th>æ˜¯å¦è·¨åŸŸ</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://a.com/">http://a.com</a></td>
<td><a href="https://a.com/">https://a.com</a></td>
<td>æ˜¯</td>
<td>åè®®ä¸åŒï¼ˆHTTP vs HTTPSï¼‰</td>
</tr>
<tr>
<td><a href="http://a.com/">http://a.com</a></td>
<td><a href="http://b.com/">http://b.com</a></td>
<td>æ˜¯</td>
<td>åŸŸåä¸åŒ</td>
</tr>
<tr>
<td><a href="http://a.com/">http://a.com:80</a></td>
<td><a href="http://a.com:8080/">http://a.com:8080</a></td>
<td>æ˜¯</td>
<td>ç«¯å£ä¸åŒ</td>
</tr>
<tr>
<td><a href="http://a.com/api">http://a.com/api</a></td>
<td><a href="http://a.com/">http://a.com</a></td>
<td>å¦</td>
<td>åŒæº</td>
</tr>
</tbody></table>
<hr>
<h2 id="ä¸‰ã€å‰ç«¯å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ5-ç§å¸¸ç”¨æ–¹æ¡ˆ"><a href="#ä¸‰ã€å‰ç«¯å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ5-ç§å¸¸ç”¨æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€å‰ç«¯å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ5 ç§å¸¸ç”¨æ–¹æ¡ˆ"></a>ä¸‰ã€å‰ç«¯å¦‚ä½•è§£å†³è·¨åŸŸé—®é¢˜ï¼Ÿ5 ç§å¸¸ç”¨æ–¹æ¡ˆ</h2><h3 id="3-1-æ–¹æ¡ˆä¸€ï¼šCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰â€”â€”æœ€æ­£ç»Ÿçš„è§£å†³æ–¹æ¡ˆ"><a href="#3-1-æ–¹æ¡ˆä¸€ï¼šCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰â€”â€”æœ€æ­£ç»Ÿçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.1 æ–¹æ¡ˆä¸€ï¼šCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰â€”â€”æœ€æ­£ç»Ÿçš„è§£å†³æ–¹æ¡ˆ"></a>3.1 æ–¹æ¡ˆä¸€ï¼šCORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰â€”â€”æœ€æ­£ç»Ÿçš„è§£å†³æ–¹æ¡ˆ</h3><p>**æ ¸å¿ƒæ€æƒ³ï¼šæœåŠ¡ç«¯è®¾ç½®å“åº”å¤´ï¼Œå‘Šè¯‰æµè§ˆå™¨â€œå…è®¸å“ªäº›åŸŸè®¿é—®æˆ‘â€ã€‚<br>é€‚ç”¨åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒé¦–é€‰ï¼Œéœ€åç«¯é…åˆã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åç«¯ç¤ºä¾‹ä»£ç ï¼ˆNode.jsï¼‰</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;https://weather.com&quot;</span>); <span class="comment">// å…è®¸ç‰¹å®šåŸŸ</span></span><br><span class="line"><span class="comment">// æˆ–å…è®¸æ‰€æœ‰åŸŸï¼ˆæ…ç”¨ï¼‰</span></span><br><span class="line">response.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>CORS ä¸¤ç§è¯·æ±‚ç±»å‹ï¼š</p>
<ul>
<li><p>ç®€å•è¯·æ±‚ï¼šç›´æ¥å‘é€ï¼ˆå¦‚ GET&#x2F;POST ä¸”æ— è‡ªå®šä¹‰å¤´ï¼‰</p>
</li>
<li><p>é¢„æ£€è¯·æ±‚ï¼šå…ˆå‘ OPTIONS è¯·æ±‚æ¢è·¯ï¼ˆå¦‚ PUT&#x2F;DELETE æˆ–å¸¦è‡ªå®šä¹‰å¤´ï¼‰</p>
</li>
</ul>
<hr>
<h3 id="3-2-æ–¹æ¡ˆäºŒï¼šä»£ç†æœåŠ¡å™¨â€”â€”å¼€å‘ç¯å¢ƒç¥å™¨"><a href="#3-2-æ–¹æ¡ˆäºŒï¼šä»£ç†æœåŠ¡å™¨â€”â€”å¼€å‘ç¯å¢ƒç¥å™¨" class="headerlink" title="3.2 æ–¹æ¡ˆäºŒï¼šä»£ç†æœåŠ¡å™¨â€”â€”å¼€å‘ç¯å¢ƒç¥å™¨"></a>3.2 æ–¹æ¡ˆäºŒï¼šä»£ç†æœåŠ¡å™¨â€”â€”å¼€å‘ç¯å¢ƒç¥å™¨</h3><p><strong>æ ¸å¿ƒæ€æƒ³ï¼šå‰ç«¯è¯·æ±‚åŒåŸŸä»£ç†ï¼Œä»£ç†è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œé¿å¼€æµè§ˆå™¨é™åˆ¶ã€‚</strong></p>
<p>å®ç°æ–¹å¼ï¼š</p>
<ol>
<li>Webpack DevServer ä»£ç†ï¼ˆVue&#x2F;React é¡¹ç›®å¸¸ç”¨ï¼Œå¼€å‘ç¯å¢ƒæ—¶ä½¿ç”¨ï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;https://api.weather.gov&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Nginx åå‘ä»£ç†ï¼ˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼‰</li>
</ol>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> /api/ &#123;</span><br><span class="line">  <span class="attribute">proxy_pass</span> https://api.weather.gov/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-3-æ–¹æ¡ˆä¸‰ï¼šJSONPâ€”â€”è€å¼æŠ€å·§çš„å·§å¦™åˆ©ç”¨"><a href="#3-3-æ–¹æ¡ˆä¸‰ï¼šJSONPâ€”â€”è€å¼æŠ€å·§çš„å·§å¦™åˆ©ç”¨" class="headerlink" title="3.3 æ–¹æ¡ˆä¸‰ï¼šJSONPâ€”â€”è€å¼æŠ€å·§çš„å·§å¦™åˆ©ç”¨"></a>3.3 æ–¹æ¡ˆä¸‰ï¼šJSONPâ€”â€”è€å¼æŠ€å·§çš„å·§å¦™åˆ©ç”¨</h3><p><strong>æ ¸å¿ƒæ€æƒ³ï¼šåˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾æ— è·¨åŸŸé™åˆ¶çš„ç‰¹æ€§ã€‚</strong><br><strong>ç¼ºç‚¹ï¼šä»…æ”¯æŒ GET è¯·æ±‚ï¼Œå®‰å…¨æ€§ä½ï¼ˆéœ€å®Œå…¨ä¿¡ä»»æœåŠ¡ç«¯ï¼‰ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‰ç«¯ä»£ç </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleWeather</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°æ•°æ®:&quot;</span>, data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">script.<span class="property">src</span> = <span class="string">&quot;https://api.weather.gov?callback=handleWeather&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åç«¯éœ€è¿”å›ï¼šhandleWeather(&#123; temperature: 25 &#125;);</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-4-æ–¹æ¡ˆå››ï¼šWebSocketâ€”â€”åŒå‘é€šä¿¡æ— è·¨åŸŸ"><a href="#3-4-æ–¹æ¡ˆå››ï¼šWebSocketâ€”â€”åŒå‘é€šä¿¡æ— è·¨åŸŸ" class="headerlink" title="3.4 æ–¹æ¡ˆå››ï¼šWebSocketâ€”â€”åŒå‘é€šä¿¡æ— è·¨åŸŸ"></a>3.4 æ–¹æ¡ˆå››ï¼šWebSocketâ€”â€”åŒå‘é€šä¿¡æ— è·¨åŸŸ</h3><p><strong>WebSocket åè®®ä¸å—åŒæºç­–ç•¥é™åˆ¶ï¼Œé€‚åˆå®æ—¶é€šä¿¡åœºæ™¯ã€‚</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;wss://api.weather.gov&quot;</span>);</span><br><span class="line">socket.<span class="property">onmessage</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯:&quot;</span>, event.<span class="property">data</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-5-æ–¹æ¡ˆäº”ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä»…æµ‹è¯•ç”¨ï¼‰"><a href="#3-5-æ–¹æ¡ˆäº”ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä»…æµ‹è¯•ç”¨ï¼‰" class="headerlink" title="3.5 æ–¹æ¡ˆäº”ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä»…æµ‹è¯•ç”¨ï¼‰"></a>3.5 æ–¹æ¡ˆäº”ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä»…æµ‹è¯•ç”¨ï¼‰</h3><p><strong>ç¦ç”¨æµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼ˆChrome å¯åŠ¨å‚æ•°åŠ  â€“disable-web-securityï¼‰</strong><br>âš ï¸ <strong>è­¦å‘Šï¼šä»…é™æœ¬åœ°è°ƒè¯•ï¼Œç»å¯¹ä¸è¦ç”¨äºæ—¥å¸¸æµè§ˆï¼</strong></p>
<hr>
<h2 id="å››ã€å¦‚ä½•é€‰æ‹©æœ€ä½³æ–¹æ¡ˆï¼Ÿ"><a href="#å››ã€å¦‚ä½•é€‰æ‹©æœ€ä½³æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="å››ã€å¦‚ä½•é€‰æ‹©æœ€ä½³æ–¹æ¡ˆï¼Ÿ"></a>å››ã€å¦‚ä½•é€‰æ‹©æœ€ä½³æ–¹æ¡ˆï¼Ÿ</h2><table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>CORS</td>
<td>ç”Ÿäº§ç¯å¢ƒ</td>
<td>å®‰å…¨ã€æ ‡å‡†</td>
<td>éœ€åç«¯é…åˆ</td>
</tr>
<tr>
<td>ä»£ç†æœåŠ¡å™¨</td>
<td>å¼€å‘ç¯å¢ƒ</td>
<td>å‰ç«¯ç‹¬ç«‹è§£å†³</td>
<td>éœ€é…ç½®æœåŠ¡å™¨</td>
</tr>
<tr>
<td>JSONP</td>
<td>æ—§é¡¹ç›®å…¼å®¹</td>
<td>æ— éœ€åç«¯æ”¹åŠ¨</td>
<td>ä»… GETã€å®‰å…¨æ€§ä½</td>
</tr>
<tr>
<td>WebSocket</td>
<td>å®æ—¶é€šä¿¡ï¼ˆå¦‚èŠå¤©å®¤ï¼‰</td>
<td>åŒå‘é€šä¿¡ã€é«˜æ•ˆ</td>
<td>å¤æ‚åº¦è¾ƒé«˜</td>
</tr>
</tbody></table>
<hr>
<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><ul>
<li><strong>ä¼˜å…ˆé€‰æ‹© CORS</strong>ï¼šä½œä¸ºæ ‡å‡†æ–¹æ¡ˆï¼Œå®‰å…¨å¯é ã€‚</li>
<li><strong>å¼€å‘ç¯å¢ƒç”¨ä»£ç†</strong>ï¼šèƒ½å¤Ÿé¿å…ä¿®æ”¹ç”Ÿäº§ä»£ç ã€‚</li>
<li><strong>è°¨æ…ä½¿ç”¨ JSONP</strong>ï¼šä»…ä½œä¸ºå…¼å®¹æ—§ç³»ç»Ÿçš„å¤‡ç”¨æ–¹æ¡ˆã€‚</li>
</ul>
<p>è·¨åŸŸé—®é¢˜æœ¬è´¨ä¸Šæ˜¯æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„â€œä¿¡ä»»åè®®â€ï¼Œç†è§£å…¶åŸç†åï¼Œé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆå³å¯è½»æ¾åº”å¯¹ï¼</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>Webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>Webå®‰å…¨</tag>
        <tag>è·¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title>Reacté¡¹ç›®ä¸­Markdowné›†æˆå®Œæ•´æŒ‡å—</title>
    <url>/2023/07/01/react%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5markdown/</url>
    <content><![CDATA[<h2 id="æ¨èæ–¹æ¡ˆ"><a href="#æ¨èæ–¹æ¡ˆ" class="headerlink" title="æ¨èæ–¹æ¡ˆ"></a>æ¨èæ–¹æ¡ˆ</h2><blockquote>
<p>å¦‚æœä½ éœ€è¦å®Œæ•´çš„ Markdown æ¸²æŸ“åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨ react-markdown + remark-gfm + react-syntax-highlighter ç»„åˆã€‚å¦‚æœéœ€è¦ç¼–è¾‘å™¨åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ react-md-editor ã€‚</p>
</blockquote>
<h3 id="1-react-markdown"><a href="#1-react-markdown" class="headerlink" title="1. react-markdown"></a>1. react-markdown</h3><blockquote>
<p>åŠŸèƒ½: å°† Markdown è½¬æ¢ä¸º React ç»„ä»¶</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install react-markdown</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactMarkdown</span> <span class="keyword">from</span> <span class="string">&quot;react-markdown&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownRenderer</span> = (<span class="params">&#123; markdown &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ReactMarkdown</span>&gt;</span>&#123;markdown&#125;<span class="tag">&lt;/<span class="name">ReactMarkdown</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MarkdownRenderer</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-remark-gfm"><a href="#2-remark-gfm" class="headerlink" title="2. remark-gfm"></a>2. remark-gfm</h3><blockquote>
<p>åŠŸèƒ½ : æ”¯æŒ GitHub Flavored Markdownï¼ˆGFMï¼‰è¯­æ³•</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install remark-gfm</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactMarkdown</span> <span class="keyword">from</span> <span class="string">&quot;react-markdown&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> remarkGfm <span class="keyword">from</span> <span class="string">&quot;remark-gfm&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownRenderer</span> = (<span class="params">&#123; markdown &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ReactMarkdown</span> <span class="attr">remarkPlugins</span>=<span class="string">&#123;[remarkGfm]&#125;</span>&gt;</span>&#123;markdown&#125;<span class="tag">&lt;/<span class="name">ReactMarkdown</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MarkdownRenderer</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-react-syntax-highlighter"><a href="#3-react-syntax-highlighter" class="headerlink" title="3. react-syntax-highlighter"></a>3. react-syntax-highlighter</h3><blockquote>
<p>åŠŸèƒ½ : é«˜äº®ä»£ç å—</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install react-syntax-highlighter</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactMarkdown</span> <span class="keyword">from</span> <span class="string">&quot;react-markdown&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Prism</span> <span class="keyword">as</span> <span class="title class_">SyntaxHighlighter</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-syntax-highlighter&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dracula &#125; <span class="keyword">from</span> <span class="string">&quot;react-syntax-highlighter/dist/esm/styles/prism&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownRenderer</span> = (<span class="params">&#123; markdown &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ReactMarkdown</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">components</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">code</span>(&#123; <span class="attr">node</span>, <span class="attr">inline</span>, <span class="attr">className</span>, <span class="attr">children</span>, <span class="attr">...props</span> &#125;) &#123;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">const</span> <span class="attr">match</span> = <span class="string">/language-(\w+)/.exec(className</span> || &quot;&quot;);</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">return</span> !<span class="attr">inline</span> &amp;&amp; <span class="attr">match</span> ? (</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &lt;<span class="attr">SyntaxHighlighter</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">style</span>=<span class="string">&#123;dracula&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">language</span>=<span class="string">&#123;match[1]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">PreTag</span>=<span class="string">&quot;div&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              &#123;<span class="attr">...props</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;String(children).replace(/\n$/, &quot;&quot;)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">SyntaxHighlighter</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ) : (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">code</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> &#123;<span class="attr">...props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">code</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          );</span></span><br><span class="line"><span class="language-xml">        &#125;,</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      &#123;markdown&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ReactMarkdown</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MarkdownRenderer</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-markdown-to-jsx"><a href="#4-markdown-to-jsx" class="headerlink" title="4. markdown-to-jsx"></a>4. markdown-to-jsx</h3><blockquote>
<p>åŠŸèƒ½ : å¯ä»¥å°† Markdown è½¬æ¢ä¸º JSX ç»„ä»¶,è½»é‡çº§ Markdown æ¸²æŸ“å™¨</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install markdown-to-jsx</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Markdown</span> <span class="keyword">from</span> <span class="string">&quot;markdown-to-jsx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownRenderer</span> = (<span class="params">&#123; markdown &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Markdown</span>&gt;</span>&#123;markdown&#125;<span class="tag">&lt;/<span class="name">Markdown</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MarkdownRenderer</span>;</span><br></pre></td></tr></table></figure>

<h3 id="5-react-md-editor"><a href="#5-react-md-editor" class="headerlink" title="5. react-md-editor"></a>5. react-md-editor</h3><blockquote>
<p>åŠŸèƒ½ : Markdown ç¼–è¾‘å™¨</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install @uiw/react-md-editor</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MDEditor</span> <span class="keyword">from</span> <span class="string">&quot;@uiw/react-md-editor&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownEditor</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="string">&quot;**Hello world!!!**&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">MDEditor</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;setValue&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MarkdownEditor</span>;</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®-Markdown-è§£æ"><a href="#é…ç½®-Markdown-è§£æ" class="headerlink" title="é…ç½® Markdown è§£æ"></a>é…ç½® Markdown è§£æ</h2><ol>
<li>å®‰è£…ä¾èµ–åŒ…ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install react-markdown remark-gfm rehype-highlight</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ›å»º Markdown è§£æç»„ä»¶ï¼š</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/components/MarkdownRenderer.jsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactMarkdown</span> <span class="keyword">from</span> <span class="string">&quot;react-markdown&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> remarkGfm <span class="keyword">from</span> <span class="string">&quot;remark-gfm&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> rehypeHighlight <span class="keyword">from</span> <span class="string">&quot;rehype-highlight&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownRenderer</span> = (<span class="params">&#123; content &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">ReactMarkdown</span> <span class="attr">remarkPlugins</span>=<span class="string">&#123;[remarkGfm]&#125;</span> <span class="attr">rehypePlugins</span>=<span class="string">&#123;[rehypeHighlight]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;content&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">ReactMarkdown</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="è‡ªåŠ¨ç”Ÿæˆç›®å½•"><a href="#è‡ªåŠ¨ç”Ÿæˆç›®å½•" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆç›®å½•"></a>è‡ªåŠ¨ç”Ÿæˆç›®å½•</h2><blockquote>
<p>ä¾§è¾¹å¯¼èˆªæ </p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨MarkdownRendererç»„ä»¶ä¸­æ·»åŠ ï¼š</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">generateTOC</span> = (<span class="params">content</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> headings = content.<span class="title function_">match</span>(<span class="regexp">/^##+ .+/gm</span>) || [];</span><br><span class="line">  <span class="keyword">return</span> headings.<span class="title function_">map</span>(<span class="function">(<span class="params">heading</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">level</span>: heading.<span class="title function_">match</span>(<span class="regexp">/##+/</span>)[<span class="number">0</span>].<span class="property">length</span>,</span><br><span class="line">    <span class="attr">title</span>: heading.<span class="title function_">replace</span>(<span class="regexp">/##+ /</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">const</span> &#123; content &#125; = props;</span><br><span class="line"><span class="keyword">const</span> toc = <span class="title function_">generateTOC</span>(content);</span><br></pre></td></tr></table></figure>

<h2 id="æ ·å¼ä¼˜åŒ–"><a href="#æ ·å¼ä¼˜åŒ–" class="headerlink" title="æ ·å¼ä¼˜åŒ–"></a>æ ·å¼ä¼˜åŒ–</h2><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/styles/markdown.scss</span></span><br><span class="line"><span class="selector-class">.markdown-body</span> &#123;</span><br><span class="line">  <span class="selector-tag">h2</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  pre &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f6f8fa</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®Œæ•´å®ç°ç¤ºä¾‹"><a href="#å®Œæ•´å®ç°ç¤ºä¾‹" class="headerlink" title="å®Œæ•´å®ç°ç¤ºä¾‹"></a>å®Œæ•´å®ç°ç¤ºä¾‹</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡µé¢ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹ï¼š</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactMarkdown</span> <span class="keyword">from</span> <span class="string">&#x27;react-markdown&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> remarkGfm <span class="keyword">from</span> <span class="string">&#x27;remark-gfm&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> rehypeHighlight <span class="keyword">from</span> <span class="string">&#x27;rehype-highlight&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æå–tableç»„ä»¶,é¿å…React åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½çœ‹åˆ°ä¸€ä¸ªæ–°ç»„ä»¶ç±»å‹ï¼Œä»è€Œé”€æ¯æ•´ä¸ªå­æ ‘çš„ DOM èŠ‚ç‚¹å’ŒçŠ¶æ€</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderTableCom</span> = (<span class="params">&#123; node, ...props &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">overflowX:</span> &#x27;<span class="attr">auto</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">table</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">borderCollapse:</span> &#x27;<span class="attr">collapse</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">width:</span> &#x27;<span class="attr">100</span>%&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">margin:</span> &#x27;<span class="attr">16px</span> <span class="attr">0</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &#123;<span class="attr">...props</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderThCom</span> = (<span class="params">&#123; node, ...props &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">th</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">border:</span> &#x27;<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">ddd</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">padding:</span> &#x27;<span class="attr">8px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">backgroundColor:</span> &#x27;#<span class="attr">f5f5f5</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#123;<span class="attr">...props</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderTdCom</span> = (<span class="params">&#123; node, ...props &#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">td</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">border:</span> &#x27;<span class="attr">1px</span> <span class="attr">solid</span> #<span class="attr">ddd</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">padding:</span> &#x27;<span class="attr">8px</span>&#x27;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &#123;<span class="attr">...props</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆç›®å½•çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">generateTOC</span> = (<span class="params">content</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰ä»¥ ## å¼€å¤´çš„æ ‡é¢˜è¡Œ</span></span><br><span class="line">  <span class="comment">// ^##+ è¡¨ç¤ºåŒ¹é…ä»¥ä¸¤ä¸ªæˆ–æ›´å¤š # å¼€å¤´çš„è¡Œ</span></span><br><span class="line">  <span class="comment">// .+ è¡¨ç¤ºåŒ¹é…æ ‡é¢˜å†…å®¹</span></span><br><span class="line">  <span class="comment">// gm è¡¨ç¤ºå…¨å±€åŒ¹é…å’Œå¤šè¡ŒåŒ¹é…</span></span><br><span class="line">  <span class="keyword">const</span> headings = content.<span class="title function_">match</span>(<span class="regexp">/^##+ .+/gm</span>) || [];</span><br><span class="line">  <span class="comment">// å°†åŒ¹é…åˆ°çš„æ ‡é¢˜è¡Œè½¬æ¢ä¸ºç›®å½•é¡¹</span></span><br><span class="line">  <span class="keyword">return</span> headings.<span class="title function_">map</span>(<span class="function">(<span class="params">heading</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// è·å–æ ‡é¢˜çš„å±‚çº§ï¼ˆé€šè¿‡è®¡ç®— # çš„æ•°é‡ï¼‰</span></span><br><span class="line">    <span class="attr">level</span>: heading.<span class="title function_">match</span>(<span class="regexp">/##+/</span>)[<span class="number">0</span>].<span class="property">length</span>,</span><br><span class="line">    <span class="comment">// å»é™¤æ ‡é¢˜å‰çš„ # å’Œç©ºæ ¼ï¼Œè·å–çº¯æ–‡æœ¬æ ‡é¢˜</span></span><br><span class="line">    <span class="attr">title</span>: heading.<span class="title function_">replace</span>(<span class="regexp">/##+ /</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    <span class="attr">id</span>: heading.<span class="title function_">replace</span>(<span class="regexp">/##+ /</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">toLowerCase</span>().<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&#x27;-&#x27;</span>), <span class="comment">// ç”Ÿæˆé”šç‚¹ ID</span></span><br><span class="line">  &#125;));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line react/prop-types</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MarkdownWithTOC</span> = (<span class="params">&#123; content &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [toc, setToc] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setToc</span>(<span class="title function_">generateTOC</span>(content));</span><br><span class="line">  &#125;, [content]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">display:</span> &#x27;<span class="attr">flex</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ç›®å½•ä¾§è¾¹æ  */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">aside</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">width:</span> &#x27;<span class="attr">200px</span>&#x27;, <span class="attr">marginRight:</span> &#x27;<span class="attr">20px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>ç›®å½•<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;toc.map((item, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">key</span>=<span class="string">&#123;item.id</span> || <span class="attr">index</span>&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">marginLeft:</span> `$&#123;(<span class="attr">item.level</span> <span class="attr">-</span> <span class="attr">2</span>) * <span class="attr">15</span>&#125;<span class="attr">px</span>` &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#$&#123;<span class="attr">item.id</span>&#125;`&#125;&gt;</span>&#123;item.title&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* Markdown å†…å®¹ */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">article</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">flex:</span> &#x27;<span class="attr">auto</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ReactMarkdown</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">remarkPlugins</span>=<span class="string">&#123;[remarkGfm]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">rehypePlugins</span>=<span class="string">&#123;[rehypeHighlight]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">components</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">table:</span> <span class="attr">renderTableCom</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">th:</span> <span class="attr">renderThCom</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">td:</span> <span class="attr">renderTdCom</span>,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;content&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ReactMarkdown</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MarkdownWithTOC</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="vite-é¡¹ç›®åŠ è½½-md-æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼"><a href="#vite-é¡¹ç›®åŠ è½½-md-æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="vite é¡¹ç›®åŠ è½½ md æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼"></a>vite é¡¹ç›®åŠ è½½ md æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼</h2><h3 id="1-ä½¿ç”¨-import-å¼•ç”¨-æ¨èï¼Œæ€§èƒ½å¥½"><a href="#1-ä½¿ç”¨-import-å¼•ç”¨-æ¨èï¼Œæ€§èƒ½å¥½" class="headerlink" title="1. ä½¿ç”¨ import å¼•ç”¨ (æ¨èï¼Œæ€§èƒ½å¥½)"></a>1. ä½¿ç”¨ import å¼•ç”¨ (æ¨èï¼Œæ€§èƒ½å¥½)</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> markdownContent <span class="keyword">from</span> <span class="string">&quot;@/assets/interview-notes.md?raw&quot;</span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>@&#x2F;assets&#x2F;interview-notes.md ï¼š</li>
</ol>
<ul>
<li>@ æ˜¯ Vite ä¸­é…ç½®çš„è·¯å¾„åˆ«åï¼Œé€šå¸¸æŒ‡å‘ src ç›®å½•</li>
<li>è¡¨ç¤ºä» src&#x2F;assets ç›®å½•ä¸‹å¯¼å…¥ interview-notes.md æ–‡ä»¶</li>
</ul>
<ol start="2">
<li>?raw åç¼€ ï¼š</li>
</ol>
<ul>
<li>è¿™æ˜¯ Vite çš„ç‰¹æ®ŠæŸ¥è¯¢å‚æ•°</li>
<li>è¡¨ç¤ºä»¥åŸå§‹å­—ç¬¦ä¸²çš„å½¢å¼å¯¼å…¥æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ¨¡å—å¤„ç†</li>
<li>é€‚åˆç”¨äºå¯¼å…¥çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¦‚ Markdownã€JSON ç­‰</li>
</ul>
<ol start="3">
<li>markdownContent ï¼š</li>
</ol>
<ul>
<li>å¯¼å…¥çš„å†…å®¹ä¼šè¢«èµ‹å€¼ç»™ markdownContent å˜é‡</li>
<li>å˜é‡ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼ŒåŒ…å« Markdown æ–‡ä»¶çš„å®Œæ•´å†…å®¹</li>
</ul>
<p>è¿™ç§å¯¼å…¥æ–¹å¼çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>æ–‡ä»¶å†…å®¹ä¼šåœ¨æ„å»ºæ—¶è¢«å¤„ç†</p>
</li>
<li><p>æ”¯æŒçƒ­æ›´æ–°ï¼ˆHMRï¼‰ï¼Œä¿®æ”¹æ–‡ä»¶åé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°</p>
</li>
<li><p>ç›¸æ¯” fetch è¯·æ±‚ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºæ–‡ä»¶å†…å®¹ä¼šè¢«æ‰“åŒ…è¿› JavaScript æ–‡ä»¶ä¸­<br>æ³¨æ„ï¼šéœ€è¦ç¡®ä¿ vite.config.js ä¸­é…ç½®äº†æ­£ç¡®çš„è·¯å¾„åˆ«åå’Œ Markdown æ–‡ä»¶å¤„ç†ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: <span class="string">&quot;/src&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">assetsInclude</span>: [<span class="string">&quot;**/*.md&quot;</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-ä½¿ç”¨-fetch-è¯·æ±‚"><a href="#2-ä½¿ç”¨-fetch-è¯·æ±‚" class="headerlink" title="2. ä½¿ç”¨ fetch è¯·æ±‚"></a>2. ä½¿ç”¨ fetch è¯·æ±‚</h3></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> [markdownContent, setMarkdownContent] = <span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> [isLoading, setLoading] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">fetch</span>(</span><br><span class="line">    <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">PROD</span></span><br><span class="line">      ? <span class="string">`<span class="subst">$&#123;<span class="keyword">import</span>.meta.env.BASE_URL&#125;</span>/interview-notes.md`</span></span><br><span class="line">      : <span class="string">&quot;/interview-notes.md&quot;</span></span><br><span class="line">  )</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="title function_">text</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">text</span>) =&gt;</span> <span class="title function_">setMarkdownContent</span>(text))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="title function_">setLoading</span>(<span class="literal">false</span>));</span><br><span class="line">  s;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<p>è¿™ç§å¯¼å…¥æ–¹å¼çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li><p>æ–‡ä»¶ä¼šè¢«ä½œä¸ºé™æ€æ–‡ä»¶å¤„ç†ï¼Œä¸ä¼šè¢«æ‰“åŒ…è¿› JavaScript æ–‡ä»¶ä¸­, éœ€è¦å¤„ç†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„è·¯å¾„é—®é¢˜</p>
</li>
<li><p>é€‚åˆç”¨äºå¯¼å…¥è¾ƒå¤§çš„æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€è§†é¢‘ç­‰</p>
</li>
<li><p>å¯ä»¥åŠ¨æ€åŠ è½½ Markdown æ–‡ä»¶ï¼Œæ ¹æ®éœ€è¦è¿›è¡Œè¯·æ±‚</p>
</li>
<li><p>æ³¨æ„ï¼šéœ€è¦ç¡®ä¿ vite.config.js ä¸­é…ç½®äº†æ­£ç¡®çš„è·¯å¾„åˆ«åå’Œ Markdown æ–‡ä»¶å¤„ç†ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: <span class="string">&quot;/src&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">assetsInclude</span>: [<span class="string">&quot;**/*.md&quot;</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="æœ€ä½³å®è·µå»ºè®®"><a href="#æœ€ä½³å®è·µå»ºè®®" class="headerlink" title="æœ€ä½³å®è·µå»ºè®®"></a>æœ€ä½³å®è·µå»ºè®®</h2><ol>
<li>é…åˆ SSG æ–¹æ¡ˆåœ¨æ„å»ºæ—¶é¢„è§£æ Markdown</li>
<li>ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶æ›¿æ¢åŸç”Ÿ HTML æ ‡ç­¾</li>
<li>æ·»åŠ ä»£ç å¤åˆ¶æŒ‰é’®ç­‰å¢å¼ºåŠŸèƒ½</li>
<li>å®ç°ç›®å½•è‡ªåŠ¨æ»šåŠ¨å®šä½</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>React</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript æ‰§è¡Œä¸Šä¸‹æ–‡ã€è°ƒç”¨æ ˆä¸é˜Ÿåˆ—</title>
    <url>/2022/05/01/JavaScript-%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E8%B0%83%E7%94%A8%E6%A0%88%E4%B8%8E%E9%98%9F%E5%88%97/</url>
    <content><![CDATA[<h2 id="æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡"></a>æ‰§è¡Œä¸Šä¸‹æ–‡</h2><h3 id="ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡"></a>ä»€ä¹ˆæ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡</h3><blockquote>
<p>æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆExecution Contextï¼‰æ˜¯ JavaScript ä»£ç è¢«è¯„ä¼°å’Œæ‰§è¡Œæ—¶çš„ç¯å¢ƒæ¦‚å¿µã€‚</p>
</blockquote>
<h3 id="æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹"></a>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç±»å‹</h3><ol>
<li><p><strong>å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</strong></p>
<ul>
<li>é»˜è®¤çš„ã€åŸºç¡€çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li>åˆ›å»ºå…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸­ä¸º <code>window</code>ï¼ŒNode.js ä¸­ä¸º <code>global</code>ï¼‰</li>
<li>å°† <code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡</li>
</ul>
</li>
<li><p><strong>å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</strong></p>
<ul>
<li>æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶åˆ›å»º</li>
<li>æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>
</ul>
</li>
<li><p><strong>Eval æ‰§è¡Œä¸Šä¸‹æ–‡</strong></p>
<ul>
<li>åœ¨ <code>eval</code> å‡½æ•°å†…éƒ¨çš„ä»£ç æœ‰è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>
</ul>
</li>
</ol>
<h3 id="æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ"></a>æ‰§è¡Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸ</h3><ol>
<li><p><strong>åˆ›å»ºé˜¶æ®µ</strong></p>
<ul>
<li>åˆ›å»ºå˜é‡å¯¹è±¡ï¼ˆVOï¼‰<ul>
<li>å‡½æ•°å‚æ•°ï¼ˆå‡½æ•°ä¸Šä¸‹æ–‡ï¼‰</li>
<li>å‡½æ•°å£°æ˜ï¼ˆä¼˜å…ˆï¼‰</li>
<li>å˜é‡å£°æ˜ï¼ˆåˆå§‹å€¼ä¸º <code>undefined</code>ï¼‰</li>
</ul>
</li>
<li>å»ºç«‹ä½œç”¨åŸŸé“¾</li>
<li>ç¡®å®š <code>this</code> æŒ‡å‘</li>
</ul>
</li>
<li><p><strong>æ‰§è¡Œé˜¶æ®µ</strong></p>
<ul>
<li>å˜é‡èµ‹å€¼</li>
<li>å‡½æ•°å¼•ç”¨</li>
<li>æ‰§è¡Œä»£ç </li>
</ul>
</li>
<li><p><strong>å›æ”¶é˜¶æ®µ</strong></p>
<ul>
<li>æ‰§è¡Œå®Œæ¯•åï¼Œç­‰å¾…åƒåœ¾å›æ”¶</li>
</ul>
</li>
</ol>
<h3 id="å˜é‡æå‡ç¤ºä¾‹"><a href="#å˜é‡æå‡ç¤ºä¾‹" class="headerlink" title="å˜é‡æå‡ç¤ºä¾‹"></a>å˜é‡æå‡ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// &quot;Hello&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="è°ƒç”¨æ ˆ"><a href="#è°ƒç”¨æ ˆ" class="headerlink" title="è°ƒç”¨æ ˆ"></a>è°ƒç”¨æ ˆ</h2><h3 id="ä»€ä¹ˆæ˜¯è°ƒç”¨æ ˆ"><a href="#ä»€ä¹ˆæ˜¯è°ƒç”¨æ ˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯è°ƒç”¨æ ˆ"></a>ä»€ä¹ˆæ˜¯è°ƒç”¨æ ˆ</h3><blockquote>
<p>è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œç”¨äºè®°å½•ä»£ç æ‰§è¡Œçš„ä½ç½®ã€‚</p>
</blockquote>
<h3 id="è°ƒç”¨æ ˆçš„ç‰¹ç‚¹"><a href="#è°ƒç”¨æ ˆçš„ç‰¹ç‚¹" class="headerlink" title="è°ƒç”¨æ ˆçš„ç‰¹ç‚¹"></a>è°ƒç”¨æ ˆçš„ç‰¹ç‚¹</h3><ol>
<li>åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ç»“æ„</li>
<li>åŒæ­¥æ‰§è¡Œ</li>
<li>æ ˆæº¢å‡ºï¼šå½“è¶…è¿‡æœ€å¤§è°ƒç”¨æ ˆå¤§å°æ—¶ä¼šæŠ›å‡ºé”™è¯¯</li>
</ol>
<h3 id="è°ƒç”¨æ ˆç¤ºä¾‹"><a href="#è°ƒç”¨æ ˆç¤ºä¾‹" class="headerlink" title="è°ƒç”¨æ ˆç¤ºä¾‹"></a>è°ƒç”¨æ ˆç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">first</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;First&quot;</span>);</span><br><span class="line">  <span class="title function_">second</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">second</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Second&quot;</span>);</span><br><span class="line">  <span class="title function_">third</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">third</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Third&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">first</span>();</span><br></pre></td></tr></table></figure>

<p><strong><em>è°ƒç”¨æ ˆå˜åŒ–</em></strong>ï¼š</p>
<ol>
<li>first() å…¥æ ˆ</li>
<li>second() å…¥æ ˆ</li>
<li>third() å…¥æ ˆ</li>
<li>third() å‡ºæ ˆ</li>
<li>second() å‡ºæ ˆ</li>
<li>first() å‡ºæ ˆ</li>
</ol>
<h3 id="æ ˆæº¢å‡ºç¤ºä¾‹"><a href="#æ ˆæº¢å‡ºç¤ºä¾‹" class="headerlink" title="æ ˆæº¢å‡ºç¤ºä¾‹"></a>æ ˆæº¢å‡ºç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">recursive</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">recursive</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">recursive</span>(); <span class="comment">// Uncaught RangeError: Maximum call stack size exceeded</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡é˜Ÿåˆ—"><a href="#äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡é˜Ÿåˆ—"></a>äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡é˜Ÿåˆ—</h2><h3 id="JavaScript-è¿è¡Œæ—¶æ¨¡å‹"><a href="#JavaScript-è¿è¡Œæ—¶æ¨¡å‹" class="headerlink" title="JavaScript è¿è¡Œæ—¶æ¨¡å‹"></a>JavaScript è¿è¡Œæ—¶æ¨¡å‹</h3><ol>
<li>è°ƒç”¨æ ˆï¼šåŒæ­¥ä»£ç æ‰§è¡Œ</li>
<li>Web APIsï¼šæµè§ˆå™¨æä¾›çš„å¼‚æ­¥åŠŸèƒ½ï¼ˆsetTimeout, DOM äº‹ä»¶ç­‰ï¼‰</li>
<li>ä»»åŠ¡é˜Ÿåˆ—ï¼šå›è°ƒå‡½æ•°ç­‰å¾…æ‰§è¡Œ</li>
<li>äº‹ä»¶å¾ªç¯ï¼šç›‘æ§è°ƒç”¨æ ˆå’Œä»»åŠ¡é˜Ÿåˆ—</li>
</ol>
<h3 id="ä»»åŠ¡é˜Ÿåˆ—ç±»å‹"><a href="#ä»»åŠ¡é˜Ÿåˆ—ç±»å‹" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—ç±»å‹"></a>ä»»åŠ¡é˜Ÿåˆ—ç±»å‹</h3><ol>
<li><p>å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMacrotask Queueï¼‰</p>
<ul>
<li>setTimeout</li>
<li>setInterval</li>
<li>setImmediate (Node.js)</li>
<li>I&#x2F;O æ“ä½œ</li>
<li>UI æ¸²æŸ“</li>
<li>äº‹ä»¶å›è°ƒ</li>
</ul>
</li>
<li><p>å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆMicrotask Queueï¼‰</p>
<ul>
<li>Promise.then&#x2F;catch&#x2F;finally</li>
<li>MutationObserver</li>
<li>process.nextTick (Node.js)</li>
</ul>
</li>
</ol>
<h3 id="äº‹ä»¶å¾ªç¯æµç¨‹"><a href="#äº‹ä»¶å¾ªç¯æµç¨‹" class="headerlink" title="äº‹ä»¶å¾ªç¯æµç¨‹"></a>äº‹ä»¶å¾ªç¯æµç¨‹</h3><ol>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼ˆè°ƒç”¨æ ˆï¼‰</li>
<li>é‡åˆ°å¼‚æ­¥ä»»åŠ¡ï¼Œäº¤ç»™ Web APIs å¤„ç†</li>
<li>åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨æ ˆä¸ºç©º</li>
<li>æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</li>
<li>å¦‚æœ‰å¿…è¦ï¼Œè¿›è¡Œ UI æ¸²æŸ“</li>
<li>ä»å®ä»»åŠ¡é˜Ÿåˆ—å–å‡ºä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ</li>
<li>é‡å¤ä¸Šè¿°è¿‡ç¨‹</li>
</ol>
<h3 id="æ‰§è¡Œé¡ºåºç¤ºä¾‹"><a href="#æ‰§è¡Œé¡ºåºç¤ºä¾‹" class="headerlink" title="æ‰§è¡Œé¡ºåºç¤ºä¾‹"></a>æ‰§è¡Œé¡ºåºç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Script start&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeout&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Promise 1&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Promise 2&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Script end&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºé¡ºåº:</span></span><br><span class="line"><span class="comment">// Script start</span></span><br><span class="line"><span class="comment">// Script end</span></span><br><span class="line"><span class="comment">// Promise 1</span></span><br><span class="line"><span class="comment">// Promise 2</span></span><br><span class="line"><span class="comment">// setTimeout</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>JavaScript åŸºç¡€çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>JavaScript åŸºç¡€çŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‹ä»¶å¾ªç¯æœºåˆ¶(Event Loop)</title>
    <url>/2022/04/01/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6-Event-Loop/</url>
    <content><![CDATA[<h2 id="ä¸€ã€äº‹ä»¶å¾ªç¯çš„æ ¸å¿ƒç»„æˆ"><a href="#ä¸€ã€äº‹ä»¶å¾ªç¯çš„æ ¸å¿ƒç»„æˆ" class="headerlink" title="ä¸€ã€äº‹ä»¶å¾ªç¯çš„æ ¸å¿ƒç»„æˆ"></a>ä¸€ã€äº‹ä»¶å¾ªç¯çš„æ ¸å¿ƒç»„æˆ</h2><h3 id="1-è°ƒç”¨æ ˆï¼ˆCall-Stackï¼‰"><a href="#1-è°ƒç”¨æ ˆï¼ˆCall-Stackï¼‰" class="headerlink" title="1. è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰"></a>1. è°ƒç”¨æ ˆï¼ˆCall Stackï¼‰</h3><ul>
<li>ç”¨äºæ‰§è¡Œ<strong>åŒæ­¥ä»£ç </strong>ï¼Œéµå¾ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰åŸåˆ™</li>
<li>å‡½æ•°è°ƒç”¨è¢«å‹å…¥æ ˆä¸­ï¼Œæ‰§è¡Œå®Œæ¯•åå¼¹å‡º</li>
</ul>
<h3 id="2-ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask-Queuesï¼‰"><a href="#2-ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask-Queuesï¼‰" class="headerlink" title="2. ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queuesï¼‰"></a>2. ä»»åŠ¡é˜Ÿåˆ—ï¼ˆTask Queuesï¼‰</h3><table>
<thead>
<tr>
<th>é˜Ÿåˆ—ç±»å‹</th>
<th>åŒ…å«çš„ä»»åŠ¡ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å®ä»»åŠ¡é˜Ÿåˆ—</strong></td>
<td><code>setTimeout</code>, <code>setInterval</code>, DOM äº‹ä»¶å›è°ƒ, I&#x2F;O æ“ä½œ</td>
</tr>
<tr>
<td><strong>å¾®ä»»åŠ¡é˜Ÿåˆ—</strong></td>
<td><code>Promise.then</code>, <code>MutationObserver</code>, <code>process.nextTick</code>ï¼ˆNode.jsï¼‰</td>
</tr>
</tbody></table>
<h3 id="3-äº‹ä»¶å¾ªç¯å·¥ä½œæµç¨‹"><a href="#3-äº‹ä»¶å¾ªç¯å·¥ä½œæµç¨‹" class="headerlink" title="3. äº‹ä»¶å¾ªç¯å·¥ä½œæµç¨‹"></a>3. äº‹ä»¶å¾ªç¯å·¥ä½œæµç¨‹</h3><ol>
<li>æ‰§è¡Œè°ƒç”¨æ ˆä¸­çš„åŒæ­¥ä»£ç </li>
<li>è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œæ£€æŸ¥å¹¶æ‰§è¡Œ<strong>æ‰€æœ‰å¾®ä»»åŠ¡</strong></li>
<li>å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåï¼Œæ‰§è¡Œ<strong>ä¸€ä¸ªå®ä»»åŠ¡</strong></li>
<li>é‡å¤ä¸Šè¿°è¿‡ç¨‹</li>
</ol>
<hr>
<h2 id="äºŒã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™"><a href="#äºŒã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™" class="headerlink" title="äºŒã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™"></a>äºŒã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™</h2><h3 id="1-åŸºç¡€ä¼˜å…ˆçº§"><a href="#1-åŸºç¡€ä¼˜å…ˆçº§" class="headerlink" title="1. åŸºç¡€ä¼˜å…ˆçº§"></a>1. åŸºç¡€ä¼˜å…ˆçº§</h3><ol>
<li><p>åŒæ­¥ä»£ç  &gt; å¾®ä»»åŠ¡ &gt; å®ä»»åŠ¡</p>
</li>
<li><p>å¾®ä»»åŠ¡ä¼˜å…ˆçº§é«˜äºå®ä»»åŠ¡</p>
<ul>
<li><p>æ¯ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œä¼šæ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ŒåŒ…æ‹¬æ‰§è¡Œè¿‡ç¨‹ä¸­æ–°äº§ç”Ÿçš„å¾®ä»»åŠ¡ã€‚</p>
</li>
<li><p>å¾®ä»»åŠ¡é˜Ÿåˆ—å¿…é¡»å®Œå…¨æ¸…ç©ºåï¼Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚</p>
</li>
</ul>
</li>
<li><p>åŒç±»å‹ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº</p>
<ul>
<li><p>å®ä»»åŠ¡æŒ‰å…¥é˜Ÿé¡ºåºæ‰§è¡Œï¼ˆå¦‚å¤šä¸ª setTimeout æŒ‰å»¶è¿Ÿæ—¶é—´åˆ°æœŸé¡ºåºæ‰§è¡Œï¼‰ã€‚</p>
</li>
<li><p>å¾®ä»»åŠ¡æŒ‰å…¥é˜Ÿé¡ºåºæ‰§è¡Œï¼Œä¸”æ–°æ·»åŠ çš„å¾®ä»»åŠ¡ä¼šåœ¨æ­¤è½®äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œã€‚</p>
</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ä¸‰ã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™"><a href="#ä¸‰ã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™" class="headerlink" title="ä¸‰ã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™"></a>ä¸‰ã€æ‰§è¡Œä¼˜å…ˆçº§è§„åˆ™</h2><h3 id="1-ç¤ºä¾‹ä»£ç åˆ†æ"><a href="#1-ç¤ºä¾‹ä»£ç åˆ†æ" class="headerlink" title="1. ç¤ºä¾‹ä»£ç åˆ†æ"></a>1. ç¤ºä¾‹ä»£ç åˆ†æ</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;åŒæ­¥1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å®ä»»åŠ¡1&quot;</span>);</span><br><span class="line">  <span class="variable constant_">SS</span>;</span><br><span class="line">  <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å®ä»»åŠ¡1çš„å¾®ä»»åŠ¡&quot;</span>));</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¾®ä»»åŠ¡1&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;å¾®ä»»åŠ¡1çš„å®ä»»åŠ¡&quot;</span>), <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;åŒæ­¥2&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-æ‰§è¡Œé¡ºåºè§£æ"><a href="#2-æ‰§è¡Œé¡ºåºè§£æ" class="headerlink" title="2. æ‰§è¡Œé¡ºåºè§£æ"></a>2. æ‰§è¡Œé¡ºåºè§£æ</h3><ol>
<li><p>åŒæ­¥ä»£ç <br>è¾“å‡ºï¼šåŒæ­¥ 1 â†’ åŒæ­¥ 2ã€‚</p>
</li>
<li><p>å¾®ä»»åŠ¡é˜Ÿåˆ—å¤„ç†</p>
<ul>
<li><p>æ‰§è¡Œ Promise.resolve().thenï¼Œè¾“å‡º å¾®ä»»åŠ¡ 1ã€‚</p>
</li>
<li><p>å†…éƒ¨çš„ setTimeout å°†æ–°å®ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ã€‚</p>
</li>
</ul>
</li>
<li><p>å®ä»»åŠ¡é˜Ÿåˆ—å¤„ç†</p>
<ul>
<li><p>æ‰§è¡Œç¬¬ä¸€ä¸ª setTimeout å›è°ƒï¼Œè¾“å‡º å®ä»»åŠ¡ 1ã€‚</p>
</li>
<li><p>å…¶å†…éƒ¨çš„ Promise.then å°†å¾®ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ã€‚</p>
</li>
<li><p>å†æ¬¡æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¾“å‡º å®ä»»åŠ¡ 1 çš„å¾®ä»»åŠ¡ã€‚</p>
</li>
</ul>
</li>
<li><p>å¤„ç†æ–°åŠ å…¥çš„å®ä»»åŠ¡</p>
<ul>
<li>æ‰§è¡Œç”±å¾®ä»»åŠ¡ä¸­æ·»åŠ çš„ setTimeoutï¼Œè¾“å‡º å¾®ä»»åŠ¡ 1 çš„å®ä»»åŠ¡ã€‚</li>
</ul>
</li>
</ol>
<h3 id="3-æœ€ç»ˆè¾“å‡ºé¡ºåº"><a href="#3-æœ€ç»ˆè¾“å‡ºé¡ºåº" class="headerlink" title="3. æœ€ç»ˆè¾“å‡ºé¡ºåº"></a>3. æœ€ç»ˆè¾“å‡ºé¡ºåº</h3><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">åŒæ­¥1 â†’ åŒæ­¥2 â†’ å¾®ä»»åŠ¡1 â†’ å®ä»»åŠ¡1 â†’ å®ä»»åŠ¡1çš„å¾®ä»»åŠ¡ â†’ å¾®ä»»åŠ¡1çš„å®ä»»åŠ¡</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å››ã€ç‰¹æ®Šåœºæ™¯ä¸æ³¨æ„äº‹é¡¹"><a href="#å››ã€ç‰¹æ®Šåœºæ™¯ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€ç‰¹æ®Šåœºæ™¯ä¸æ³¨æ„äº‹é¡¹"></a>å››ã€ç‰¹æ®Šåœºæ™¯ä¸æ³¨æ„äº‹é¡¹</h2><ol>
<li><p>å¾®ä»»åŠ¡é€’å½’è°ƒç”¨</p>
<p>è‹¥åœ¨å¾®ä»»åŠ¡ä¸­ä¸æ–­æ·»åŠ æ–°çš„å¾®ä»»åŠ¡ï¼ˆå¦‚é€’å½’è°ƒç”¨ Promise.thenï¼‰ï¼Œä¼šå¯¼è‡´äº‹ä»¶å¾ªç¯å¡åœ¨å¾®ä»»åŠ¡é˜¶æ®µï¼Œæ— æ³•æ‰§è¡Œå®ä»»åŠ¡</p>
</li>
<li><p>æµè§ˆå™¨ä¸ Node.js çš„å·®å¼‚</p>
<ul>
<li><p>æµè§ˆå™¨ï¼šå¾®ä»»åŠ¡åœ¨æ¸²æŸ“ï¼ˆå¦‚é‡ç»˜ï¼‰å‰æ‰§è¡Œã€‚</p>
</li>
<li><p>Node.jsï¼šprocess.nextTick ä¼˜å…ˆçº§é«˜äº Promise.thenï¼Œä¸”äº‹ä»¶å¾ªç¯åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼ˆå¦‚ timersã€pollã€checkï¼‰ã€‚</p>
</li>
</ul>
</li>
<li><p>process.nextTickã€Promise.then å’Œ setTimeoutã€setImmediate çš„åŒºåˆ«</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…¸å‹æ‰§è¡Œé¡ºåºæ¼”ç¤º</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTimeout&quot;</span>), <span class="number">0</span>);</span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setImmediate&quot;</span>));</span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;nextTick&quot;</span>));</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;åŒæ­¥ä»£ç &quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒæ­¥ä»£ç  -&gt;  nextTick -&gt; promise -&gt; setTimeout -&gt; setImmediate</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ<ul>
<li>nextTick ï¼šç”¨äºç´§æ€¥ä»»åŠ¡ï¼ˆå¦‚é”™è¯¯å¤„ç†ï¼‰</li>
<li>Promise ï¼šæ ‡å‡†åŒ–çš„å¼‚æ­¥å¤„ç†</li>
<li>setImmediate ï¼šé¿å… setTimeout çš„æœ€å°å»¶è¿Ÿé—®é¢˜</li>
<li>setTimeout ï¼šç²¾ç¡®æ—¶é—´æ§åˆ¶ï¼ˆè™½ç„¶ä¸ç»å¯¹ç²¾ç¡®ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>åŒæ­¥ä»£ç  &gt; nextTick &gt; Promise &gt; setTimeout &gt; setImmediate</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦ç«‹å³æ‰§è¡Œï¼ˆå¦‚åˆå§‹åŒ–ï¼‰</span></span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;åˆå§‹åŒ–å®Œæˆ&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ç´§æ€¥ä½†éœ€è¦ä¿è¯é¡ºåº</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ•°æ®é¢„å¤„ç†&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦å»¶è¿Ÿä½†ä¸ç¡®å®šæ—¶é—´</span></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ—¥å¿—æ¸…ç†&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç²¾ç¡®å»¶è¿Ÿï¼ˆå¦‚é‡è¯•æœºåˆ¶ï¼‰</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯·æ±‚é‡è¯•&quot;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><table>
<thead>
<tr>
<th>ä»»åŠ¡ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>æ‰§è¡Œæ—¶æœº</th>
</tr>
</thead>
<tbody><tr>
<td>åŒæ­¥ä»£ç </td>
<td>console.log</td>
<td>ç«‹å³æ‰§è¡Œ</td>
</tr>
<tr>
<td>å¾®ä»»åŠ¡</td>
<td>Promise.then</td>
<td>è°ƒç”¨æ ˆæ¸…ç©ºåï¼Œå®ä»»åŠ¡å‰æ‰§è¡Œ</td>
</tr>
<tr>
<td>å®ä»»åŠ¡</td>
<td>setTimeout, I&#x2F;O</td>
<td>æ¯è½®äº‹ä»¶å¾ªç¯å¤„ç†ä¸€ä¸ªå®ä»»åŠ¡</td>
</tr>
</tbody></table>
<h3 id="æ ¸å¿ƒè§„åˆ™ï¼š"><a href="#æ ¸å¿ƒè§„åˆ™ï¼š" class="headerlink" title="æ ¸å¿ƒè§„åˆ™ï¼š"></a>æ ¸å¿ƒè§„åˆ™ï¼š</h3><blockquote>
<p>åŒæ­¥ä»£ç  â†’ å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©º â†’ ä¸€ä¸ªå®ä»»åŠ¡ â†’ å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©º â†’ ä¸‹ä¸€ä¸ªå®ä»»åŠ¡â€¦<br>ç†è§£äº‹ä»¶å¾ªç¯çš„ä¼˜å…ˆçº§æœºåˆ¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°æ§åˆ¶ä»£ç æ‰§è¡Œé¡ºåºï¼Œé¿å…å¼‚æ­¥é€»è¾‘çš„æ··ä¹±ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>JavaScript åŸºç¡€çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>JavaScript åŸºç¡€çŸ¥è¯†</tag>
      </tags>
  </entry>
  <entry>
    <title>å­¦ä¹ ç›®å½•</title>
    <url>/2018/05/01/%E5%AD%A6%E4%B9%A0%E7%9B%AE%E5%BD%95/</url>
    <content><![CDATA[<img src="/images/page-header.png" class="" title="é¦–é¡µå±•ç¤º width&#x3D;50%">

<!-- ![é¦–é¡µå±•ç¤º](/images/page-header.png)s -->

<h2 id="ç®—æ³•é¢˜è§£"><a href="#ç®—æ³•é¢˜è§£" class="headerlink" title="ç®—æ³•é¢˜è§£"></a>ç®—æ³•é¢˜è§£</h2><h3 id="å¸¸è§æ•°æ®ç»“æ„"><a href="#å¸¸è§æ•°æ®ç»“æ„" class="headerlink" title="å¸¸è§æ•°æ®ç»“æ„"></a>å¸¸è§æ•°æ®ç»“æ„</h3><h4 id="æ•°ç»„-vs-é“¾è¡¨"><a href="#æ•°ç»„-vs-é“¾è¡¨" class="headerlink" title="æ•°ç»„ vs é“¾è¡¨"></a>æ•°ç»„ vs é“¾è¡¨</h4><p><strong>å­˜å‚¨æ–¹å¼</strong></p>
<ul>
<li>æ•°ç»„ï¼šè¿ç»­å†…å­˜ç©ºé—´ï¼Œé¢„åˆ†é…å¤§å°</li>
<li>é“¾è¡¨ï¼šèŠ‚ç‚¹ç¦»æ•£å­˜å‚¨ï¼ŒåŠ¨æ€æ‰©å±•</li>
</ul>
<p><strong>æ—¶é—´å¤æ‚åº¦å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th>æ“ä½œ</th>
<th>æ•°ç»„</th>
<th>é“¾è¡¨</th>
</tr>
</thead>
<tbody><tr>
<td>éšæœºè®¿é—®</td>
<td>O(1)</td>
<td>O(n)</td>
</tr>
<tr>
<td>å¤´éƒ¨æ’å…¥</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>å°¾éƒ¨è¿½åŠ </td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
</tbody></table>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ•°ç»„ï¼šéœ€è¦é¢‘ç¹éšæœºè®¿é—®ï¼ˆå¦‚çŸ©é˜µè¿ç®—ï¼‰</li>
<li>é“¾è¡¨ï¼šé¢‘ç¹å¢åˆ æ“ä½œï¼ˆå¦‚ LRU ç¼“å­˜ï¼‰</li>
</ul>
<h4 id="æ ˆ-é˜Ÿåˆ—"><a href="#æ ˆ-é˜Ÿåˆ—" class="headerlink" title="æ ˆ &amp; é˜Ÿåˆ—"></a>æ ˆ &amp; é˜Ÿåˆ—</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœ€å°æ ˆå®ç°ï¼ˆæ”¯æŒO(1)è·å–æœ€å°å€¼ï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MinStack</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">minStack</span> = [<span class="title class_">Infinity</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">push</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">push</span>(val);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">minStack</span>.<span class="title function_">push</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(val, <span class="variable language_">this</span>.<span class="property">minStack</span>[<span class="variable language_">this</span>.<span class="property">minStack</span>.<span class="property">length</span> - <span class="number">1</span>]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">pop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">minStack</span>.<span class="title function_">pop</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">pop</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getMin</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">minStack</span>[<span class="variable language_">this</span>.<span class="property">minStack</span>.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”¨é˜Ÿåˆ—å®ç°æ ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.queue = collections.deque()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="variable language_">self</span>.queue.append(x)</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.queue)-<span class="number">1</span>):</span><br><span class="line">            <span class="variable language_">self</span>.queue.append(<span class="variable language_">self</span>.queue.popleft())</span><br></pre></td></tr></table></figure>

<h4 id="å“ˆå¸Œè¡¨"><a href="#å“ˆå¸Œè¡¨" class="headerlink" title="å“ˆå¸Œè¡¨"></a>å“ˆå¸Œè¡¨</h4><p><strong>å†²çªè§£å†³</strong></p>
<ul>
<li>å¼€æ”¾å¯»å€æ³•ï¼šçº¿æ€§æ¢æµ‹ã€äºŒæ¬¡æ¢æµ‹</li>
<li>é“¾åœ°å€æ³•ï¼šé“¾è¡¨å­˜å‚¨å†²çªå…ƒç´ ï¼ˆJava HashMapï¼‰</li>
</ul>
<h4 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h4><ul>
<li>å®Œå…¨äºŒå‰æ ‘ç»“æ„ï¼Œå¯ç”¨æ•°ç»„å®ç°</li>
<li>åº”ç”¨åœºæ™¯ï¼šTopK é—®é¢˜ï¼ˆæ—¶é—´å¤æ‚åº¦ O(nlogk)ï¼‰</li>
</ul>
<hr>
<h3 id="å…¸å‹ç®—æ³•"><a href="#å…¸å‹ç®—æ³•" class="headerlink" title="å…¸å‹ç®—æ³•"></a>å…¸å‹ç®—æ³•</h3><p><strong>å¿«é€Ÿæ’åºä¼˜åŒ–</strong></p>
<ol>
<li>ä¸‰æ•°å–ä¸­æ³•é€‰æ‹© pivot</li>
<li>å°æ•°ç»„åˆ‡æ¢æ’å…¥æ’åº</li>
<li>ä¸‰å‘åˆ‡åˆ†ï¼ˆå¤„ç†å¤§é‡é‡å¤å…ƒç´ ï¼‰</li>
</ol>
<p><strong>é¢è¯•é«˜é¢‘é—®é¢˜</strong></p>
<ul>
<li>å¦‚ä½•åˆ¤æ–­é“¾è¡¨æœ‰ç¯ï¼Ÿå¿«æ…¢æŒ‡é’ˆ vs å“ˆå¸Œè¡¨</li>
<li>äºŒå‰æ ‘å±‚åºéå†çš„æ—¶ç©ºå¤æ‚åº¦ï¼Ÿ</li>
<li>æµ·é‡æ•°æ®æ±‚ TopK ä¸ºä»€ä¹ˆç”¨å †ä¸ç”¨æ’åºï¼Ÿ</li>
</ul>
<h3 id="å…¸å‹ç®—æ³•-1"><a href="#å…¸å‹ç®—æ³•-1" class="headerlink" title="å…¸å‹ç®—æ³•"></a>å…¸å‹ç®—æ³•</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¿«é€Ÿæ’åºç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">quickSort</span>(<span class="params">arr</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr.<span class="property">length</span> &lt;= <span class="number">1</span>) <span class="keyword">return</span> arr;</span><br><span class="line">  <span class="keyword">const</span> pivot = arr[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">const</span> left = [];</span><br><span class="line">  <span class="keyword">const</span> right = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    arr[i] &lt; pivot ? left.<span class="title function_">push</span>(arr[i]) : right.<span class="title function_">push</span>(arr[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> [...<span class="title function_">quickSort</span>(left), pivot, ...<span class="title function_">quickSort</span>(right)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å‰ç«¯æ ¸å¿ƒ"><a href="#å‰ç«¯æ ¸å¿ƒ" class="headerlink" title="å‰ç«¯æ ¸å¿ƒ"></a>å‰ç«¯æ ¸å¿ƒ</h2><h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><h4 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h4><p><strong>å®ç°æœºåˆ¶</strong></p>
<ol>
<li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ <code>__proto__</code> å±æ€§æŒ‡å‘æ„é€ å‡½æ•°çš„ prototype</li>
<li>æ¯ä¸ªæ„é€ å‡½æ•°ä¹Ÿæ˜¯å‡½æ•°ï¼Œå…¶ <code>__proto__</code> æŒ‡å‘ Function.prototype</li>
<li>Function.prototype çš„ <code>__proto__</code> æŒ‡å‘ Object.prototype</li>
<li>Object.prototype çš„ <code>__proto__</code> æŒ‡å‘ null (åŸå‹é“¾çš„ç»ˆç‚¹å³æ˜¯ Object.prototype)</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">eat</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot; eating&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cat = <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">__proto__</span> === <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><p><strong>å®ç°æ–¹å¼</strong></p>
<ol>
<li>ç»„åˆç»§æ‰¿ï¼ˆæ¨èï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç»„åˆç»§æ‰¿ï¼ˆåŸå‹é“¾+æ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Cat</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name); <span class="comment">// ç¬¬äºŒæ¬¡è°ƒç”¨Animal</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Animal</span>(); <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨Animal</span></span><br><span class="line"><span class="title class_">Cat</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Cat</span>; <span class="comment">// ä¿®å¤æ„é€ å‡½æ•°æŒ‡å‘</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> cat = <span class="keyword">new</span> <span class="title class_">Cat</span>(<span class="string">&quot;Tom&quot;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cat.<span class="property">colors</span>); <span class="comment">// [&quot;red&quot;, &quot;blue&quot;]</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ˆæ¨è-æœ€ç†æƒ³çš„ç»§æ‰¿å½¢å¼ï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inheritPrototype</span>(<span class="params">child, parent</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> prototype = <span class="title class_">Object</span>.<span class="title function_">create</span>(parent.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// åˆ›å»ºçˆ¶ç±»åŸå‹çš„å‰¯æœ¬</span></span><br><span class="line">  prototype.<span class="property">constructor</span> = child; <span class="comment">// ä¿®å¤constructoræŒ‡å‘</span></span><br><span class="line">  child.<span class="property"><span class="keyword">prototype</span></span> = prototype; <span class="comment">// èµ‹å€¼ç»™å­ç±»åŸå‹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, name); <span class="comment">// åªè°ƒç”¨ä¸€æ¬¡çˆ¶ç±»æ„é€ å‡½æ•°</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é”®æ­¥éª¤ï¼šå»ºç«‹åŸå‹å…³ç³»</span></span><br><span class="line"><span class="title function_">inheritPrototype</span>(<span class="title class_">Child</span>, <span class="title class_">Parent</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ å­ç±»æ–¹æ³•</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayAge</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> child1 = <span class="keyword">new</span> <span class="title class_">Child</span>(<span class="string">&quot;Tom&quot;</span>, <span class="number">5</span>);</span><br><span class="line">child1.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&quot;green&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(child1.<span class="property">colors</span>); <span class="comment">// [&#x27;red&#x27;, &#x27;blue&#x27;, &#x27;green&#x27;]</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="JavaScript-ç»§æ‰¿æ–¹å¼å¯¹æ¯”"><a href="#JavaScript-ç»§æ‰¿æ–¹å¼å¯¹æ¯”" class="headerlink" title="JavaScript ç»§æ‰¿æ–¹å¼å¯¹æ¯”"></a>JavaScript ç»§æ‰¿æ–¹å¼å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>ç»„åˆç»§æ‰¿</th>
<th>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</th>
</tr>
</thead>
<tbody><tr>
<td><strong>å®ç°æ–¹å¼</strong></td>
<td>æ„é€ å‡½æ•°ç»§æ‰¿+åŸå‹é“¾ç»§æ‰¿</td>
<td>æ„é€ å‡½æ•°ç»§æ‰¿+åŸå‹æ‹·è´</td>
</tr>
<tr>
<td><strong>çˆ¶ç±»è°ƒç”¨æ¬¡æ•°</strong></td>
<td>2 æ¬¡ï¼ˆæ„é€ å‡½æ•°å’ŒåŸå‹å„ 1 æ¬¡ï¼‰</td>
<td>1 æ¬¡ï¼ˆä»…æ„é€ å‡½æ•°ï¼‰</td>
</tr>
<tr>
<td><strong>åŸå‹é“¾çº¯åº¦</strong></td>
<td>å­ç±»åŸå‹åŒ…å«å¤šä½™çˆ¶ç±»å®ä¾‹å±æ€§</td>
<td>çº¯å‡€çš„åŸå‹é“¾</td>
</tr>
<tr>
<td><strong>å†…å­˜æ•ˆç‡</strong></td>
<td>è¾ƒä½ï¼ˆé‡å¤å±æ€§ï¼‰</td>
<td>è¾ƒé«˜</td>
</tr>
<tr>
<td><strong>ä»£ç å¤æ‚åº¦</strong></td>
<td>ç®€å•ç›´æ¥</td>
<td>éœ€è¦è¾…åŠ©å‡½æ•°</td>
</tr>
<tr>
<td><strong>ES6 class åº•å±‚</strong></td>
<td>ä¸æ˜¯</td>
<td>æ˜¯</td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>ç®€å•ç»§æ‰¿åœºæ™¯</td>
<td>éœ€è¦é«˜æ•ˆç»§æ‰¿çš„å¤æ‚åœºæ™¯</td>
</tr>
<tr>
<td><strong>æ–¹æ³•å¤ç”¨</strong></td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td><strong>å±æ€§éš”ç¦»</strong></td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td><strong>constructor ä¿®æ­£</strong></td>
<td>éœ€è¦æ‰‹åŠ¨ä¿®æ­£</td>
<td>éœ€è¦æ‰‹åŠ¨ä¿®æ­£</td>
</tr>
</tbody></table>
<p><strong>å…³é”®åŒºåˆ«æ€»ç»“</strong>ï¼š</p>
<ol>
<li>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿é¿å…äº†ç»„åˆç»§æ‰¿çš„åŸå‹å±æ€§å†—ä½™é—®é¢˜</li>
<li>å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯ ES6 class è¯­æ³•ç³–çš„åº•å±‚å®ç°æ–¹å¼</li>
<li>ç»„åˆç»§æ‰¿æ›´æ˜“ç†è§£ä½†æ€§èƒ½ç¨å·®ï¼Œé€‚åˆç®€å•ç»§æ‰¿åœºæ™¯</li>
</ol>
<h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p><strong>æ ¸å¿ƒç‰¹å¾</strong></p>
<ul>
<li>å‡½æ•°åµŒå¥—ç»“æ„ï¼ˆå‡½æ•°å†…éƒ¨å®šä¹‰å‡½æ•°ï¼‰</li>
<li>å†…éƒ¨å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„å˜é‡</li>
<li>å»¶é•¿å˜é‡ç”Ÿå‘½å‘¨æœŸï¼ˆå†…éƒ¨å‡½æ•°åœ¨å¤–éƒ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åä»ç„¶å¯ä»¥è¢«è®¿é—®ï¼‰</li>
</ul>
<p><strong>é—­åŒ…çš„å…³é”®ç‰¹å¾ï¼š</strong></p>
<ul>
<li>ä¿æŒå¯¹è¯æ³•ä½œç”¨åŸŸçš„å¼•ç”¨</li>
<li>å³ä½¿å¤–éƒ¨å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œé—­åŒ…ä»ç„¶å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡</li>
<li>é—­åŒ…ä¼šé˜»æ­¢åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶è¢«å¼•ç”¨çš„å˜é‡</li>
</ul>
<p><strong>é—­åŒ…çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ•°æ®å°è£…å’Œç§æœ‰å˜é‡</li>
<li>å›è°ƒå‡½æ•°</li>
<li>å‡½æ•°æŸ¯é‡ŒåŒ–</li>
<li>æ¨¡å—æ¨¡å¼</li>
</ul>
<p><strong>å†…å­˜æ³„æ¼æ¡ˆä¾‹</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createHeavy</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> bigData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> bigData; <span class="comment">// é—­åŒ…æŒæœ‰bigDataå¼•ç”¨</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³æ–¹æ¡ˆï¼šæ˜¾å¼é‡Šæ”¾å¼•ç”¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">safeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> bigData = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">1000000</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">getData</span>: <span class="function">() =&gt;</span> bigData,</span><br><span class="line">    <span class="attr">clear</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      bigData.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h4><p><strong>æµè§ˆå™¨ç¯å¢ƒ</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2&quot;</span>), <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3&quot;</span>));</span><br><span class="line"><span class="comment">// è¾“å‡ºé¡ºåºï¼š1 -&gt; 3 -&gt; 2</span></span><br></pre></td></tr></table></figure>

<p><strong>Node.js ç¯å¢ƒ</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line">fs.<span class="title function_">readFile</span>(__filename, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>), <span class="number">0</span>);</span><br><span class="line">  <span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2&quot;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è¾“å‡ºé¡ºåºï¼š2 -&gt; 1ï¼ˆåœ¨I/Oé˜¶æ®µsetImmediateä¼˜å…ˆï¼‰</span></span><br></pre></td></tr></table></figure>

<h3 id="React"><a href="#React" class="headerlink" title="React"></a>React</h3><h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h4><p><strong>ç±»ç»„ä»¶ vs å‡½æ•°ç»„ä»¶</strong></p>
<ul>
<li>æŒ‚è½½é˜¶æ®µï¼šconstructor â†’ render â†’ componentDidMount</li>
<li>æ›´æ–°é˜¶æ®µï¼šshouldComponentUpdate â†’ render â†’ componentDidUpdate</li>
<li>å¸è½½é˜¶æ®µï¼šcomponentWillUnmount</li>
</ul>
<p><strong>Hooks æ‰§è¡Œé¡ºåº</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// componentDidMount</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;çˆ¶ç»„ä»¶ mounted&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;çˆ¶ç»„ä»¶ unmount&quot;</span>); <span class="comment">// componentWillUnmount</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">// çŠ¶æ€åˆå§‹åŒ–</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Hooks-ä½¿ç”¨"><a href="#Hooks-ä½¿ç”¨" class="headerlink" title="Hooks ä½¿ç”¨"></a>Hooks ä½¿ç”¨</h4><p><strong>æœ€ä½³å®è·µ</strong></p>
<ol>
<li>ç”¨ useMemo ç¼“å­˜æ˜‚è´µè®¡ç®—</li>
<li>ç”¨ useCallback é¿å…å­ç»„ä»¶æ— æ•ˆé‡æ¸²æŸ“</li>
<li>è‡ªå®šä¹‰ Hook å°è£…é€šç”¨é€»è¾‘</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰Hookå®ç°é˜²æŠ–</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useDebounce</span>(<span class="params">value, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [debouncedValue, setDebouncedValue] = <span class="title function_">useState</span>(value);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> handler = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setDebouncedValue</span>(value);</span><br><span class="line">    &#125;, delay);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(handler);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [value, delay]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> debouncedValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è™šæ‹Ÿ-DOM-åŸç†"><a href="#è™šæ‹Ÿ-DOM-åŸç†" class="headerlink" title="è™šæ‹Ÿ DOM åŸç†"></a>è™šæ‹Ÿ DOM åŸç†</h4><p><strong>Diff ç®—æ³•ä¼˜åŒ–ç­–ç•¥</strong></p>
<ol>
<li>åŒçº§æ¯”è¾ƒï¼ˆæ—¶é—´å¤æ‚åº¦ O(n^3)â†’O(n)ï¼‰</li>
<li>key å±æ€§ä¼˜åŒ–åˆ—è¡¨å¯¹æ¯”</li>
<li>åŒç¼“å­˜æŠ€æœ¯é¿å…ç™½å±</li>
</ol>
<hr>
<hr>
<h2 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h2><h3 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h3><ul>
<li>CAP å®šç†</li>
<li>RESTful è®¾è®¡</li>
<li>ç¼“å­˜ç­–ç•¥</li>
</ul>
<h3 id="å…¸å‹ç³»ç»Ÿ"><a href="#å…¸å‹ç³»ç»Ÿ" class="headerlink" title="å…¸å‹ç³»ç»Ÿ"></a>å…¸å‹ç³»ç»Ÿ</h3><ul>
<li>çŸ­é“¾æ¥ç³»ç»Ÿ</li>
<li>ç§’æ€ç³»ç»Ÿ</li>
<li>å³æ—¶é€šè®¯ç³»ç»Ÿ</li>
</ul>
<hr>
<h2 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h2><h3 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h3><ul>
<li>è¿›ç¨‹&#x2F;çº¿ç¨‹</li>
<li>å†…å­˜ç®¡ç†</li>
<li>æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
<h3 id="ç½‘ç»œåè®®"><a href="#ç½‘ç»œåè®®" class="headerlink" title="ç½‘ç»œåè®®"></a>ç½‘ç»œåè®®</h3><ul>
<li>TCP&#x2F;IP åè®®æ ˆ</li>
<li>HTTP&#x2F;2 ç‰¹æ€§</li>
<li>WebSocket åŸç†</li>
</ul>
<hr>
<p>æŒç»­æ›´æ–°ä¸­â€¦</p>
]]></content>
      <categories>
        <category>ç›®å½•</category>
      </categories>
  </entry>
  <entry>
    <title>æµè§ˆå™¨åŸç”Ÿè¯·æ±‚å¯¹è±¡</title>
    <url>/2022/07/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%94%9F%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1/</url>
    <content><![CDATA[<h1 id="å‰ç«¯è¯·æ±‚æŠ€æœ¯å…¨æ™¯ï¼šä»åŸç”Ÿ-API-åˆ°æ¡†æ¶æœ€ä½³å®è·µ"><a href="#å‰ç«¯è¯·æ±‚æŠ€æœ¯å…¨æ™¯ï¼šä»åŸç”Ÿ-API-åˆ°æ¡†æ¶æœ€ä½³å®è·µ" class="headerlink" title="å‰ç«¯è¯·æ±‚æŠ€æœ¯å…¨æ™¯ï¼šä»åŸç”Ÿ API åˆ°æ¡†æ¶æœ€ä½³å®è·µ"></a>å‰ç«¯è¯·æ±‚æŠ€æœ¯å…¨æ™¯ï¼šä»åŸç”Ÿ API åˆ°æ¡†æ¶æœ€ä½³å®è·µ</h1><h2 id="1-å¼•è¨€"><a href="#1-å¼•è¨€" class="headerlink" title="1. å¼•è¨€"></a>1. å¼•è¨€</h2><p>å‰ç«¯è¯·æ±‚æŠ€æœ¯ç»å†äº†ä¸‰ä¸ªé˜¶æ®µæ¼”è¿›ï¼š</p>
<ol>
<li><strong>XMLHttpRequest æ—¶ä»£</strong>ï¼ˆ2005ï¼‰ï¼šé¦–ä¸ªå¼‚æ­¥è¯·æ±‚ APIï¼Œå‚¬ç”Ÿ Ajax é©å‘½</li>
<li><strong>Fetch API æ—¶ä»£</strong>ï¼ˆ2015ï¼‰ï¼šåŸºäº Promise çš„ç°ä»£åŒ–æ–¹æ¡ˆ</li>
<li><strong>å°è£…åº“æ—¶ä»£</strong>ï¼šaxios ç­‰åº“å¡«è¡¥åŸç”Ÿ API çš„æ˜“ç”¨æ€§ç¼ºå£</li>
</ol>
<p>ç°ä»£ Web åº”ç”¨å¹³å‡å‘èµ· 50+æ¬¡è¯·æ±‚ï¼Œè¯·æ±‚å¤„ç†èƒ½åŠ›ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒå’Œæ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡ã€‚</p>
<hr>
<h2 id="2-åŸç”Ÿ-API-è¯¦è§£"><a href="#2-åŸç”Ÿ-API-è¯¦è§£" class="headerlink" title="2. åŸç”Ÿ API è¯¦è§£"></a>2. åŸç”Ÿ API è¯¦è§£</h2><h3 id="XHR-vs-Fetch-æ ¸å¿ƒå¯¹æ¯”"><a href="#XHR-vs-Fetch-æ ¸å¿ƒå¯¹æ¯”" class="headerlink" title="XHR vs Fetch æ ¸å¿ƒå¯¹æ¯”"></a>XHR vs Fetch æ ¸å¿ƒå¯¹æ¯”</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>XHR</th>
<th>Fetch</th>
</tr>
</thead>
<tbody><tr>
<td>å¼‚æ­¥æ¨¡å‹</td>
<td>å›è°ƒæœºåˆ¶</td>
<td>Promise</td>
</tr>
<tr>
<td>è¯·æ±‚ç»ˆæ­¢</td>
<td>xhr.abort()</td>
<td>AbortController</td>
</tr>
<tr>
<td>è¿›åº¦ç›‘æ§</td>
<td>progress äº‹ä»¶</td>
<td>ä¸å¯ç›´æ¥æ”¯æŒ</td>
</tr>
<tr>
<td>è¶…æ—¶è®¾ç½®</td>
<td>timeout å±æ€§</td>
<td>éœ€æ‰‹åŠ¨å°è£…</td>
</tr>
<tr>
<td>CORS å¤„ç†</td>
<td>éœ€ withCredentials</td>
<td>credentials å‚æ•°</td>
</tr>
</tbody></table>
<h3 id="XHR-ç¤ºä¾‹"><a href="#XHR-ç¤ºä¾‹" class="headerlink" title="XHR ç¤ºä¾‹"></a>XHR ç¤ºä¾‹</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®€å•å®ç°ajax s</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&quot;xxxxxxxxxxxx&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">XHR</span> = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// XHR æ”¯æŒåŒæ­¥è¯·æ±‚ï¼ˆ open æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ä¸º false ï¼‰ï¼Œä½†ä¼šé˜»å¡ UI çº¿ç¨‹ï¼Œé€šå¸¸ä¸æ¨èä½¿ç”¨ã€‚</span></span><br><span class="line"><span class="variable constant_">XHR</span>.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, url, <span class="literal">true</span>);</span><br><span class="line"><span class="variable constant_">XHR</span>.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">/** readyState</span></span><br><span class="line"><span class="comment"> * 0(UNSENT): è¯·æ±‚æœªåˆå§‹åŒ– (open()æ–¹æ³•æœªè¢«è°ƒç”¨)</span></span><br><span class="line"><span class="comment"> * 1(OPEND): æœåŠ¡å™¨è¿æ¥å·²å»ºç«‹ (open()æ–¹æ³•å·²è¢«è°ƒç”¨, send() è¿˜æœªè°ƒç”¨)</span></span><br><span class="line"><span class="comment"> * 2(HEADER_RECEIVED): è¯·æ±‚å·²æ¥æ”¶ (send()æ–¹æ³•å·²è¢«è°ƒç”¨,ä¸”å“åº”å¤´å’ŒçŠ¶æ€ç å·²æ”¶åˆ°)</span></span><br><span class="line"><span class="comment"> * 3(LOADING): è¯·æ±‚å¤„ç†ä¸­,æ­£åœ¨æ¥æ”¶å“åº”ä½“ï¼Œæ­¤æ—¶ responseText å±æ€§å¯èƒ½åŒ…å«éƒ¨åˆ†æ•°æ®</span></span><br><span class="line"><span class="comment"> * 4(DONE): è¯·æ±‚å·²å®Œæˆï¼Œä¸”å“åº”å·²å°±ç»ª (å“åº”æ•°æ®å·²å®Œå…¨æ¥æ”¶æˆ–è¯·æ±‚å¤±è´¥)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="variable constant_">XHR</span>.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥XMLHttpRequestå¯¹è±¡çš„çŠ¶æ€å’Œå“åº”çŠ¶æ€ç </span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable constant_">XHR</span>.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; <span class="variable constant_">XHR</span>.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">// å½“è¯·æ±‚å·²å®Œæˆï¼ˆreadyStateä¸º4ï¼‰ä¸”å“åº”çŠ¶æ€ç ä¸º200ï¼ˆæˆåŠŸï¼‰æ—¶æ‰§è¡Œä»¥ä¸‹ä»£ç </span></span><br><span class="line">    <span class="comment">// å°†å“åº”æ–‡æœ¬è§£æä¸ºJSONå¯¹è±¡</span></span><br><span class="line">    result = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable constant_">XHR</span>.<span class="property">responseText</span>);</span><br><span class="line">    <span class="comment">// å°†è§£æåçš„ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Fetch-ç¤ºä¾‹ï¼šå¸¦è¶…æ—¶çš„-GET-è¯·æ±‚"><a href="#Fetch-ç¤ºä¾‹ï¼šå¸¦è¶…æ—¶çš„-GET-è¯·æ±‚" class="headerlink" title="Fetch ç¤ºä¾‹ï¼šå¸¦è¶…æ—¶çš„ GET è¯·æ±‚"></a>Fetch ç¤ºä¾‹ï¼šå¸¦è¶…æ—¶çš„ GET è¯·æ±‚</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> controller.<span class="title function_">abort</span>(), <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/api/data&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">signal</span>: controller.<span class="property">signal</span>,</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err.<span class="property">name</span> === <span class="string">&quot;AbortError&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯·æ±‚è¶…æ—¶&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-å°è£…åº“åˆ†æï¼šaxios-æ ¸å¿ƒä¼˜åŠ¿"><a href="#3-å°è£…åº“åˆ†æï¼šaxios-æ ¸å¿ƒä¼˜åŠ¿" class="headerlink" title="3. å°è£…åº“åˆ†æï¼šaxios æ ¸å¿ƒä¼˜åŠ¿"></a>3. å°è£…åº“åˆ†æï¼šaxios æ ¸å¿ƒä¼˜åŠ¿</h2><h3 id="æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ"><a href="#æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ" class="headerlink" title="æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ"></a>æ ¸å¿ƒèƒ½åŠ›çŸ©é˜µ</h3><ol>
<li>æ‹¦æˆªå™¨ç³»ç»Ÿ</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯·æ±‚æ‹¦æˆªå™¨ - åœ¨è¯·æ±‚å‘é€å‰æ‰§è¡Œ</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ä¿®æ”¹è¯·æ±‚é…ç½®å¯¹è±¡ï¼Œæ·»åŠ  Authorization è¯·æ±‚å¤´</span></span><br><span class="line">  config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="title function_">getToken</span>();</span><br><span class="line">  <span class="comment">// å¿…é¡»è¿”å›ä¿®æ”¹åçš„é…ç½®å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å“åº”æ‹¦æˆªå™¨ - åœ¨å“åº”è¿”å›åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">// normalizeData å’Œ handleApiErrord æ˜¯è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€ä¸ªå‡½æ•°å¤„ç†æˆåŠŸå“åº” (çŠ¶æ€ç  2xx)</span></span><br><span class="line">  <span class="function">(<span class="params">response</span>) =&gt;</span> <span class="title function_">normalizeData</span>(response.<span class="property">data</span>),</span><br><span class="line">  <span class="comment">// ç¬¬äºŒä¸ªå‡½æ•°å¤„ç†é”™è¯¯å“åº” (çŠ¶æ€ç é 2xx)</span></span><br><span class="line">  <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="title function_">handleApiError</span>(error)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å…³é”®ç‚¹è¯´æ˜ï¼š</p>
<ol>
<li><p>è¯·æ±‚æ‹¦æˆªå™¨ ï¼š</p>
<ul>
<li>é€šè¿‡ axios.interceptors.request.use() æ³¨å†Œ</li>
<li>æ¯æ¬¡å‘é€è¯·æ±‚å‰è‡ªåŠ¨æ‰§è¡Œ</li>
<li>å…¸å‹ç”¨é€”ï¼šæ·»åŠ è®¤è¯å¤´ã€è®¾ç½®å…¬å…±å‚æ•°ã€ä¿®æ”¹è¯·æ±‚é…ç½®</li>
<li>ç¤ºä¾‹ä¸­è‡ªåŠ¨æ·»åŠ äº† Authorization å¤´ï¼Œå€¼æ¥è‡ª getToken() å‡½æ•°</li>
</ul>
</li>
<li><p>å“åº”æ‹¦æˆªå™¨ ï¼š</p>
<ul>
<li>é€šè¿‡ axios.interceptors.response.use() æ³¨å†Œ</li>
<li>æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼šæˆåŠŸå›è°ƒå’Œé”™è¯¯å›è°ƒ</li>
<li>æˆåŠŸæ—¶ï¼šå¯¹å“åº”æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–å¤„ç† ( normalizeData )</li>
<li>é”™è¯¯æ—¶ï¼šç»Ÿä¸€é”™è¯¯å¤„ç† ( handleApiError )</li>
</ul>
</li>
<li><p>æ‹¦æˆªå™¨é“¾ ï¼š</p>
<ul>
<li>å¯ä»¥æ³¨å†Œå¤šä¸ªæ‹¦æˆªå™¨ï¼ŒæŒ‰æ³¨å†Œé¡ºåºå½¢æˆå¤„ç†é“¾</li>
<li>è¯·æ±‚æ‹¦æˆªå™¨ï¼šåæ³¨å†Œçš„å…ˆæ‰§è¡Œ</li>
<li>å“åº”æ‹¦æˆªå™¨ï¼šå…ˆæ³¨å†Œçš„å…ˆæ‰§è¡Œ<br>è¿™ç§è®¾è®¡å®ç°äº†è¯·æ±‚&#x2F;å“åº”çš„ç»Ÿä¸€å¤„ç†ï¼Œé¿å…äº†åœ¨æ¯ä¸ªè¯·æ±‚ä¸­é‡å¤ç›¸åŒçš„é€»è¾‘ã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
<ol start="2">
<li>å–æ¶ˆè¯·æ±‚ï¼ˆCancelToken å·²å¼ƒç”¨ï¼Œæ¨è AbortControllerï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. åˆ›å»º AbortController å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å‘èµ· GET è¯·æ±‚ï¼Œå°† controller çš„ signal ä¼ å…¥è¯·æ±‚é…ç½®</span></span><br><span class="line">axios</span><br><span class="line">  .<span class="title function_">get</span>(<span class="string">&quot;/api/data&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">signal</span>: controller.<span class="property">signal</span>, <span class="comment">// å°†ä¸­æ­¢ä¿¡å·ä¸è¯·æ±‚å…³è”</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚æˆåŠŸå¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯·æ±‚å·²è¢«å–æ¶ˆ:&quot;</span>, error.<span class="property">message</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¯·æ±‚é”™è¯¯:&quot;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. éœ€è¦å–æ¶ˆè¯·æ±‚æ—¶è°ƒç”¨ abort() æ–¹æ³•</span></span><br><span class="line">controller.<span class="title function_">abort</span>(); <span class="comment">// è¿™ä¼šè§¦å‘è¯·æ±‚å–æ¶ˆ</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>å…³é”®ç‚¹è¯´æ˜ï¼š</p>
<ol>
<li><p>AbortController ï¼š</p>
<ul>
<li>æ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„åŸç”Ÿ API</li>
<li>é€šè¿‡ signal å±æ€§æä¾›ä¸­æ­¢ä¿¡å·</li>
<li>è°ƒç”¨ abort() æ–¹æ³•ä¼šè§¦å‘è¯·æ±‚å–æ¶ˆ</li>
</ul>
</li>
<li><p>axios é›†æˆ ï¼š</p>
<ul>
<li>å°† controller.signal ä¼ å…¥è¯·æ±‚é…ç½®</li>
<li>å½“è°ƒç”¨ abort() æ—¶ï¼Œaxios ä¼šè‡ªåŠ¨å–æ¶ˆè¯·æ±‚</li>
<li>å–æ¶ˆåä¼šè§¦å‘ catch åˆ†æ”¯ï¼Œé”™è¯¯ç±»å‹ä¸º Cancel</li>
</ul>
</li>
<li><p>åº”ç”¨åœºæ™¯ ï¼š</p>
<ul>
<li>ç”¨æˆ·å¯¼èˆªç¦»å¼€é¡µé¢æ—¶å–æ¶ˆæœªå®Œæˆè¯·æ±‚</li>
<li>è¡¨å•æäº¤åé˜²æ­¢é‡å¤æäº¤</li>
<li>å®ç°è¯·æ±‚è¶…æ—¶æ§åˆ¶ï¼ˆé…åˆ setTimeout ï¼‰</li>
</ul>
</li>
<li><p>ä¸ä¼ ç»Ÿ CancelToken çš„åŒºåˆ« ï¼š</p>
<ul>
<li>è¿™æ˜¯æµè§ˆå™¨åŸç”Ÿæ–¹æ¡ˆï¼Œä¸å†ä¾èµ– axios ç‰¹æœ‰çš„ CancelToken</li>
<li>æ›´ç®€æ´ï¼Œä¸ç°ä»£ Fetch API çš„å–æ¶ˆæœºåˆ¶ä¸€è‡´</li>
<li>CancelToken å·²è¢«æ ‡è®°ä¸º deprecated</li>
</ul>
</li>
</ol>
</li>
</ul>
<ol start="3">
<li><p>è‡ªåŠ¨è½¬æ¢</p>
<ul>
<li><p>è‡ªåŠ¨ JSON è§£æ</p>
</li>
<li><p>è¯·æ±‚æ•°æ®åºåˆ—åŒ–</p>
</li>
<li><p>æµè§ˆå™¨ç¯å¢ƒè‡ªåŠ¨ XSRF é˜²å¾¡</p>
</li>
</ul>
</li>
</ol>
<h2 id="4-æ¡†æ¶é›†æˆæœ€ä½³å®è·µ"><a href="#4-æ¡†æ¶é›†æˆæœ€ä½³å®è·µ" class="headerlink" title="4. æ¡†æ¶é›†æˆæœ€ä½³å®è·µ"></a>4. æ¡†æ¶é›†æˆæœ€ä½³å®è·µ</h2><h3 id="React-æ–¹æ¡ˆ"><a href="#React-æ–¹æ¡ˆ" class="headerlink" title="React æ–¹æ¡ˆ"></a>React æ–¹æ¡ˆ</h3><blockquote>
<p>è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰ React Hook useFetch ï¼Œç”¨äºå°è£… axios çš„æ•°æ®è·å–é€»è¾‘ï¼Œå…·æœ‰è‡ªåŠ¨å–æ¶ˆè¯·æ±‚çš„åŠŸèƒ½</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useFetch</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="comment">// 1. ä½¿ç”¨ useState ç®¡ç†è·å–åˆ°çš„æ•°æ®çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">const</span> [data, setData] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. ä½¿ç”¨ useEffect å¤„ç†å‰¯ä½œç”¨</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 3. åˆ›å»º AbortController ç”¨äºå–æ¶ˆè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å‘èµ· axios GET è¯·æ±‚</span></span><br><span class="line">    axios</span><br><span class="line">      .<span class="title function_">get</span>(url, &#123;</span><br><span class="line">        <span class="attr">signal</span>: controller.<span class="property">signal</span>, <span class="comment">// ç»‘å®šå–æ¶ˆä¿¡å·</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">setData</span>(res.<span class="property">data</span>)) <span class="comment">// æˆåŠŸæ—¶æ›´æ–°çŠ¶æ€</span></span><br><span class="line">      .<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>); <span class="comment">// é”™è¯¯æ—¶æ‰“å°æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. æ¸…ç†å‡½æ•°ï¼šç»„ä»¶å¸è½½æ—¶å–æ¶ˆè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> controller.<span class="title function_">abort</span>();</span><br><span class="line">  &#125;, [url]); <span class="comment">// 6. ä¾èµ–é¡¹ï¼šurl å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 7. è¿”å›è·å–åˆ°çš„æ•°æ®</span></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç¤ºä¾‹:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">useFetch</span>(<span class="string">&quot;/api/users&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!data) <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;JSON.stringify(data)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Vue-3-ç»„åˆå¼-API"><a href="#Vue-3-ç»„åˆå¼-API" class="headerlink" title="Vue 3 ç»„åˆå¼ API"></a>Vue 3 ç»„åˆå¼ API</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useFetch &#125; <span class="keyword">from</span> <span class="string">&quot;@vueuse/core&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; data, error &#125; = <span class="title function_">useFetch</span>(<span class="string">&quot;/api/data&quot;</span>).<span class="title function_">get</span>().<span class="title function_">json</span>();</span><br></pre></td></tr></table></figure>

<h2 id="5-é«˜çº§åº”ç”¨åœºæ™¯"><a href="#5-é«˜çº§åº”ç”¨åœºæ™¯" class="headerlink" title="5. é«˜çº§åº”ç”¨åœºæ™¯"></a>5. é«˜çº§åº”ç”¨åœºæ™¯</h2><h3 id="WebSocket-å®æ—¶é€šä¿¡"><a href="#WebSocket-å®æ—¶é€šä¿¡" class="headerlink" title="WebSocket å®æ—¶é€šä¿¡"></a>WebSocket å®æ—¶é€šä¿¡</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. åˆ›å»º WebSocket è¿æ¥ï¼ŒæŒ‡å®šæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. è¿æ¥å»ºç«‹æˆåŠŸå›è°ƒ</span></span><br><span class="line">socket.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥å·²å»ºç«‹&quot;</span>);</span><br><span class="line">  <span class="comment">// è¿æ¥å»ºç«‹åç«‹å³å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯</span></span><br><span class="line">  socket.<span class="title function_">send</span>(<span class="string">&quot;Hello, Server!&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">socket.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="comment">// event.data åŒ…å«æœåŠ¡å™¨å‘é€çš„æ•°æ®</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯:&quot;</span>, event.<span class="property">data</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. è¿æ¥å…³é—­å›è°ƒ</span></span><br><span class="line">socket.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;è¿æ¥å·²å…³é—­&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>åŸºç¡€çŸ¥è¯†</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>åŸºç¡€çŸ¥è¯†</tag>
        <tag>æµè§ˆå™¨-è¯·æ±‚å¯¹è±¡</tag>
      </tags>
  </entry>
  <entry>
    <title>Webå®‰å…¨å¿…ä¿®è¯¾-XSSä¸CSRFæ”»å‡»</title>
    <url>/2022/07/05/Web%E5%AE%89%E5%85%A8%E5%BF%85%E4%BF%AE%E8%AF%BE-XSS%E4%B8%8ECSRF%E6%94%BB%E5%87%BB/</url>
    <content><![CDATA[<h2 id="ä¸€ã€XSS-æ”»å‡»ï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"><a href="#ä¸€ã€XSS-æ”»å‡»ï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰" class="headerlink" title="ä¸€ã€XSS æ”»å‡»ï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"></a>ä¸€ã€XSS æ”»å‡»ï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</h2><h3 id="æ”»å‡»åŸç†"><a href="#æ”»å‡»åŸç†" class="headerlink" title="æ”»å‡»åŸç†"></a>æ”»å‡»åŸç†</h3><p>æƒ³è±¡åœ¨è®ºå›çš„ç•™è¨€æ¿é‡Œï¼Œæ”»å‡»è€…æäº¤çš„å†…å®¹æ˜¯ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  ç›—å–ç”¨æˆ·cookieçš„ä»£ç ;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“å…¶ä»–ç”¨æˆ·æµè§ˆè¿™æ¡ç•™è¨€æ—¶ï¼Œæ¶æ„è„šæœ¬å°±ä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­æ‰§è¡Œï¼Œå°±åƒåœ¨çœŸå®çš„ç½‘ç«™ä¸­è¿è¡Œä¸€æ ·</p>
<h3 id="ä¸‰ç§å¸¸è§ç±»å‹"><a href="#ä¸‰ç§å¸¸è§ç±»å‹" class="headerlink" title="ä¸‰ç§å¸¸è§ç±»å‹"></a>ä¸‰ç§å¸¸è§ç±»å‹</h3><h4 id="1-åå°„å‹-XSSï¼ˆä¸´æ—¶æ”»å‡»ï¼‰"><a href="#1-åå°„å‹-XSSï¼ˆä¸´æ—¶æ”»å‡»ï¼‰" class="headerlink" title="1. åå°„å‹ XSSï¼ˆä¸´æ—¶æ”»å‡»ï¼‰"></a>1. åå°„å‹ XSSï¼ˆä¸´æ—¶æ”»å‡»ï¼‰</h4><ul>
<li>é€šè¿‡ URL å‚æ•°æ³¨å…¥æ¶æ„è„šæœ¬</li>
</ul>
<ul>
<li>ç¤ºä¾‹é“¾æ¥ï¼š</li>
</ul>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">https://example.com/search?q=&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-å­˜å‚¨å‹-XSSï¼ˆæŒä¹…åŒ–æ”»å‡»ï¼‰"><a href="#2-å­˜å‚¨å‹-XSSï¼ˆæŒä¹…åŒ–æ”»å‡»ï¼‰" class="headerlink" title="2. å­˜å‚¨å‹ XSSï¼ˆæŒä¹…åŒ–æ”»å‡»ï¼‰"></a>2. å­˜å‚¨å‹ XSSï¼ˆæŒä¹…åŒ–æ”»å‡»ï¼‰</h4><ul>
<li><p>æ¶æ„è„šæœ¬è¢«ä¿å­˜åˆ°æ•°æ®åº“</p>
</li>
<li><p>å¸¸è§åœºæ™¯ï¼šç”¨æˆ·è¯„è®ºã€ç§ä¿¡å†…å®¹</p>
</li>
</ul>
<h4 id="3-DOM-å‹-XSSï¼ˆçº¯å‰ç«¯æ”»å‡»ï¼‰"><a href="#3-DOM-å‹-XSSï¼ˆçº¯å‰ç«¯æ”»å‡»ï¼‰" class="headerlink" title="3. DOM å‹ XSSï¼ˆçº¯å‰ç«¯æ”»å‡»ï¼‰"></a>3. DOM å‹ XSSï¼ˆçº¯å‰ç«¯æ”»å‡»ï¼‰</h4><ul>
<li><p>ä¸ç»è¿‡æœåŠ¡å™¨ï¼Œå‰ç«¯ç›´æ¥æ“ä½œ DOM æ—¶è§¦å‘</p>
</li>
<li><p>ç¤ºä¾‹ä»£ç </p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä»URLè·å–å‚æ•°ç›´æ¥æ’å…¥é¡µé¢</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(location.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<h3 id="é˜²å¾¡æ–¹æ¡ˆ"><a href="#é˜²å¾¡æ–¹æ¡ˆ" class="headerlink" title="é˜²å¾¡æ–¹æ¡ˆ"></a>é˜²å¾¡æ–¹æ¡ˆ</h3><h4 id="1-è¾“å…¥è¿‡æ»¤"><a href="#1-è¾“å…¥è¿‡æ»¤" class="headerlink" title="1. è¾“å…¥è¿‡æ»¤"></a>1. è¾“å…¥è¿‡æ»¤</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦å‡½æ•°ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sanitize</span>(<span class="params">input</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> input.<span class="title function_">replace</span>(<span class="regexp">/&lt;/g</span>, <span class="string">&quot;&amp;lt;&quot;</span>).<span class="title function_">replace</span>(<span class="regexp">/&gt;/g</span>, <span class="string">&quot;&amp;gt;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-è¾“å‡ºè½¬ä¹‰"><a href="#2-è¾“å‡ºè½¬ä¹‰" class="headerlink" title="2. è¾“å‡ºè½¬ä¹‰"></a>2. è¾“å‡ºè½¬ä¹‰</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ¨¡æ¿å¼•æ“è‡ªåŠ¨è½¬ä¹‰ï¼ˆåŒèŠ±æ‹¬å·è¯­æ³•ä¼šè‡ªåŠ¨å¯¹æ’å…¥çš„å†…å®¹è¿›è¡ŒHTMLå®ä½“è½¬ä¹‰ï¼Œå¦‚ï¼š&lt;script&gt; ä¼šè¢«è½¬ä¹‰ä¸º &amp;lt;script&amp;gt;ï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; userContent &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ‰‹åŠ¨è½¬ä¹‰ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&lt;%- dangerousData %&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-Content-Security-Policyï¼ˆç®€ç§°-CSP-å†…å®¹å®‰å…¨ç­–ç•¥ï¼‰"><a href="#3-Content-Security-Policyï¼ˆç®€ç§°-CSP-å†…å®¹å®‰å…¨ç­–ç•¥ï¼‰" class="headerlink" title="3. Content-Security-Policyï¼ˆç®€ç§°:CSP å†…å®¹å®‰å…¨ç­–ç•¥ï¼‰"></a>3. Content-Security-Policyï¼ˆç®€ç§°:CSP å†…å®¹å®‰å…¨ç­–ç•¥ï¼‰</h4><blockquote>
<p>æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§å¼ºå¤§çš„å®‰å…¨æœºåˆ¶ï¼Œä¸»è¦ç”¨äºé˜²èŒƒè·¨ç«™è„šæœ¬æ”»å‡»(XSS)ç­‰å®‰å…¨å¨èƒã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ç™½åå•æœºåˆ¶ï¼Œå‘Šè¯‰æµè§ˆå™¨&gt; å“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥è¢«åŠ è½½å’Œæ‰§è¡Œ</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>:</span><br><span class="line">  default-src &#x27;self&#x27;;  // é»˜è®¤ç­–ç•¥ï¼Œåªå…è®¸åŠ è½½åŒæºèµ„æº</span><br><span class="line">  script-src &#x27;self&#x27; https://trusted.cdn.com; // è„šæœ¬åªèƒ½ä»åŒæºæˆ–æŒ‡å®šCDNåŠ è½½</span><br><span class="line">  img-src *; // å›¾ç‰‡å¯ä»¥ä»ä»»ä½•æ¥æºåŠ è½½</span><br><span class="line">  style-src &#x27;unsafe-inline&#x27;; //  å…è®¸å†…è”æ ·å¼(æœ‰ä¸€å®šé£é™©)</span><br></pre></td></tr></table></figure>

<h4 id="4-HttpOnly-Cookie"><a href="#4-HttpOnly-Cookie" class="headerlink" title="4. HttpOnly Cookie"></a>4. HttpOnly Cookie</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯è®¾ç½®Cookieæ—¶</span></span><br><span class="line"><span class="title class_">Set</span>-<span class="title class_">Cookie</span>: sessionId=abc123; <span class="title class_">HttpOnly</span>; <span class="title class_">Secure</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>HttpOnly - é‡è¦å®‰å…¨å±æ€§ï¼Œä½œç”¨æ˜¯ï¼š</p>
<ul>
<li>ç¦æ­¢ JavaScript é€šè¿‡ document.cookie è®¿é—®è¯¥ Cookie</li>
<li>æœ‰æ•ˆé˜²èŒƒ XSS æ”»å‡»çªƒå– Cookie</li>
</ul>
</li>
</ul>
<ul>
<li><p>Secure - å®‰å…¨ä¼ è¾“å±æ€§ï¼Œä½œç”¨æ˜¯ï¼š</p>
<ul>
<li>è¯¥ Cookie åªèƒ½é€šè¿‡ HTTPS åè®®ä¼ è¾“</li>
<li>é˜²æ­¢åœ¨ HTTP æ˜æ–‡ä¼ è¾“ä¸­è¢«çªƒå¬</li>
</ul>
</li>
</ul>
<hr>
<h2 id="äºŒã€CSRF-æ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰"><a href="#äºŒã€CSRF-æ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰" class="headerlink" title="äºŒã€CSRF æ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰"></a>äºŒã€CSRF æ”»å‡»ï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</h2><h3 id="æ”»å‡»åŸç†-1"><a href="#æ”»å‡»åŸç†-1" class="headerlink" title="æ”»å‡»åŸç†"></a>æ”»å‡»åŸç†</h3><p>å‡è®¾ç”¨æˆ·ç™»å½•äº†é“¶è¡Œç½‘ç«™ï¼Œæ”»å‡»è€…æ„é€ çš„é’“é±¼é¡µé¢ä¸­åŒ…å«ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://bank.com/transfer?to=hacker&amp;amount=1000000&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æºå¸¦é“¶è¡Œç½‘ç«™çš„ Cookie å‘èµ·è½¬è´¦è¯·æ±‚</p>
<h3 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h3><ol>
<li>ç”¨æˆ·ç™»å½•ä¿¡ä»»ç½‘ç«™ A</li>
<li>ç½‘ç«™ A ä¸‹å‘èº«ä»½ Cookie</li>
<li>ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ B</li>
<li>ç½‘ç«™ B è¯±å¯¼æµè§ˆå™¨å‘ç½‘ç«™ A å‘èµ·è¯·æ±‚</li>
<li>æµè§ˆå™¨è‡ªåŠ¨æºå¸¦ Cookie å®Œæˆè¯·æ±‚</li>
</ol>
<h3 id="é˜²å¾¡æ–¹æ¡ˆ-1"><a href="#é˜²å¾¡æ–¹æ¡ˆ-1" class="headerlink" title="é˜²å¾¡æ–¹æ¡ˆ"></a>é˜²å¾¡æ–¹æ¡ˆ</h3><ol>
<li>CSRF Token éªŒè¯</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœåŠ¡ç«¯ç”ŸæˆToken</span></span><br><span class="line"><span class="keyword">const</span> csrfToken = crypto.<span class="title function_">randomBytes</span>(<span class="number">16</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰ç«¯è¡¨å•æºå¸¦Token</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/transfer&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_csrf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;%= csrfToken %&gt;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="comment">&lt;!-- å…¶ä»–è¡¨å•å­—æ®µ --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">// æœåŠ¡ç«¯ä¸­é—´ä»¶éªŒè¯</span></span><br><span class="line"><span class="language-xml">app.post(&#x27;/transfer&#x27;, (req, res) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">  if(req.body._csrf !== req.session.csrfToken) &#123;</span></span><br><span class="line"><span class="language-xml">    return res.status(403).send(&#x27;CSRFéªŒè¯å¤±è´¥&#x27;);</span></span><br><span class="line"><span class="language-xml">  &#125;</span></span><br><span class="line"><span class="language-xml">  // å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="language-xml">&#125;);</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>SameSite Cookie å±æ€§</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¾ç½®Cookieæ—¶</span></span><br><span class="line"><span class="title class_">Set</span>-<span class="title class_">Cookie</span>: sessionId=abc123; <span class="title class_">SameSite</span>=<span class="title class_">Lax</span>; <span class="title class_">Secure</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Strictï¼šå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookie</li>
<li>Laxï¼šå…è®¸éƒ¨åˆ†å®‰å…¨è¯·æ±‚ï¼ˆé»˜è®¤å€¼ï¼‰</li>
<li>Noneï¼šå…³é—­ä¿æŠ¤ï¼ˆéœ€é…åˆ Secureï¼‰</li>
</ul>
<ol start="3">
<li>éªŒè¯è¯·æ±‚æ¥æº</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ£€æŸ¥Refererå¤´</span></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">  req.<span class="property">headers</span>.<span class="property">referer</span> &amp;&amp;</span><br><span class="line">  !req.<span class="property">headers</span>.<span class="property">referer</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;https://trusted-domain.com&quot;</span>)</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;éæ³•è¯·æ±‚æ¥æº&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>åŒé‡ Cookie éªŒè¯</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Cookieä¿¡æ¯</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;/api/transfer&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&quot;X-CSRF-TOKEN&quot;</span>: <span class="title function_">getCookie</span>(<span class="string">&quot;csrfToken&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡ç«¯æ¯”å¯¹Cookieä¸Headerä¸­çš„å€¼</span></span><br><span class="line"><span class="keyword">if</span> (req.<span class="property">headers</span>[<span class="string">&quot;x-csrf-token&quot;</span>] !== req.<span class="property">cookies</span>.<span class="property">csrfToken</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&quot;éªŒè¯å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰ã€å®æˆ˜é˜²å¾¡ç»„åˆæ‹³"><a href="#ä¸‰ã€å®æˆ˜é˜²å¾¡ç»„åˆæ‹³" class="headerlink" title="ä¸‰ã€å®æˆ˜é˜²å¾¡ç»„åˆæ‹³"></a>ä¸‰ã€å®æˆ˜é˜²å¾¡ç»„åˆæ‹³</h2><h3 id="æ¨èé˜²å¾¡ç­–ç•¥"><a href="#æ¨èé˜²å¾¡ç­–ç•¥" class="headerlink" title="æ¨èé˜²å¾¡ç­–ç•¥"></a>æ¨èé˜²å¾¡ç­–ç•¥</h3><h4 id="1-XSS-ç»¼åˆé˜²å¾¡"><a href="#1-XSS-ç»¼åˆé˜²å¾¡" class="headerlink" title="1. XSS ç»¼åˆé˜²å¾¡"></a>1. XSS ç»¼åˆé˜²å¾¡</h4><ul>
<li>è¾“å…¥æ ¡éªŒ + è¾“å‡ºè½¬ä¹‰ + CSP ç­–ç•¥ + HttpOnly</li>
</ul>
<h4 id="2-CSRF-é»„é‡‘ç»„åˆ"><a href="#2-CSRF-é»„é‡‘ç»„åˆ" class="headerlink" title="2. CSRF é»„é‡‘ç»„åˆ"></a>2. CSRF é»„é‡‘ç»„åˆ</h4><ul>
<li>CSRF Token + SameSite Cookie</li>
</ul>
<h3 id="ç°ä»£æ¡†æ¶æœ€ä½³å®è·µ"><a href="#ç°ä»£æ¡†æ¶æœ€ä½³å®è·µ" class="headerlink" title="ç°ä»£æ¡†æ¶æœ€ä½³å®è·µ"></a>ç°ä»£æ¡†æ¶æœ€ä½³å®è·µ</h3><ol>
<li>React é¡¹ç›®é…ç½® CSP</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; </span></span></span><br><span class="line"><span class="string"><span class="tag">               script-src &#x27;self&#x27; &#x27;unsafe-eval&#x27;;</span></span></span><br><span class="line"><span class="string"><span class="tag">               style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;</span></span></span><br><span class="line"><span class="string"><span class="tag">               img-src https://*;&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Express ä¸­é—´ä»¶é…ç½®</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> csrf = <span class="built_in">require</span>(<span class="string">&quot;csurf&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">csrf</span>(&#123; <span class="attr">cookie</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–CSRF Token</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/csrf-token&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">csrfToken</span>: req.<span class="title function_">csrfToken</span>() &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="æ¸—é€æµ‹è¯•å·¥å…·æ¨è"><a href="#æ¸—é€æµ‹è¯•å·¥å…·æ¨è" class="headerlink" title="æ¸—é€æµ‹è¯•å·¥å…·æ¨è"></a>æ¸—é€æµ‹è¯•å·¥å…·æ¨è</h3><ol>
<li>ä½¿ç”¨ OWASP ZAP è‡ªåŠ¨æ‰«ææ¼æ´</li>
<li>é€šè¿‡ Postman æ‰‹åŠ¨æµ‹è¯• API æ¥å£</li>
<li>åˆ©ç”¨ Burp Suite è¿›è¡Œé«˜çº§å®‰å…¨æµ‹è¯•</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    A[ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™] --&gt; B[è§¦å‘éšè—è¯·æ±‚]</span><br><span class="line">    B --&gt; C[æºå¸¦åˆæ³•Cookie]</span><br><span class="line">    C --&gt; D[æœåŠ¡ç«¯æ‰§è¡Œå±é™©æ“ä½œ]</span><br><span class="line">    D --&gt; E[æ”»å‡»å®Œæˆ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>é˜²å¾¡æªæ–½å®æ–½åï¼Œå»ºè®®å®šæœŸä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·è¿›è¡Œå®‰å…¨æ‰«æï¼Œå¹¶å»ºç«‹æ¼æ´å“åº”æœºåˆ¶ã€‚å®‰å…¨é˜²æŠ¤éœ€è¦æŒ&gt; ç»­ç»´æŠ¤ï¼Œè€Œéä¸€åŠ³æ°¸é€¸ï¼</p>
</blockquote>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>Webå®‰å…¨</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>Webå®‰å…¨</tag>
        <tag>XSSä¸CSRFæ”»å‡»</tag>
      </tags>
  </entry>
  <entry>
    <title>cssé¢„ç¼–è¯‘å™¨</title>
    <url>/2022/03/30/css%E9%A2%84%E7%BC%96%E8%AF%91/</url>
    <content><![CDATA[<h3 id="1-Sass-Syntactically-Awesome-Style-Sheets"><a href="#1-Sass-Syntactically-Awesome-Style-Sheets" class="headerlink" title="1. Sass (Syntactically Awesome Style Sheets)"></a>1. Sass (Syntactically Awesome Style Sheets)</h3><p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æœ€æˆç†Ÿçš„ CSS é¢„å¤„ç†å™¨</li>
<li>æä¾›ä¸¤ç§è¯­æ³•æ ¼å¼ï¼š<ul>
<li><code>.scss</code> (Sassy CSS) - å…¼å®¹ CSS è¯­æ³•</li>
<li><code>.sass</code> - ç¼©è¿›è¯­æ³•ï¼ˆä¸ä½¿ç”¨å¤§æ‹¬å·å’Œåˆ†å·ï¼‰</li>
</ul>
</li>
<li>éœ€è¦ Ruby ç¯å¢ƒï¼ˆLibSass ç‰ˆæœ¬ä¸éœ€è¦ï¼‰</li>
</ul>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å˜é‡</span></span><br><span class="line"><span class="variable">$primary-color</span>: <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åµŒå¥—</span></span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mixin</span></span><br><span class="line"><span class="keyword">@mixin</span> border-radius(<span class="variable">$radius</span>) &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="variable">$radius</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿</span></span><br><span class="line"><span class="selector-class">.message</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.success</span> &#123;</span><br><span class="line">  <span class="keyword">@extend</span> .message;</span><br><span class="line">  <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-Less-Leaner-Style-Sheets"><a href="#2-Less-Leaner-Style-Sheets" class="headerlink" title="2.Less (Leaner Style Sheets)"></a>2.Less (Leaner Style Sheets)</h3><p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å— Sass å¯å‘ï¼Œè¯­æ³•æ›´æ¥è¿‘åŸç”Ÿ CSS</li>
<li>ä½¿ç”¨ JavaScript å®ç°ï¼ˆNode.jsï¼‰</li>
<li>æµè§ˆå™¨ç«¯å¯ç›´æ¥è¿è¡Œï¼ˆå¼€å‘ç¯å¢ƒï¼‰</li>
</ul>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å˜é‡</span></span><br><span class="line"><span class="variable">@primary-color:</span> <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åµŒå¥—</span></span><br><span class="line"><span class="selector-tag">nav</span> &#123;</span><br><span class="line">  <span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Mixin</span></span><br><span class="line"><span class="selector-class">.border-radius</span>(<span class="variable">@radius</span>) &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="variable">@radius</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿ç®—</span></span><br><span class="line"><span class="variable">@base:</span> <span class="number">5%</span>;</span><br><span class="line"><span class="variable">@filler:</span> <span class="variable">@base</span> * <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-Stylus"><a href="#3-Stylus" class="headerlink" title="3.Stylus"></a>3.Stylus</h3><p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è¯­æ³•æœ€çµæ´»ï¼ˆå¯é€‰æ‹¬å·ã€åˆ†å·ã€å†’å·ï¼‰</li>
<li>Node.js å®ç°</li>
<li>å¼ºè°ƒç®€æ´æ€§å’Œè¡¨ç°åŠ›</li>
</ul>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å˜é‡ï¼ˆå¯çœç•¥$ï¼‰</span></span><br><span class="line">primary-<span class="attribute">color</span> = <span class="selector-id">#333</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åµŒå¥—</span></span><br><span class="line"><span class="selector-tag">nav</span></span><br><span class="line">  <span class="selector-tag">ul</span></span><br><span class="line">    <span class="attribute">margin</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Mixin</span></span><br><span class="line"><span class="attribute">border-radius</span>(radius)</span><br><span class="line">  <span class="attribute">border-radius</span> radius</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…ç½®å‡½æ•°</span></span><br><span class="line"><span class="built_in">lighten</span>(color, <span class="number">10%</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰è€…å¼‚åŒ"><a href="#ä¸‰è€…å¼‚åŒ" class="headerlink" title="ä¸‰è€…å¼‚åŒ"></a>ä¸‰è€…å¼‚åŒ</h3><h4 id="æ¨¡å—åŒ–èƒ½åŠ›å¯¹æ¯”"><a href="#æ¨¡å—åŒ–èƒ½åŠ›å¯¹æ¯”" class="headerlink" title="æ¨¡å—åŒ–èƒ½åŠ›å¯¹æ¯”"></a>æ¨¡å—åŒ–èƒ½åŠ›å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>æ¨¡å—åŒ–ç‰¹æ€§</th>
<th>Sass&#x2F;SCSS</th>
<th>Less</th>
<th>Stylus</th>
</tr>
</thead>
<tbody><tr>
<td><strong>åŸºç¡€å¯¼å…¥</strong></td>
<td><code>@import</code> (æ—§ç‰ˆ)</td>
<td><code>@import</code></td>
<td><code>@import</code></td>
</tr>
<tr>
<td><strong>ç°ä»£æ¨¡å—ç³»ç»Ÿ</strong></td>
<td><code>@use</code> + <code>@forward</code> (Dart Sass)</td>
<td>æ— </td>
<td>æ— </td>
</tr>
<tr>
<td><strong>å‘½åç©ºé—´</strong></td>
<td>é€šè¿‡<code>@use</code>å¼•å…¥å¸¦å‰ç¼€</td>
<td>æ— åŸç”Ÿæ”¯æŒ</td>
<td>æ— åŸç”Ÿæ”¯æŒ</td>
</tr>
<tr>
<td><strong>ç§æœ‰æˆå‘˜</strong></td>
<td><code>-</code>æˆ–<code>_</code>å‰ç¼€å˜é‡</td>
<td>æ— </td>
<td>æ— </td>
</tr>
<tr>
<td><strong>ä¾èµ–ç®¡ç†</strong></td>
<td>è‡ªåŠ¨é¿å…é‡å¤å¯¼å…¥</td>
<td>éœ€æ‰‹åŠ¨ç®¡ç†</td>
<td>éœ€æ‰‹åŠ¨ç®¡ç†</td>
</tr>
<tr>
<td><strong>å±€éƒ¨æ–‡ä»¶</strong></td>
<td><code>_partial.scss</code>çº¦å®š</td>
<td><code>_partial.less</code>çº¦å®š</td>
<td><code>_partial.styl</code>çº¦å®š</td>
</tr>
<tr>
<td><strong>CSS è¾“å‡ºæ§åˆ¶</strong></td>
<td><code>@forward</code>éšè—&#x2F;æš´éœ²ç‰¹å®šæˆå‘˜</td>
<td>æ— </td>
<td>æ— </td>
</tr>
<tr>
<td><strong>å˜é‡è¦†ç›–</strong></td>
<td><code>!default</code>æ ‡è®°å¯è¦†ç›–å˜é‡</td>
<td>åå®šä¹‰è¦†ç›–å‰å®šä¹‰</td>
<td>åå®šä¹‰è¦†ç›–å‰å®šä¹‰</td>
</tr>
<tr>
<td><strong>è·¨æ–‡ä»¶å…±äº«</strong></td>
<td>é€šè¿‡<code>@use</code>å…±äº«</td>
<td>å…¨å±€è‡ªåŠ¨å…±äº«</td>
<td>å…¨å±€è‡ªåŠ¨å…±äº«</td>
</tr>
<tr>
<td><strong>æŒ‰éœ€åŠ è½½</strong></td>
<td>æ”¯æŒæ¡ä»¶å¯¼å…¥</td>
<td>å…¨éƒ¨å¯¼å…¥</td>
<td>æ”¯æŒæ¡ä»¶å¯¼å…¥</td>
</tr>
</tbody></table>
<h4 id="å…¸å‹ä»£ç ç¤ºä¾‹"><a href="#å…¸å‹ä»£ç ç¤ºä¾‹" class="headerlink" title="å…¸å‹ä»£ç ç¤ºä¾‹"></a>å…¸å‹ä»£ç ç¤ºä¾‹</h4><p><strong>Sass æ¨¡å—åŒ– (ç°ä»£æ–¹å¼)</strong></p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _variables.scss</span></span><br><span class="line"><span class="variable">$primary</span>: <span class="number">#333</span> !default;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.scss</span></span><br><span class="line"><span class="keyword">@use</span> <span class="string">&quot;variables&quot;</span> as vars;</span><br><span class="line"><span class="keyword">@use</span> <span class="string">&quot;buttons&quot;</span> with (</span><br><span class="line">  <span class="variable">$primary</span>: vars.<span class="variable">$primary</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>Less æ¨¡å—åŒ–</strong></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">// variables.less</span></span><br><span class="line"><span class="variable">@primary:</span> <span class="number">#333</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.less</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;variables&quot;</span>;</span><br><span class="line"><span class="keyword">@import</span> <span class="string">&quot;buttons&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Stylus æ¨¡å—åŒ–</strong></p>
<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="comment">// variables.styl</span></span><br><span class="line">primary = <span class="selector-id">#333</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.styl</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;variables&#x27;</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;buttons&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„:</p>
<ol>
<li><p>Less ä¸­çš„å˜é‡ï¼Œåœ¨å£°æ˜ä¸­ä½¿ç”¨æ—¶ï¼Œå¦‚æœå‡ºç°å¤šæ¬¡èµ‹å€¼çš„æƒ…å†µï¼Œå…¶ä¼šå–æœ€åä¸€æ¬¡èµ‹å€¼çš„å€¼</p>
</li>
<li><p>Sass&#x2F;Stylus ä¸­çš„å˜é‡ï¼Œå¦‚æœå‡ºç°å¤šæ¬¡èµ‹å€¼çš„æƒ…å†µï¼Œå…¶ä¼šå–å£°æ˜å‰é¢æœ€è¿‘çš„ä¸€æ¬¡èµ‹å€¼çš„å€¼</p>
</li>
</ol>
<h4 id="æ¨¡å—åŒ–å»ºè®®ï¼š"><a href="#æ¨¡å—åŒ–å»ºè®®ï¼š" class="headerlink" title="æ¨¡å—åŒ–å»ºè®®ï¼š"></a>æ¨¡å—åŒ–å»ºè®®ï¼š</h4><ul>
<li>éœ€è¦ä¸¥æ ¼éš”ç¦» â†’ é€‰æ‹© Sass çš„ @use ç³»ç»Ÿ</li>
<li>ç®€å•é¡¹ç›® â†’ Less&#x2F;Stylus çš„åŸºç¡€å¯¼å…¥å·²è¶³å¤Ÿ</li>
<li>å˜é‡å…±äº« â†’ Sass çš„å‘½åç©ºé—´æœ€å®‰å…¨</li>
<li>æ—§é¡¹ç›®ç»´æŠ¤ â†’ æ³¨æ„ Sass çš„ @import å·²è¢«æ ‡è®°ä¸ºåºŸå¼ƒ</li>
</ul>
<h4 id="ä¸‰ç§-CSS-é¢„ç¼–è¯‘å™¨å¯¹æ¯”"><a href="#ä¸‰ç§-CSS-é¢„ç¼–è¯‘å™¨å¯¹æ¯”" class="headerlink" title="ä¸‰ç§ CSS é¢„ç¼–è¯‘å™¨å¯¹æ¯”"></a>ä¸‰ç§ CSS é¢„ç¼–è¯‘å™¨å¯¹æ¯”</h4><table>
<thead>
<tr>
<th>å¯¹æ¯”ç»´åº¦</th>
<th>Sass&#x2F;SCSS</th>
<th>Less</th>
<th>Stylus</th>
</tr>
</thead>
<tbody><tr>
<td><strong>è¯ç”Ÿæ—¶é—´</strong></td>
<td>2006 å¹´ (æœ€æ—©æœŸ)</td>
<td>2009 å¹´ (å— Sass å¯å‘)</td>
<td>2010 å¹´ (æœ€æ–°)</td>
</tr>
<tr>
<td><strong>è¯­æ³•é£æ ¼</strong></td>
<td><code>.scss</code>å…¼å®¹ CSS &#x2F; <code>.sass</code>ç¼©è¿›è¯­æ³•</td>
<td>å®Œå…¨å…¼å®¹ CSS è¯­æ³•</td>
<td>æç®€è¯­æ³•ï¼ˆç¬¦å·å¯é€‰ï¼‰</td>
</tr>
<tr>
<td><strong>è¿è¡Œç¯å¢ƒ</strong></td>
<td>Ruby (æˆ– LibSass çš„ C ç‰ˆæœ¬)</td>
<td>JavaScript (Node.js)</td>
<td>JavaScript (Node.js)</td>
</tr>
<tr>
<td><strong>å˜é‡å£°æ˜</strong></td>
<td><code>$var: value;</code></td>
<td><code>@var: value;</code></td>
<td><code>var = value</code> æˆ– <code>var: value</code></td>
</tr>
<tr>
<td><strong>åµŒå¥—è§„åˆ™</strong></td>
<td>æ”¯æŒå®Œæ•´åµŒå¥—</td>
<td>æ”¯æŒå®Œæ•´åµŒå¥—</td>
<td>æ”¯æŒï¼ˆç¼©è¿›æ•æ„Ÿï¼‰</td>
</tr>
<tr>
<td><strong>Mixin</strong></td>
<td><code>@mixin</code>å®šä¹‰ &#x2F; <code>@include</code>è°ƒç”¨</td>
<td>ç±»å¼æ··åˆï¼ˆç›´æ¥è°ƒç”¨ï¼‰</td>
<td>å‡½æ•°å¼å®šä¹‰</td>
</tr>
<tr>
<td><strong>ç»§æ‰¿</strong></td>
<td><code>@extend</code></td>
<td>æ— ï¼ˆé€šè¿‡ Mixins æ¨¡æ‹Ÿï¼‰</td>
<td><code>@extend</code></td>
</tr>
<tr>
<td><strong>è¿ç®—èƒ½åŠ›</strong></td>
<td>æ”¯æŒå¤æ‚æ•°å­¦è¿ç®—</td>
<td>åŸºç¡€è¿ç®—</td>
<td>æ”¯æŒè¿ç®—å’Œå†…ç½®å‡½æ•°</td>
</tr>
<tr>
<td><strong>æ¡ä»¶è¯­å¥</strong></td>
<td><code>@if/@else</code></td>
<td>æœ‰é™æ”¯æŒï¼ˆé€šè¿‡ whenï¼‰</td>
<td>å®Œæ•´ if&#x2F;else æ”¯æŒ</td>
</tr>
<tr>
<td><strong>å¾ªç¯è¯­å¥</strong></td>
<td><code>@for/@each/@while</code></td>
<td>æœ‰é™å¾ªç¯</td>
<td>å®Œæ•´å¾ªç¯æ”¯æŒ</td>
</tr>
<tr>
<td><strong>æ¨¡å—åŒ–</strong></td>
<td><code>@use</code>&#x2F;<code>@forward</code> (æ–°ç‰ˆ)</td>
<td><code>@import</code></td>
<td><code>@import</code></td>
</tr>
<tr>
<td><strong>é”™è¯¯å¤„ç†</strong></td>
<td>è¯¦ç»†é”™è¯¯æŠ¥å‘Š</td>
<td>åŸºç¡€é”™è¯¯æç¤º</td>
<td>ç›¸å¯¹ç®€æ´çš„é”™è¯¯æç¤º</td>
</tr>
<tr>
<td><strong>ç¼–è¯‘é€Ÿåº¦</strong></td>
<td>è¾ƒå¿«ï¼ˆLibSass ç‰ˆæœ¬ï¼‰</td>
<td>ä¸­ç­‰</td>
<td>æœ€å¿«</td>
</tr>
<tr>
<td><strong>ç¤¾åŒºç”Ÿæ€</strong></td>
<td>æœ€åºå¤§ï¼ˆBootstrap æ—©æœŸä½¿ç”¨ï¼‰</td>
<td>è¾ƒå¤§ï¼ˆBootstrap v3 é‡‡ç”¨ï¼‰</td>
<td>è¾ƒå°ä½†æ´»è·ƒ</td>
</tr>
<tr>
<td><strong>å…¸å‹ç”¨æˆ·</strong></td>
<td>GitHub, Airbnb, Shopify</td>
<td>Bootstrap 3, æ—©æœŸ React é¡¹ç›®</td>
<td>Vue ç”Ÿæ€ï¼ˆæ—©æœŸ Vue-loader é›†æˆï¼‰</td>
</tr>
</tbody></table>
<h3 id="ç‰¹è‰²åŠŸèƒ½å¯¹æ¯”"><a href="#ç‰¹è‰²åŠŸèƒ½å¯¹æ¯”" class="headerlink" title="ç‰¹è‰²åŠŸèƒ½å¯¹æ¯”"></a>ç‰¹è‰²åŠŸèƒ½å¯¹æ¯”</h3><table>
<thead>
<tr>
<th>é«˜çº§åŠŸèƒ½</th>
<th>Sass</th>
<th>Less</th>
<th>Stylus</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¢œè‰²å‡½æ•°</strong></td>
<td>æä¾› 20+é¢œè‰²æ“ä½œå‡½æ•°</td>
<td>åŸºç¡€é¢œè‰²æ··åˆ</td>
<td>å†…ç½® lighten&#x2F;darken ç­‰</td>
</tr>
<tr>
<td><strong>çˆ¶é€‰æ‹©å™¨</strong></td>
<td><code>&amp;</code> é«˜åº¦çµæ´»</td>
<td><code>&amp;</code> åŸºæœ¬åŠŸèƒ½</td>
<td><code>&amp;</code> æ”¯æŒå±‚çº§å¼•ç”¨</td>
</tr>
<tr>
<td><strong>è‡ªå®šä¹‰å‡½æ•°</strong></td>
<td><code>@function</code></td>
<td>é€šè¿‡æ’ä»¶æ‰©å±•</td>
<td>å†…ç½®å‡½æ•°å¼æ”¯æŒ</td>
</tr>
<tr>
<td><strong>CSS å…¼å®¹</strong></td>
<td>å®Œå…¨å…¼å®¹ CSS</td>
<td>å®Œå…¨å…¼å®¹ CSS</td>
<td>éœ€è¦è½¬æ¢è¯­æ³•</td>
</tr>
<tr>
<td><strong>åŠ¨æ€å¯¼å…¥</strong></td>
<td>æ”¯æŒè¿è¡Œæ—¶å¯¼å…¥</td>
<td>é™æ€å¯¼å…¥</td>
<td>æ”¯æŒæ¡ä»¶å¯¼å…¥</td>
</tr>
<tr>
<td><strong>æºç æ˜ å°„</strong></td>
<td>å®Œæ•´ sourcemap æ”¯æŒ</td>
<td>åŸºç¡€æ”¯æŒ</td>
<td>å®Œæ•´æ”¯æŒ</td>
</tr>
</tbody></table>
<blockquote>
<p>é€‰æ‹©å»ºè®®ï¼š</p>
<ul>
<li><strong>ä¼ä¸šçº§é¡¹ç›®</strong> â†’ Sassï¼ˆç¨³å®šæ€§å’ŒåŠŸèƒ½å®Œæ•´æ€§ï¼‰</li>
<li><strong>å‰ç«¯æ¡†æ¶é›†æˆ</strong> â†’ Lessï¼ˆçº¯ JS å®ç°ä¼˜åŠ¿ï¼‰</li>
<li><strong>å¼€å‘æ•ˆç‡ä¼˜å…ˆ</strong> â†’ Stylusï¼ˆæç®€è¯­æ³•å’Œå¿«é€ŸåŸå‹ï¼‰</li>
<li><strong>å·²æœ‰æŠ€æœ¯æ ˆ</strong> â†’ ä¼˜å…ˆåŒ¹é…ç°æœ‰ç”Ÿæ€</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
        <category>å‰ç«¯</category>
        <category>css</category>
      </categories>
      <tags>
        <tag>å‰ç«¯</tag>
        <tag>css</tag>
      </tags>
  </entry>
</search>
